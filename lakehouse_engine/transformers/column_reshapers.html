<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>lakehouse_engine.transformers.column_reshapers</title>
            <link rel="icon" href="https://github.com/adidas/lakehouse-engine/blob/master/assets/img/lakehouse_engine_logo_no_bg_160.png?raw=true"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#000000;background-color:#f1efef;border-color:#f1f1f1;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:150%;overflow:auto;margin-bottom:1rem;}.pdoc table th, .pdoc table td{padding:12px 13px;border:1px solid var(--accent2);}.pdoc table th{font-weight:600;}</style>
    <style>/*! custom.css */</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../transformers.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;lakehouse_engine.transformers</a>

            <img src="https://github.com/adidas/lakehouse-engine/blob/master/assets/img/lakehouse_engine_logo_no_bg_160.png?raw=true" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#ColumnReshapers">ColumnReshapers</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ColumnReshapers.cast">cast</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.column_selector">column_selector</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.flatten_schema">flatten_schema</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.explode_columns">explode_columns</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.with_expressions">with_expressions</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.rename">rename</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.from_avro">from_avro</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.from_avro_with_registry">from_avro_with_registry</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.from_json">from_json</a>
                        </li>
                        <li>
                                <a class="function" href="#ColumnReshapers.to_json">to_json</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>Lakehouse Engine v1.19.0</footer>

</div>
    </nav>
    <main class="pdoc">
    <section class="module-info">

                <h1 class="modulename">
<a href="./../../lakehouse_engine.html">lakehouse_engine</a><wbr>.<a href="./../transformers.html">transformers</a><wbr>.column_reshapers    </h1>

                <div class="docstring"><p>Module with column reshaping transformers.</p>
</div>

                    <input id="mod-column_reshapers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                    <label class="view-source-button" for="mod-column_reshapers-view-source"><span>View Source</span></label>

                    <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Module with column reshaping transformers.&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">pyspark.sql.types</span> <span class="k">as</span> <span class="nn">spark_types</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">DataFrame</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">pyspark.sql.avro.functions</span> <span class="kn">import</span> <span class="n">from_avro</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="n">col</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="n">explode_outer</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">expr</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>    <span class="n">from_json</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="n">map_entries</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="n">struct</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">to_json</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="p">)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.transformers.exceptions</span> <span class="kn">import</span> <span class="n">WrongArgumentsException</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.utils.logging_handler</span> <span class="kn">import</span> <span class="n">LoggingHandler</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.utils.schema_utils</span> <span class="kn">import</span> <span class="n">SchemaUtils</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="k">class</span> <span class="nc">ColumnReshapers</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing column reshaping transformers.&quot;&quot;&quot;</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cast specific columns into the designated type.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        Args:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">            cols: dict with columns and respective target types.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">                Target types need to have the exact name of spark types:</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">                https://spark.apache.org/docs/latest/sql-ref-datatypes.html</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        Returns:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>            <span class="n">cast_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>                <span class="n">cast_df</span> <span class="o">=</span> <span class="n">cast_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">spark_types</span><span class="p">,</span> <span class="n">t</span><span class="p">)()))</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>            <span class="k">return</span> <span class="n">cast_df</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="nf">column_selector</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select specific columns with specific output aliases.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        Args:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">            cols: dict with columns to select and respective aliases.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        Returns:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">flatten_schema</span><span class="p">(</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="n">max_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="n">shorten_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="n">alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="n">num_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="n">ignore_cols</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten the schema of the dataframe.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">        Args:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            max_level: level until which you want to flatten the schema.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">                Default: None.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">            shorten_names: whether to shorten the names of the prefixes</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">                of the fields being flattened or not. Default: False.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">            alias: whether to define alias for the columns being flattened</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">                or not. Default: True.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">            num_chars: number of characters to consider when shortening</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">                the names of the fields. Default: 7.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">            ignore_cols: columns which you don&#39;t want to flatten.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">                Default: None.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        Returns:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>                <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">schema_flattener</span><span class="p">(</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                    <span class="n">schema</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                    <span class="n">max_level</span><span class="o">=</span><span class="n">max_level</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                    <span class="n">shorten_names</span><span class="o">=</span><span class="n">shorten_names</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                    <span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                    <span class="n">num_chars</span><span class="o">=</span><span class="n">num_chars</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                    <span class="n">ignore_cols</span><span class="o">=</span><span class="n">ignore_cols</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                <span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="k">def</span> <span class="nf">explode_columns</span><span class="p">(</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="n">explode_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="n">array_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="n">explode_maps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="n">map_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode columns with types like ArrayType and MapType.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        After it can be applied the flatten_schema transformation,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        if we desired for example to explode the map (as we explode a StructType)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        or to explode a StructType inside the array.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        We recommend you to specify always the columns desired to explode</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        and not explode all columns.</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        Args:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="sd">            explode_arrays: whether you want to explode array columns (True)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">                or not (False). Default: False.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            array_cols_to_explode: array columns which you want to explode.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">                If you don&#39;t specify it will get all array columns and explode them.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">                Default: None.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">            explode_maps: whether you want to explode map columns (True)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">                or not (False). Default: False.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">            map_cols_to_explode: map columns which you want to explode.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">                If you don&#39;t specify it will get all map columns and explode them.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">                Default: None.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        Returns:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="k">if</span> <span class="n">explode_arrays</span> <span class="ow">or</span> <span class="p">(</span><span class="n">array_cols_to_explode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_explode_arrays</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">array_cols_to_explode</span><span class="p">)</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="k">if</span> <span class="n">explode_maps</span> <span class="ow">or</span> <span class="p">(</span><span class="n">map_cols_to_explode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_explode_maps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">map_cols_to_explode</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="k">def</span> <span class="nf">_get_columns</span><span class="p">(</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of columns from the dataframe of the data types specified.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        Args:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">            df: input dataframe.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            data_type: data type specified.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Returns:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            List of columns with the datatype specified.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">data_type</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">cols</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">with_expressions</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols_and_exprs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute Spark SQL expressions to create the specified columns.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        This function uses the Spark expr function. [Check here](</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.expr.html).</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">        Args:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">            cols_and_exprs: dict with columns and respective expressions to compute</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">                (Spark SQL expressions).</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        Returns:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="n">enriched_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cols_and_exprs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>                <span class="n">enriched_df</span> <span class="o">=</span> <span class="n">enriched_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="k">return</span> <span class="n">enriched_df</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">escape_col_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename specific columns into the designated name.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a><span class="sd">        Args:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">            cols: dict with columns and respective target names.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            escape_col_names: whether to escape column names (e.g. `/BIC/COL1`) or not.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">                If True it creates a column with the new name and drop the old one.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">                If False, uses the native withColumnRenamed Spark function.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">                Default: True.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        Returns:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>            <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="k">if</span> <span class="n">escape_col_names</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">renamed_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">old_name</span><span class="p">))</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">renamed_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>                <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="k">return</span> <span class="n">renamed_df</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">from_avro</span><span class="p">(</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select all attributes from avro.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">        Args:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">            schema: the schema string.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">            key_col: the name of the key column.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">            value_col: the name of the value column.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            options: extra options (e.g., mode: &quot;PERMISSIVE&quot;).</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">            expand_key: whether you want to expand the content inside the key</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">                column or not. Default: false.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">            expand_value: whether you want to expand the content inside the value</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">                column or not. Default: true.</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        Returns:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="n">cols_to_select</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>                <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>            <span class="p">]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>                <span class="n">key_col</span><span class="p">,</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>                <span class="n">from_avro</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span> <span class="n">schema</span><span class="p">,</span> <span class="n">options</span> <span class="k">if</span> <span class="n">options</span> <span class="k">else</span> <span class="p">{})</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>                    <span class="n">value_col</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>                <span class="p">),</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_key</span> <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_value</span> <span class="k">else</span> <span class="n">value_col</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    <span class="k">def</span> <span class="nf">from_avro_with_registry</span><span class="p">(</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">schema_registry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="n">value_schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">key_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select all attributes from avro using a schema registry.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">        Args:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="sd">            schema_registry: the url to the schema registry.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">            value_schema: the name of the value schema entry in the schema registry.</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">            value_col: the name of the value column.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">            key_schema: the name of the key schema entry in the schema</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">                registry. Default: None.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">            key_col: the name of the key column.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">            expand_key: whether you want to expand the content inside the key</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">                column or not. Default: false.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">            expand_value: whether you want to expand the content inside the value</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">                column or not. Default: true.</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        Returns:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>            <span class="n">cols_to_select</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="p">]</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                <span class="n">from_avro</span><span class="p">(</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                    <span class="n">col</span><span class="p">(</span><span class="n">key_col</span><span class="p">),</span> <span class="n">key_schema</span><span class="p">,</span> <span class="n">schema_registry</span>  <span class="c1"># type: ignore</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">key_col</span><span class="p">)</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                <span class="k">if</span> <span class="n">key_schema</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                <span class="n">from_avro</span><span class="p">(</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                    <span class="n">col</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span> <span class="n">value_schema</span><span class="p">,</span> <span class="n">schema_registry</span>  <span class="c1"># type: ignore</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_key</span> <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_value</span> <span class="k">else</span> <span class="n">value_col</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">input_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">schema_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="n">drop_all_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">disable_dbfs_retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a json string into a json column (struct).</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">        The new json column can be added to the existing columns (default) or it can</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        replace all the others, being the only one to output. The new column gets the</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">        same name as the original one suffixed with &#39;_json&#39;.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">        Args:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            input_col: dict with columns and respective target names.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">            schema_path: path to the StructType schema (spark schema).</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            schema: dict with the StructType schema (spark schema).</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">            json_options: options to parse the json value.</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">            drop_all_cols: whether to drop all the input columns or not.</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a><span class="sd">                Defaults to False.</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">            disable_dbfs_retry: optional flag to disable file storage dbfs.</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">        Returns:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="k">if</span> <span class="n">schema_path</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="n">json_schema</span> <span class="o">=</span> <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">schema_path</span><span class="p">,</span> <span class="n">disable_dbfs_retry</span><span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="k">elif</span> <span class="n">schema</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="n">json_schema</span> <span class="o">=</span> <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                <span class="k">raise</span> <span class="n">WrongArgumentsException</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                    <span class="s2">&quot;A file or dict schema needs to be provided.&quot;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>            <span class="k">if</span> <span class="n">drop_all_cols</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                <span class="n">df_with_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                    <span class="n">from_json</span><span class="p">(</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                        <span class="n">col</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                        <span class="n">json_schema</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                        <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                <span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                <span class="n">df_with_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                    <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                    <span class="n">from_json</span><span class="p">(</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                        <span class="n">col</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                        <span class="n">json_schema</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                        <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                <span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="k">return</span> <span class="n">df_with_json</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">in_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">out_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataframe columns into a json value.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        Args:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">            in_cols: name(s) of the input column(s).</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">                Example values:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">                &quot;*&quot; - all</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">                columns; &quot;my_col&quot; - one column named &quot;my_col&quot;;</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">                &quot;my_col1, my_col2&quot; - two columns.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">            out_col: name of the output column.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">            json_options: options to parse the json value.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        Returns:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                <span class="n">out_col</span><span class="p">,</span> <span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="o">*</span><span class="n">in_cols</span><span class="p">),</span> <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{})</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>    <span class="k">def</span> <span class="nf">_explode_arrays</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode array columns from dataframe.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">        Args:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">            df: the dataframe to apply the explode operation.</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">            cols_to_explode: list of array columns to perform explode.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">        Returns:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">            A dataframe with array columns exploded.</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">cols_to_explode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">cols_to_explode</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">spark_types</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cols_to_explode</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">explode_outer</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>    <span class="k">def</span> <span class="nf">_explode_maps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode map columns from dataframe.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        Args:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">            df: the dataframe to apply the explode operation.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">            cols_to_explode: list of map columns to perform explode.</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">        Returns:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">            A dataframe with map columns exploded.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="k">if</span> <span class="n">cols_to_explode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="n">cols_to_explode</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">spark_types</span><span class="o">.</span><span class="n">MapType</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cols_to_explode</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">explode_outer</span><span class="p">(</span><span class="n">map_entries</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">))))</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


    </section>
        <section id="ColumnReshapers">
                    <input id="ColumnReshapers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ColumnReshapers</span>:

                <label class="view-source-button" for="ColumnReshapers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers-25"><a href="#ColumnReshapers-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">ColumnReshapers</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="ColumnReshapers-26"><a href="#ColumnReshapers-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing column reshaping transformers.&quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-27"><a href="#ColumnReshapers-27"><span class="linenos"> 27</span></a>
</span><span id="ColumnReshapers-28"><a href="#ColumnReshapers-28"><span class="linenos"> 28</span></a>    <span class="n">_logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="ColumnReshapers-29"><a href="#ColumnReshapers-29"><span class="linenos"> 29</span></a>
</span><span id="ColumnReshapers-30"><a href="#ColumnReshapers-30"><span class="linenos"> 30</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-31"><a href="#ColumnReshapers-31"><span class="linenos"> 31</span></a>    <span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-32"><a href="#ColumnReshapers-32"><span class="linenos"> 32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cast specific columns into the designated type.</span>
</span><span id="ColumnReshapers-33"><a href="#ColumnReshapers-33"><span class="linenos"> 33</span></a>
</span><span id="ColumnReshapers-34"><a href="#ColumnReshapers-34"><span class="linenos"> 34</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-35"><a href="#ColumnReshapers-35"><span class="linenos"> 35</span></a><span class="sd">            cols: dict with columns and respective target types.</span>
</span><span id="ColumnReshapers-36"><a href="#ColumnReshapers-36"><span class="linenos"> 36</span></a><span class="sd">                Target types need to have the exact name of spark types:</span>
</span><span id="ColumnReshapers-37"><a href="#ColumnReshapers-37"><span class="linenos"> 37</span></a><span class="sd">                https://spark.apache.org/docs/latest/sql-ref-datatypes.html</span>
</span><span id="ColumnReshapers-38"><a href="#ColumnReshapers-38"><span class="linenos"> 38</span></a>
</span><span id="ColumnReshapers-39"><a href="#ColumnReshapers-39"><span class="linenos"> 39</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-40"><a href="#ColumnReshapers-40"><span class="linenos"> 40</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-41"><a href="#ColumnReshapers-41"><span class="linenos"> 41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-42"><a href="#ColumnReshapers-42"><span class="linenos"> 42</span></a>
</span><span id="ColumnReshapers-43"><a href="#ColumnReshapers-43"><span class="linenos"> 43</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-44"><a href="#ColumnReshapers-44"><span class="linenos"> 44</span></a>            <span class="n">cast_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="ColumnReshapers-45"><a href="#ColumnReshapers-45"><span class="linenos"> 45</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers-46"><a href="#ColumnReshapers-46"><span class="linenos"> 46</span></a>                <span class="n">cast_df</span> <span class="o">=</span> <span class="n">cast_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">spark_types</span><span class="p">,</span> <span class="n">t</span><span class="p">)()))</span>
</span><span id="ColumnReshapers-47"><a href="#ColumnReshapers-47"><span class="linenos"> 47</span></a>
</span><span id="ColumnReshapers-48"><a href="#ColumnReshapers-48"><span class="linenos"> 48</span></a>            <span class="k">return</span> <span class="n">cast_df</span>
</span><span id="ColumnReshapers-49"><a href="#ColumnReshapers-49"><span class="linenos"> 49</span></a>
</span><span id="ColumnReshapers-50"><a href="#ColumnReshapers-50"><span class="linenos"> 50</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-51"><a href="#ColumnReshapers-51"><span class="linenos"> 51</span></a>
</span><span id="ColumnReshapers-52"><a href="#ColumnReshapers-52"><span class="linenos"> 52</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-53"><a href="#ColumnReshapers-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">column_selector</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-54"><a href="#ColumnReshapers-54"><span class="linenos"> 54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select specific columns with specific output aliases.</span>
</span><span id="ColumnReshapers-55"><a href="#ColumnReshapers-55"><span class="linenos"> 55</span></a>
</span><span id="ColumnReshapers-56"><a href="#ColumnReshapers-56"><span class="linenos"> 56</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-57"><a href="#ColumnReshapers-57"><span class="linenos"> 57</span></a><span class="sd">            cols: dict with columns to select and respective aliases.</span>
</span><span id="ColumnReshapers-58"><a href="#ColumnReshapers-58"><span class="linenos"> 58</span></a>
</span><span id="ColumnReshapers-59"><a href="#ColumnReshapers-59"><span class="linenos"> 59</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-60"><a href="#ColumnReshapers-60"><span class="linenos"> 60</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-61"><a href="#ColumnReshapers-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-62"><a href="#ColumnReshapers-62"><span class="linenos"> 62</span></a>
</span><span id="ColumnReshapers-63"><a href="#ColumnReshapers-63"><span class="linenos"> 63</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-64"><a href="#ColumnReshapers-64"><span class="linenos"> 64</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ColumnReshapers-65"><a href="#ColumnReshapers-65"><span class="linenos"> 65</span></a>
</span><span id="ColumnReshapers-66"><a href="#ColumnReshapers-66"><span class="linenos"> 66</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-67"><a href="#ColumnReshapers-67"><span class="linenos"> 67</span></a>
</span><span id="ColumnReshapers-68"><a href="#ColumnReshapers-68"><span class="linenos"> 68</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-69"><a href="#ColumnReshapers-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">flatten_schema</span><span class="p">(</span>
</span><span id="ColumnReshapers-70"><a href="#ColumnReshapers-70"><span class="linenos"> 70</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers-71"><a href="#ColumnReshapers-71"><span class="linenos"> 71</span></a>        <span class="n">max_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-72"><a href="#ColumnReshapers-72"><span class="linenos"> 72</span></a>        <span class="n">shorten_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-73"><a href="#ColumnReshapers-73"><span class="linenos"> 73</span></a>        <span class="n">alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ColumnReshapers-74"><a href="#ColumnReshapers-74"><span class="linenos"> 74</span></a>        <span class="n">num_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
</span><span id="ColumnReshapers-75"><a href="#ColumnReshapers-75"><span class="linenos"> 75</span></a>        <span class="n">ignore_cols</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-76"><a href="#ColumnReshapers-76"><span class="linenos"> 76</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-77"><a href="#ColumnReshapers-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten the schema of the dataframe.</span>
</span><span id="ColumnReshapers-78"><a href="#ColumnReshapers-78"><span class="linenos"> 78</span></a>
</span><span id="ColumnReshapers-79"><a href="#ColumnReshapers-79"><span class="linenos"> 79</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-80"><a href="#ColumnReshapers-80"><span class="linenos"> 80</span></a><span class="sd">            max_level: level until which you want to flatten the schema.</span>
</span><span id="ColumnReshapers-81"><a href="#ColumnReshapers-81"><span class="linenos"> 81</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers-82"><a href="#ColumnReshapers-82"><span class="linenos"> 82</span></a><span class="sd">            shorten_names: whether to shorten the names of the prefixes</span>
</span><span id="ColumnReshapers-83"><a href="#ColumnReshapers-83"><span class="linenos"> 83</span></a><span class="sd">                of the fields being flattened or not. Default: False.</span>
</span><span id="ColumnReshapers-84"><a href="#ColumnReshapers-84"><span class="linenos"> 84</span></a><span class="sd">            alias: whether to define alias for the columns being flattened</span>
</span><span id="ColumnReshapers-85"><a href="#ColumnReshapers-85"><span class="linenos"> 85</span></a><span class="sd">                or not. Default: True.</span>
</span><span id="ColumnReshapers-86"><a href="#ColumnReshapers-86"><span class="linenos"> 86</span></a><span class="sd">            num_chars: number of characters to consider when shortening</span>
</span><span id="ColumnReshapers-87"><a href="#ColumnReshapers-87"><span class="linenos"> 87</span></a><span class="sd">                the names of the fields. Default: 7.</span>
</span><span id="ColumnReshapers-88"><a href="#ColumnReshapers-88"><span class="linenos"> 88</span></a><span class="sd">            ignore_cols: columns which you don&#39;t want to flatten.</span>
</span><span id="ColumnReshapers-89"><a href="#ColumnReshapers-89"><span class="linenos"> 89</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers-90"><a href="#ColumnReshapers-90"><span class="linenos"> 90</span></a>
</span><span id="ColumnReshapers-91"><a href="#ColumnReshapers-91"><span class="linenos"> 91</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-92"><a href="#ColumnReshapers-92"><span class="linenos"> 92</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-93"><a href="#ColumnReshapers-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-94"><a href="#ColumnReshapers-94"><span class="linenos"> 94</span></a>
</span><span id="ColumnReshapers-95"><a href="#ColumnReshapers-95"><span class="linenos"> 95</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-96"><a href="#ColumnReshapers-96"><span class="linenos"> 96</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers-97"><a href="#ColumnReshapers-97"><span class="linenos"> 97</span></a>                <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">schema_flattener</span><span class="p">(</span>
</span><span id="ColumnReshapers-98"><a href="#ColumnReshapers-98"><span class="linenos"> 98</span></a>                    <span class="n">schema</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span id="ColumnReshapers-99"><a href="#ColumnReshapers-99"><span class="linenos"> 99</span></a>                    <span class="n">max_level</span><span class="o">=</span><span class="n">max_level</span><span class="p">,</span>
</span><span id="ColumnReshapers-100"><a href="#ColumnReshapers-100"><span class="linenos">100</span></a>                    <span class="n">shorten_names</span><span class="o">=</span><span class="n">shorten_names</span><span class="p">,</span>
</span><span id="ColumnReshapers-101"><a href="#ColumnReshapers-101"><span class="linenos">101</span></a>                    <span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">,</span>
</span><span id="ColumnReshapers-102"><a href="#ColumnReshapers-102"><span class="linenos">102</span></a>                    <span class="n">num_chars</span><span class="o">=</span><span class="n">num_chars</span><span class="p">,</span>
</span><span id="ColumnReshapers-103"><a href="#ColumnReshapers-103"><span class="linenos">103</span></a>                    <span class="n">ignore_cols</span><span class="o">=</span><span class="n">ignore_cols</span><span class="p">,</span>
</span><span id="ColumnReshapers-104"><a href="#ColumnReshapers-104"><span class="linenos">104</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers-105"><a href="#ColumnReshapers-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers-106"><a href="#ColumnReshapers-106"><span class="linenos">106</span></a>
</span><span id="ColumnReshapers-107"><a href="#ColumnReshapers-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-108"><a href="#ColumnReshapers-108"><span class="linenos">108</span></a>
</span><span id="ColumnReshapers-109"><a href="#ColumnReshapers-109"><span class="linenos">109</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-110"><a href="#ColumnReshapers-110"><span class="linenos">110</span></a>    <span class="k">def</span> <span class="nf">explode_columns</span><span class="p">(</span>
</span><span id="ColumnReshapers-111"><a href="#ColumnReshapers-111"><span class="linenos">111</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers-112"><a href="#ColumnReshapers-112"><span class="linenos">112</span></a>        <span class="n">explode_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-113"><a href="#ColumnReshapers-113"><span class="linenos">113</span></a>        <span class="n">array_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-114"><a href="#ColumnReshapers-114"><span class="linenos">114</span></a>        <span class="n">explode_maps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-115"><a href="#ColumnReshapers-115"><span class="linenos">115</span></a>        <span class="n">map_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-116"><a href="#ColumnReshapers-116"><span class="linenos">116</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-117"><a href="#ColumnReshapers-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode columns with types like ArrayType and MapType.</span>
</span><span id="ColumnReshapers-118"><a href="#ColumnReshapers-118"><span class="linenos">118</span></a>
</span><span id="ColumnReshapers-119"><a href="#ColumnReshapers-119"><span class="linenos">119</span></a><span class="sd">        After it can be applied the flatten_schema transformation,</span>
</span><span id="ColumnReshapers-120"><a href="#ColumnReshapers-120"><span class="linenos">120</span></a><span class="sd">        if we desired for example to explode the map (as we explode a StructType)</span>
</span><span id="ColumnReshapers-121"><a href="#ColumnReshapers-121"><span class="linenos">121</span></a><span class="sd">        or to explode a StructType inside the array.</span>
</span><span id="ColumnReshapers-122"><a href="#ColumnReshapers-122"><span class="linenos">122</span></a><span class="sd">        We recommend you to specify always the columns desired to explode</span>
</span><span id="ColumnReshapers-123"><a href="#ColumnReshapers-123"><span class="linenos">123</span></a><span class="sd">        and not explode all columns.</span>
</span><span id="ColumnReshapers-124"><a href="#ColumnReshapers-124"><span class="linenos">124</span></a>
</span><span id="ColumnReshapers-125"><a href="#ColumnReshapers-125"><span class="linenos">125</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-126"><a href="#ColumnReshapers-126"><span class="linenos">126</span></a><span class="sd">            explode_arrays: whether you want to explode array columns (True)</span>
</span><span id="ColumnReshapers-127"><a href="#ColumnReshapers-127"><span class="linenos">127</span></a><span class="sd">                or not (False). Default: False.</span>
</span><span id="ColumnReshapers-128"><a href="#ColumnReshapers-128"><span class="linenos">128</span></a><span class="sd">            array_cols_to_explode: array columns which you want to explode.</span>
</span><span id="ColumnReshapers-129"><a href="#ColumnReshapers-129"><span class="linenos">129</span></a><span class="sd">                If you don&#39;t specify it will get all array columns and explode them.</span>
</span><span id="ColumnReshapers-130"><a href="#ColumnReshapers-130"><span class="linenos">130</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers-131"><a href="#ColumnReshapers-131"><span class="linenos">131</span></a><span class="sd">            explode_maps: whether you want to explode map columns (True)</span>
</span><span id="ColumnReshapers-132"><a href="#ColumnReshapers-132"><span class="linenos">132</span></a><span class="sd">                or not (False). Default: False.</span>
</span><span id="ColumnReshapers-133"><a href="#ColumnReshapers-133"><span class="linenos">133</span></a><span class="sd">            map_cols_to_explode: map columns which you want to explode.</span>
</span><span id="ColumnReshapers-134"><a href="#ColumnReshapers-134"><span class="linenos">134</span></a><span class="sd">                If you don&#39;t specify it will get all map columns and explode them.</span>
</span><span id="ColumnReshapers-135"><a href="#ColumnReshapers-135"><span class="linenos">135</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers-136"><a href="#ColumnReshapers-136"><span class="linenos">136</span></a>
</span><span id="ColumnReshapers-137"><a href="#ColumnReshapers-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-138"><a href="#ColumnReshapers-138"><span class="linenos">138</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-139"><a href="#ColumnReshapers-139"><span class="linenos">139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-140"><a href="#ColumnReshapers-140"><span class="linenos">140</span></a>
</span><span id="ColumnReshapers-141"><a href="#ColumnReshapers-141"><span class="linenos">141</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-142"><a href="#ColumnReshapers-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="n">explode_arrays</span> <span class="ow">or</span> <span class="p">(</span><span class="n">array_cols_to_explode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ColumnReshapers-143"><a href="#ColumnReshapers-143"><span class="linenos">143</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_explode_arrays</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">array_cols_to_explode</span><span class="p">)</span>
</span><span id="ColumnReshapers-144"><a href="#ColumnReshapers-144"><span class="linenos">144</span></a>
</span><span id="ColumnReshapers-145"><a href="#ColumnReshapers-145"><span class="linenos">145</span></a>            <span class="k">if</span> <span class="n">explode_maps</span> <span class="ow">or</span> <span class="p">(</span><span class="n">map_cols_to_explode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ColumnReshapers-146"><a href="#ColumnReshapers-146"><span class="linenos">146</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_explode_maps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">map_cols_to_explode</span><span class="p">)</span>
</span><span id="ColumnReshapers-147"><a href="#ColumnReshapers-147"><span class="linenos">147</span></a>
</span><span id="ColumnReshapers-148"><a href="#ColumnReshapers-148"><span class="linenos">148</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="ColumnReshapers-149"><a href="#ColumnReshapers-149"><span class="linenos">149</span></a>
</span><span id="ColumnReshapers-150"><a href="#ColumnReshapers-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-151"><a href="#ColumnReshapers-151"><span class="linenos">151</span></a>
</span><span id="ColumnReshapers-152"><a href="#ColumnReshapers-152"><span class="linenos">152</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-153"><a href="#ColumnReshapers-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">_get_columns</span><span class="p">(</span>
</span><span id="ColumnReshapers-154"><a href="#ColumnReshapers-154"><span class="linenos">154</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers-155"><a href="#ColumnReshapers-155"><span class="linenos">155</span></a>        <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span>
</span><span id="ColumnReshapers-156"><a href="#ColumnReshapers-156"><span class="linenos">156</span></a>        <span class="n">data_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="ColumnReshapers-157"><a href="#ColumnReshapers-157"><span class="linenos">157</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="ColumnReshapers-158"><a href="#ColumnReshapers-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of columns from the dataframe of the data types specified.</span>
</span><span id="ColumnReshapers-159"><a href="#ColumnReshapers-159"><span class="linenos">159</span></a>
</span><span id="ColumnReshapers-160"><a href="#ColumnReshapers-160"><span class="linenos">160</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-161"><a href="#ColumnReshapers-161"><span class="linenos">161</span></a><span class="sd">            df: input dataframe.</span>
</span><span id="ColumnReshapers-162"><a href="#ColumnReshapers-162"><span class="linenos">162</span></a><span class="sd">            data_type: data type specified.</span>
</span><span id="ColumnReshapers-163"><a href="#ColumnReshapers-163"><span class="linenos">163</span></a>
</span><span id="ColumnReshapers-164"><a href="#ColumnReshapers-164"><span class="linenos">164</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-165"><a href="#ColumnReshapers-165"><span class="linenos">165</span></a><span class="sd">            List of columns with the datatype specified.</span>
</span><span id="ColumnReshapers-166"><a href="#ColumnReshapers-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-167"><a href="#ColumnReshapers-167"><span class="linenos">167</span></a>        <span class="n">cols</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ColumnReshapers-168"><a href="#ColumnReshapers-168"><span class="linenos">168</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
</span><span id="ColumnReshapers-169"><a href="#ColumnReshapers-169"><span class="linenos">169</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">dataType</span><span class="p">,</span> <span class="n">data_type</span><span class="p">):</span>
</span><span id="ColumnReshapers-170"><a href="#ColumnReshapers-170"><span class="linenos">170</span></a>                <span class="n">cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="ColumnReshapers-171"><a href="#ColumnReshapers-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="n">cols</span>
</span><span id="ColumnReshapers-172"><a href="#ColumnReshapers-172"><span class="linenos">172</span></a>
</span><span id="ColumnReshapers-173"><a href="#ColumnReshapers-173"><span class="linenos">173</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-174"><a href="#ColumnReshapers-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">with_expressions</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols_and_exprs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-175"><a href="#ColumnReshapers-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute Spark SQL expressions to create the specified columns.</span>
</span><span id="ColumnReshapers-176"><a href="#ColumnReshapers-176"><span class="linenos">176</span></a>
</span><span id="ColumnReshapers-177"><a href="#ColumnReshapers-177"><span class="linenos">177</span></a><span class="sd">        This function uses the Spark expr function. [Check here](</span>
</span><span id="ColumnReshapers-178"><a href="#ColumnReshapers-178"><span class="linenos">178</span></a><span class="sd">        https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.expr.html).</span>
</span><span id="ColumnReshapers-179"><a href="#ColumnReshapers-179"><span class="linenos">179</span></a>
</span><span id="ColumnReshapers-180"><a href="#ColumnReshapers-180"><span class="linenos">180</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-181"><a href="#ColumnReshapers-181"><span class="linenos">181</span></a><span class="sd">            cols_and_exprs: dict with columns and respective expressions to compute</span>
</span><span id="ColumnReshapers-182"><a href="#ColumnReshapers-182"><span class="linenos">182</span></a><span class="sd">                (Spark SQL expressions).</span>
</span><span id="ColumnReshapers-183"><a href="#ColumnReshapers-183"><span class="linenos">183</span></a>
</span><span id="ColumnReshapers-184"><a href="#ColumnReshapers-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-185"><a href="#ColumnReshapers-185"><span class="linenos">185</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-186"><a href="#ColumnReshapers-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-187"><a href="#ColumnReshapers-187"><span class="linenos">187</span></a>
</span><span id="ColumnReshapers-188"><a href="#ColumnReshapers-188"><span class="linenos">188</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-189"><a href="#ColumnReshapers-189"><span class="linenos">189</span></a>            <span class="n">enriched_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="ColumnReshapers-190"><a href="#ColumnReshapers-190"><span class="linenos">190</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cols_and_exprs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers-191"><a href="#ColumnReshapers-191"><span class="linenos">191</span></a>                <span class="n">enriched_df</span> <span class="o">=</span> <span class="n">enriched_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="ColumnReshapers-192"><a href="#ColumnReshapers-192"><span class="linenos">192</span></a>
</span><span id="ColumnReshapers-193"><a href="#ColumnReshapers-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="n">enriched_df</span>
</span><span id="ColumnReshapers-194"><a href="#ColumnReshapers-194"><span class="linenos">194</span></a>
</span><span id="ColumnReshapers-195"><a href="#ColumnReshapers-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-196"><a href="#ColumnReshapers-196"><span class="linenos">196</span></a>
</span><span id="ColumnReshapers-197"><a href="#ColumnReshapers-197"><span class="linenos">197</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-198"><a href="#ColumnReshapers-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">escape_col_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-199"><a href="#ColumnReshapers-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename specific columns into the designated name.</span>
</span><span id="ColumnReshapers-200"><a href="#ColumnReshapers-200"><span class="linenos">200</span></a>
</span><span id="ColumnReshapers-201"><a href="#ColumnReshapers-201"><span class="linenos">201</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-202"><a href="#ColumnReshapers-202"><span class="linenos">202</span></a><span class="sd">            cols: dict with columns and respective target names.</span>
</span><span id="ColumnReshapers-203"><a href="#ColumnReshapers-203"><span class="linenos">203</span></a><span class="sd">            escape_col_names: whether to escape column names (e.g. `/BIC/COL1`) or not.</span>
</span><span id="ColumnReshapers-204"><a href="#ColumnReshapers-204"><span class="linenos">204</span></a><span class="sd">                If True it creates a column with the new name and drop the old one.</span>
</span><span id="ColumnReshapers-205"><a href="#ColumnReshapers-205"><span class="linenos">205</span></a><span class="sd">                If False, uses the native withColumnRenamed Spark function.</span>
</span><span id="ColumnReshapers-206"><a href="#ColumnReshapers-206"><span class="linenos">206</span></a><span class="sd">                Default: True.</span>
</span><span id="ColumnReshapers-207"><a href="#ColumnReshapers-207"><span class="linenos">207</span></a>
</span><span id="ColumnReshapers-208"><a href="#ColumnReshapers-208"><span class="linenos">208</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-209"><a href="#ColumnReshapers-209"><span class="linenos">209</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-210"><a href="#ColumnReshapers-210"><span class="linenos">210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-211"><a href="#ColumnReshapers-211"><span class="linenos">211</span></a>
</span><span id="ColumnReshapers-212"><a href="#ColumnReshapers-212"><span class="linenos">212</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-213"><a href="#ColumnReshapers-213"><span class="linenos">213</span></a>            <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="ColumnReshapers-214"><a href="#ColumnReshapers-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">escape_col_names</span><span class="p">:</span>
</span><span id="ColumnReshapers-215"><a href="#ColumnReshapers-215"><span class="linenos">215</span></a>                <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers-216"><a href="#ColumnReshapers-216"><span class="linenos">216</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">renamed_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">old_name</span><span class="p">))</span>
</span><span id="ColumnReshapers-217"><a href="#ColumnReshapers-217"><span class="linenos">217</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">renamed_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
</span><span id="ColumnReshapers-218"><a href="#ColumnReshapers-218"><span class="linenos">218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ColumnReshapers-219"><a href="#ColumnReshapers-219"><span class="linenos">219</span></a>                <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers-220"><a href="#ColumnReshapers-220"><span class="linenos">220</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="ColumnReshapers-221"><a href="#ColumnReshapers-221"><span class="linenos">221</span></a>
</span><span id="ColumnReshapers-222"><a href="#ColumnReshapers-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">renamed_df</span>
</span><span id="ColumnReshapers-223"><a href="#ColumnReshapers-223"><span class="linenos">223</span></a>
</span><span id="ColumnReshapers-224"><a href="#ColumnReshapers-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-225"><a href="#ColumnReshapers-225"><span class="linenos">225</span></a>
</span><span id="ColumnReshapers-226"><a href="#ColumnReshapers-226"><span class="linenos">226</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-227"><a href="#ColumnReshapers-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">from_avro</span><span class="p">(</span>
</span><span id="ColumnReshapers-228"><a href="#ColumnReshapers-228"><span class="linenos">228</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers-229"><a href="#ColumnReshapers-229"><span class="linenos">229</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-230"><a href="#ColumnReshapers-230"><span class="linenos">230</span></a>        <span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers-231"><a href="#ColumnReshapers-231"><span class="linenos">231</span></a>        <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers-232"><a href="#ColumnReshapers-232"><span class="linenos">232</span></a>        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-233"><a href="#ColumnReshapers-233"><span class="linenos">233</span></a>        <span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-234"><a href="#ColumnReshapers-234"><span class="linenos">234</span></a>        <span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ColumnReshapers-235"><a href="#ColumnReshapers-235"><span class="linenos">235</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-236"><a href="#ColumnReshapers-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select all attributes from avro.</span>
</span><span id="ColumnReshapers-237"><a href="#ColumnReshapers-237"><span class="linenos">237</span></a>
</span><span id="ColumnReshapers-238"><a href="#ColumnReshapers-238"><span class="linenos">238</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-239"><a href="#ColumnReshapers-239"><span class="linenos">239</span></a><span class="sd">            schema: the schema string.</span>
</span><span id="ColumnReshapers-240"><a href="#ColumnReshapers-240"><span class="linenos">240</span></a><span class="sd">            key_col: the name of the key column.</span>
</span><span id="ColumnReshapers-241"><a href="#ColumnReshapers-241"><span class="linenos">241</span></a><span class="sd">            value_col: the name of the value column.</span>
</span><span id="ColumnReshapers-242"><a href="#ColumnReshapers-242"><span class="linenos">242</span></a><span class="sd">            options: extra options (e.g., mode: &quot;PERMISSIVE&quot;).</span>
</span><span id="ColumnReshapers-243"><a href="#ColumnReshapers-243"><span class="linenos">243</span></a><span class="sd">            expand_key: whether you want to expand the content inside the key</span>
</span><span id="ColumnReshapers-244"><a href="#ColumnReshapers-244"><span class="linenos">244</span></a><span class="sd">                column or not. Default: false.</span>
</span><span id="ColumnReshapers-245"><a href="#ColumnReshapers-245"><span class="linenos">245</span></a><span class="sd">            expand_value: whether you want to expand the content inside the value</span>
</span><span id="ColumnReshapers-246"><a href="#ColumnReshapers-246"><span class="linenos">246</span></a><span class="sd">                column or not. Default: true.</span>
</span><span id="ColumnReshapers-247"><a href="#ColumnReshapers-247"><span class="linenos">247</span></a>
</span><span id="ColumnReshapers-248"><a href="#ColumnReshapers-248"><span class="linenos">248</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-249"><a href="#ColumnReshapers-249"><span class="linenos">249</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-250"><a href="#ColumnReshapers-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-251"><a href="#ColumnReshapers-251"><span class="linenos">251</span></a>
</span><span id="ColumnReshapers-252"><a href="#ColumnReshapers-252"><span class="linenos">252</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-253"><a href="#ColumnReshapers-253"><span class="linenos">253</span></a>            <span class="n">cols_to_select</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ColumnReshapers-254"><a href="#ColumnReshapers-254"><span class="linenos">254</span></a>                <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
</span><span id="ColumnReshapers-255"><a href="#ColumnReshapers-255"><span class="linenos">255</span></a>            <span class="p">]</span>
</span><span id="ColumnReshapers-256"><a href="#ColumnReshapers-256"><span class="linenos">256</span></a>
</span><span id="ColumnReshapers-257"><a href="#ColumnReshapers-257"><span class="linenos">257</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers-258"><a href="#ColumnReshapers-258"><span class="linenos">258</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers-259"><a href="#ColumnReshapers-259"><span class="linenos">259</span></a>                <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers-260"><a href="#ColumnReshapers-260"><span class="linenos">260</span></a>                <span class="n">from_avro</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span> <span class="n">schema</span><span class="p">,</span> <span class="n">options</span> <span class="k">if</span> <span class="n">options</span> <span class="k">else</span> <span class="p">{})</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
</span><span id="ColumnReshapers-261"><a href="#ColumnReshapers-261"><span class="linenos">261</span></a>                    <span class="n">value_col</span>
</span><span id="ColumnReshapers-262"><a href="#ColumnReshapers-262"><span class="linenos">262</span></a>                <span class="p">),</span>
</span><span id="ColumnReshapers-263"><a href="#ColumnReshapers-263"><span class="linenos">263</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers-264"><a href="#ColumnReshapers-264"><span class="linenos">264</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers-265"><a href="#ColumnReshapers-265"><span class="linenos">265</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_key</span> <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers-266"><a href="#ColumnReshapers-266"><span class="linenos">266</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_value</span> <span class="k">else</span> <span class="n">value_col</span><span class="p">,</span>
</span><span id="ColumnReshapers-267"><a href="#ColumnReshapers-267"><span class="linenos">267</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers-268"><a href="#ColumnReshapers-268"><span class="linenos">268</span></a>
</span><span id="ColumnReshapers-269"><a href="#ColumnReshapers-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-270"><a href="#ColumnReshapers-270"><span class="linenos">270</span></a>
</span><span id="ColumnReshapers-271"><a href="#ColumnReshapers-271"><span class="linenos">271</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-272"><a href="#ColumnReshapers-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">from_avro_with_registry</span><span class="p">(</span>
</span><span id="ColumnReshapers-273"><a href="#ColumnReshapers-273"><span class="linenos">273</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers-274"><a href="#ColumnReshapers-274"><span class="linenos">274</span></a>        <span class="n">schema_registry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ColumnReshapers-275"><a href="#ColumnReshapers-275"><span class="linenos">275</span></a>        <span class="n">value_schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ColumnReshapers-276"><a href="#ColumnReshapers-276"><span class="linenos">276</span></a>        <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers-277"><a href="#ColumnReshapers-277"><span class="linenos">277</span></a>        <span class="n">key_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-278"><a href="#ColumnReshapers-278"><span class="linenos">278</span></a>        <span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers-279"><a href="#ColumnReshapers-279"><span class="linenos">279</span></a>        <span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-280"><a href="#ColumnReshapers-280"><span class="linenos">280</span></a>        <span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ColumnReshapers-281"><a href="#ColumnReshapers-281"><span class="linenos">281</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-282"><a href="#ColumnReshapers-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select all attributes from avro using a schema registry.</span>
</span><span id="ColumnReshapers-283"><a href="#ColumnReshapers-283"><span class="linenos">283</span></a>
</span><span id="ColumnReshapers-284"><a href="#ColumnReshapers-284"><span class="linenos">284</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-285"><a href="#ColumnReshapers-285"><span class="linenos">285</span></a><span class="sd">            schema_registry: the url to the schema registry.</span>
</span><span id="ColumnReshapers-286"><a href="#ColumnReshapers-286"><span class="linenos">286</span></a><span class="sd">            value_schema: the name of the value schema entry in the schema registry.</span>
</span><span id="ColumnReshapers-287"><a href="#ColumnReshapers-287"><span class="linenos">287</span></a><span class="sd">            value_col: the name of the value column.</span>
</span><span id="ColumnReshapers-288"><a href="#ColumnReshapers-288"><span class="linenos">288</span></a><span class="sd">            key_schema: the name of the key schema entry in the schema</span>
</span><span id="ColumnReshapers-289"><a href="#ColumnReshapers-289"><span class="linenos">289</span></a><span class="sd">                registry. Default: None.</span>
</span><span id="ColumnReshapers-290"><a href="#ColumnReshapers-290"><span class="linenos">290</span></a><span class="sd">            key_col: the name of the key column.</span>
</span><span id="ColumnReshapers-291"><a href="#ColumnReshapers-291"><span class="linenos">291</span></a><span class="sd">            expand_key: whether you want to expand the content inside the key</span>
</span><span id="ColumnReshapers-292"><a href="#ColumnReshapers-292"><span class="linenos">292</span></a><span class="sd">                column or not. Default: false.</span>
</span><span id="ColumnReshapers-293"><a href="#ColumnReshapers-293"><span class="linenos">293</span></a><span class="sd">            expand_value: whether you want to expand the content inside the value</span>
</span><span id="ColumnReshapers-294"><a href="#ColumnReshapers-294"><span class="linenos">294</span></a><span class="sd">                column or not. Default: true.</span>
</span><span id="ColumnReshapers-295"><a href="#ColumnReshapers-295"><span class="linenos">295</span></a>
</span><span id="ColumnReshapers-296"><a href="#ColumnReshapers-296"><span class="linenos">296</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-297"><a href="#ColumnReshapers-297"><span class="linenos">297</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-298"><a href="#ColumnReshapers-298"><span class="linenos">298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-299"><a href="#ColumnReshapers-299"><span class="linenos">299</span></a>
</span><span id="ColumnReshapers-300"><a href="#ColumnReshapers-300"><span class="linenos">300</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-301"><a href="#ColumnReshapers-301"><span class="linenos">301</span></a>            <span class="n">cols_to_select</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ColumnReshapers-302"><a href="#ColumnReshapers-302"><span class="linenos">302</span></a>                <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
</span><span id="ColumnReshapers-303"><a href="#ColumnReshapers-303"><span class="linenos">303</span></a>            <span class="p">]</span>
</span><span id="ColumnReshapers-304"><a href="#ColumnReshapers-304"><span class="linenos">304</span></a>
</span><span id="ColumnReshapers-305"><a href="#ColumnReshapers-305"><span class="linenos">305</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="ColumnReshapers-306"><a href="#ColumnReshapers-306"><span class="linenos">306</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers-307"><a href="#ColumnReshapers-307"><span class="linenos">307</span></a>                <span class="n">from_avro</span><span class="p">(</span>
</span><span id="ColumnReshapers-308"><a href="#ColumnReshapers-308"><span class="linenos">308</span></a>                    <span class="n">col</span><span class="p">(</span><span class="n">key_col</span><span class="p">),</span> <span class="n">key_schema</span><span class="p">,</span> <span class="n">schema_registry</span>  <span class="c1"># type: ignore</span>
</span><span id="ColumnReshapers-309"><a href="#ColumnReshapers-309"><span class="linenos">309</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">key_col</span><span class="p">)</span>
</span><span id="ColumnReshapers-310"><a href="#ColumnReshapers-310"><span class="linenos">310</span></a>                <span class="k">if</span> <span class="n">key_schema</span>
</span><span id="ColumnReshapers-311"><a href="#ColumnReshapers-311"><span class="linenos">311</span></a>                <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers-312"><a href="#ColumnReshapers-312"><span class="linenos">312</span></a>                <span class="n">from_avro</span><span class="p">(</span>
</span><span id="ColumnReshapers-313"><a href="#ColumnReshapers-313"><span class="linenos">313</span></a>                    <span class="n">col</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span> <span class="n">value_schema</span><span class="p">,</span> <span class="n">schema_registry</span>  <span class="c1"># type: ignore</span>
</span><span id="ColumnReshapers-314"><a href="#ColumnReshapers-314"><span class="linenos">314</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span>
</span><span id="ColumnReshapers-315"><a href="#ColumnReshapers-315"><span class="linenos">315</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers-316"><a href="#ColumnReshapers-316"><span class="linenos">316</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers-317"><a href="#ColumnReshapers-317"><span class="linenos">317</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_key</span> <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers-318"><a href="#ColumnReshapers-318"><span class="linenos">318</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_value</span> <span class="k">else</span> <span class="n">value_col</span><span class="p">,</span>
</span><span id="ColumnReshapers-319"><a href="#ColumnReshapers-319"><span class="linenos">319</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers-320"><a href="#ColumnReshapers-320"><span class="linenos">320</span></a>
</span><span id="ColumnReshapers-321"><a href="#ColumnReshapers-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-322"><a href="#ColumnReshapers-322"><span class="linenos">322</span></a>
</span><span id="ColumnReshapers-323"><a href="#ColumnReshapers-323"><span class="linenos">323</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-324"><a href="#ColumnReshapers-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span>
</span><span id="ColumnReshapers-325"><a href="#ColumnReshapers-325"><span class="linenos">325</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers-326"><a href="#ColumnReshapers-326"><span class="linenos">326</span></a>        <span class="n">input_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ColumnReshapers-327"><a href="#ColumnReshapers-327"><span class="linenos">327</span></a>        <span class="n">schema_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-328"><a href="#ColumnReshapers-328"><span class="linenos">328</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-329"><a href="#ColumnReshapers-329"><span class="linenos">329</span></a>        <span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers-330"><a href="#ColumnReshapers-330"><span class="linenos">330</span></a>        <span class="n">drop_all_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-331"><a href="#ColumnReshapers-331"><span class="linenos">331</span></a>        <span class="n">disable_dbfs_retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers-332"><a href="#ColumnReshapers-332"><span class="linenos">332</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-333"><a href="#ColumnReshapers-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a json string into a json column (struct).</span>
</span><span id="ColumnReshapers-334"><a href="#ColumnReshapers-334"><span class="linenos">334</span></a>
</span><span id="ColumnReshapers-335"><a href="#ColumnReshapers-335"><span class="linenos">335</span></a><span class="sd">        The new json column can be added to the existing columns (default) or it can</span>
</span><span id="ColumnReshapers-336"><a href="#ColumnReshapers-336"><span class="linenos">336</span></a><span class="sd">        replace all the others, being the only one to output. The new column gets the</span>
</span><span id="ColumnReshapers-337"><a href="#ColumnReshapers-337"><span class="linenos">337</span></a><span class="sd">        same name as the original one suffixed with &#39;_json&#39;.</span>
</span><span id="ColumnReshapers-338"><a href="#ColumnReshapers-338"><span class="linenos">338</span></a>
</span><span id="ColumnReshapers-339"><a href="#ColumnReshapers-339"><span class="linenos">339</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-340"><a href="#ColumnReshapers-340"><span class="linenos">340</span></a><span class="sd">            input_col: dict with columns and respective target names.</span>
</span><span id="ColumnReshapers-341"><a href="#ColumnReshapers-341"><span class="linenos">341</span></a><span class="sd">            schema_path: path to the StructType schema (spark schema).</span>
</span><span id="ColumnReshapers-342"><a href="#ColumnReshapers-342"><span class="linenos">342</span></a><span class="sd">            schema: dict with the StructType schema (spark schema).</span>
</span><span id="ColumnReshapers-343"><a href="#ColumnReshapers-343"><span class="linenos">343</span></a><span class="sd">            json_options: options to parse the json value.</span>
</span><span id="ColumnReshapers-344"><a href="#ColumnReshapers-344"><span class="linenos">344</span></a><span class="sd">            drop_all_cols: whether to drop all the input columns or not.</span>
</span><span id="ColumnReshapers-345"><a href="#ColumnReshapers-345"><span class="linenos">345</span></a><span class="sd">                Defaults to False.</span>
</span><span id="ColumnReshapers-346"><a href="#ColumnReshapers-346"><span class="linenos">346</span></a><span class="sd">            disable_dbfs_retry: optional flag to disable file storage dbfs.</span>
</span><span id="ColumnReshapers-347"><a href="#ColumnReshapers-347"><span class="linenos">347</span></a>
</span><span id="ColumnReshapers-348"><a href="#ColumnReshapers-348"><span class="linenos">348</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-349"><a href="#ColumnReshapers-349"><span class="linenos">349</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-350"><a href="#ColumnReshapers-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-351"><a href="#ColumnReshapers-351"><span class="linenos">351</span></a>
</span><span id="ColumnReshapers-352"><a href="#ColumnReshapers-352"><span class="linenos">352</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-353"><a href="#ColumnReshapers-353"><span class="linenos">353</span></a>            <span class="k">if</span> <span class="n">schema_path</span><span class="p">:</span>
</span><span id="ColumnReshapers-354"><a href="#ColumnReshapers-354"><span class="linenos">354</span></a>                <span class="n">json_schema</span> <span class="o">=</span> <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">schema_path</span><span class="p">,</span> <span class="n">disable_dbfs_retry</span><span class="p">)</span>
</span><span id="ColumnReshapers-355"><a href="#ColumnReshapers-355"><span class="linenos">355</span></a>            <span class="k">elif</span> <span class="n">schema</span><span class="p">:</span>
</span><span id="ColumnReshapers-356"><a href="#ColumnReshapers-356"><span class="linenos">356</span></a>                <span class="n">json_schema</span> <span class="o">=</span> <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="ColumnReshapers-357"><a href="#ColumnReshapers-357"><span class="linenos">357</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ColumnReshapers-358"><a href="#ColumnReshapers-358"><span class="linenos">358</span></a>                <span class="k">raise</span> <span class="n">WrongArgumentsException</span><span class="p">(</span>
</span><span id="ColumnReshapers-359"><a href="#ColumnReshapers-359"><span class="linenos">359</span></a>                    <span class="s2">&quot;A file or dict schema needs to be provided.&quot;</span>
</span><span id="ColumnReshapers-360"><a href="#ColumnReshapers-360"><span class="linenos">360</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers-361"><a href="#ColumnReshapers-361"><span class="linenos">361</span></a>
</span><span id="ColumnReshapers-362"><a href="#ColumnReshapers-362"><span class="linenos">362</span></a>            <span class="k">if</span> <span class="n">drop_all_cols</span><span class="p">:</span>
</span><span id="ColumnReshapers-363"><a href="#ColumnReshapers-363"><span class="linenos">363</span></a>                <span class="n">df_with_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers-364"><a href="#ColumnReshapers-364"><span class="linenos">364</span></a>                    <span class="n">from_json</span><span class="p">(</span>
</span><span id="ColumnReshapers-365"><a href="#ColumnReshapers-365"><span class="linenos">365</span></a>                        <span class="n">col</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="ColumnReshapers-366"><a href="#ColumnReshapers-366"><span class="linenos">366</span></a>                        <span class="n">json_schema</span><span class="p">,</span>
</span><span id="ColumnReshapers-367"><a href="#ColumnReshapers-367"><span class="linenos">367</span></a>                        <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="ColumnReshapers-368"><a href="#ColumnReshapers-368"><span class="linenos">368</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">)</span>
</span><span id="ColumnReshapers-369"><a href="#ColumnReshapers-369"><span class="linenos">369</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers-370"><a href="#ColumnReshapers-370"><span class="linenos">370</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ColumnReshapers-371"><a href="#ColumnReshapers-371"><span class="linenos">371</span></a>                <span class="n">df_with_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers-372"><a href="#ColumnReshapers-372"><span class="linenos">372</span></a>                    <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers-373"><a href="#ColumnReshapers-373"><span class="linenos">373</span></a>                    <span class="n">from_json</span><span class="p">(</span>
</span><span id="ColumnReshapers-374"><a href="#ColumnReshapers-374"><span class="linenos">374</span></a>                        <span class="n">col</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="ColumnReshapers-375"><a href="#ColumnReshapers-375"><span class="linenos">375</span></a>                        <span class="n">json_schema</span><span class="p">,</span>
</span><span id="ColumnReshapers-376"><a href="#ColumnReshapers-376"><span class="linenos">376</span></a>                        <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="ColumnReshapers-377"><a href="#ColumnReshapers-377"><span class="linenos">377</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="ColumnReshapers-378"><a href="#ColumnReshapers-378"><span class="linenos">378</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers-379"><a href="#ColumnReshapers-379"><span class="linenos">379</span></a>
</span><span id="ColumnReshapers-380"><a href="#ColumnReshapers-380"><span class="linenos">380</span></a>            <span class="k">return</span> <span class="n">df_with_json</span>
</span><span id="ColumnReshapers-381"><a href="#ColumnReshapers-381"><span class="linenos">381</span></a>
</span><span id="ColumnReshapers-382"><a href="#ColumnReshapers-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-383"><a href="#ColumnReshapers-383"><span class="linenos">383</span></a>
</span><span id="ColumnReshapers-384"><a href="#ColumnReshapers-384"><span class="linenos">384</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-385"><a href="#ColumnReshapers-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span>
</span><span id="ColumnReshapers-386"><a href="#ColumnReshapers-386"><span class="linenos">386</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">in_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">out_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ColumnReshapers-387"><a href="#ColumnReshapers-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers-388"><a href="#ColumnReshapers-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataframe columns into a json value.</span>
</span><span id="ColumnReshapers-389"><a href="#ColumnReshapers-389"><span class="linenos">389</span></a>
</span><span id="ColumnReshapers-390"><a href="#ColumnReshapers-390"><span class="linenos">390</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-391"><a href="#ColumnReshapers-391"><span class="linenos">391</span></a><span class="sd">            in_cols: name(s) of the input column(s).</span>
</span><span id="ColumnReshapers-392"><a href="#ColumnReshapers-392"><span class="linenos">392</span></a><span class="sd">                Example values:</span>
</span><span id="ColumnReshapers-393"><a href="#ColumnReshapers-393"><span class="linenos">393</span></a><span class="sd">                &quot;*&quot; - all</span>
</span><span id="ColumnReshapers-394"><a href="#ColumnReshapers-394"><span class="linenos">394</span></a><span class="sd">                columns; &quot;my_col&quot; - one column named &quot;my_col&quot;;</span>
</span><span id="ColumnReshapers-395"><a href="#ColumnReshapers-395"><span class="linenos">395</span></a><span class="sd">                &quot;my_col1, my_col2&quot; - two columns.</span>
</span><span id="ColumnReshapers-396"><a href="#ColumnReshapers-396"><span class="linenos">396</span></a><span class="sd">            out_col: name of the output column.</span>
</span><span id="ColumnReshapers-397"><a href="#ColumnReshapers-397"><span class="linenos">397</span></a><span class="sd">            json_options: options to parse the json value.</span>
</span><span id="ColumnReshapers-398"><a href="#ColumnReshapers-398"><span class="linenos">398</span></a>
</span><span id="ColumnReshapers-399"><a href="#ColumnReshapers-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-400"><a href="#ColumnReshapers-400"><span class="linenos">400</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers-401"><a href="#ColumnReshapers-401"><span class="linenos">401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-402"><a href="#ColumnReshapers-402"><span class="linenos">402</span></a>
</span><span id="ColumnReshapers-403"><a href="#ColumnReshapers-403"><span class="linenos">403</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-404"><a href="#ColumnReshapers-404"><span class="linenos">404</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="ColumnReshapers-405"><a href="#ColumnReshapers-405"><span class="linenos">405</span></a>                <span class="n">out_col</span><span class="p">,</span> <span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="o">*</span><span class="n">in_cols</span><span class="p">),</span> <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{})</span>
</span><span id="ColumnReshapers-406"><a href="#ColumnReshapers-406"><span class="linenos">406</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers-407"><a href="#ColumnReshapers-407"><span class="linenos">407</span></a>
</span><span id="ColumnReshapers-408"><a href="#ColumnReshapers-408"><span class="linenos">408</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span><span id="ColumnReshapers-409"><a href="#ColumnReshapers-409"><span class="linenos">409</span></a>
</span><span id="ColumnReshapers-410"><a href="#ColumnReshapers-410"><span class="linenos">410</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-411"><a href="#ColumnReshapers-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">_explode_arrays</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-412"><a href="#ColumnReshapers-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode array columns from dataframe.</span>
</span><span id="ColumnReshapers-413"><a href="#ColumnReshapers-413"><span class="linenos">413</span></a>
</span><span id="ColumnReshapers-414"><a href="#ColumnReshapers-414"><span class="linenos">414</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-415"><a href="#ColumnReshapers-415"><span class="linenos">415</span></a><span class="sd">            df: the dataframe to apply the explode operation.</span>
</span><span id="ColumnReshapers-416"><a href="#ColumnReshapers-416"><span class="linenos">416</span></a><span class="sd">            cols_to_explode: list of array columns to perform explode.</span>
</span><span id="ColumnReshapers-417"><a href="#ColumnReshapers-417"><span class="linenos">417</span></a>
</span><span id="ColumnReshapers-418"><a href="#ColumnReshapers-418"><span class="linenos">418</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-419"><a href="#ColumnReshapers-419"><span class="linenos">419</span></a><span class="sd">            A dataframe with array columns exploded.</span>
</span><span id="ColumnReshapers-420"><a href="#ColumnReshapers-420"><span class="linenos">420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-421"><a href="#ColumnReshapers-421"><span class="linenos">421</span></a>        <span class="k">if</span> <span class="n">cols_to_explode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ColumnReshapers-422"><a href="#ColumnReshapers-422"><span class="linenos">422</span></a>            <span class="n">cols_to_explode</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">spark_types</span><span class="o">.</span><span class="n">ArrayType</span><span class="p">)</span>
</span><span id="ColumnReshapers-423"><a href="#ColumnReshapers-423"><span class="linenos">423</span></a>
</span><span id="ColumnReshapers-424"><a href="#ColumnReshapers-424"><span class="linenos">424</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cols_to_explode</span><span class="p">:</span>
</span><span id="ColumnReshapers-425"><a href="#ColumnReshapers-425"><span class="linenos">425</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">explode_outer</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
</span><span id="ColumnReshapers-426"><a href="#ColumnReshapers-426"><span class="linenos">426</span></a>
</span><span id="ColumnReshapers-427"><a href="#ColumnReshapers-427"><span class="linenos">427</span></a>        <span class="k">return</span> <span class="n">df</span>
</span><span id="ColumnReshapers-428"><a href="#ColumnReshapers-428"><span class="linenos">428</span></a>
</span><span id="ColumnReshapers-429"><a href="#ColumnReshapers-429"><span class="linenos">429</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers-430"><a href="#ColumnReshapers-430"><span class="linenos">430</span></a>    <span class="k">def</span> <span class="nf">_explode_maps</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers-431"><a href="#ColumnReshapers-431"><span class="linenos">431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode map columns from dataframe.</span>
</span><span id="ColumnReshapers-432"><a href="#ColumnReshapers-432"><span class="linenos">432</span></a>
</span><span id="ColumnReshapers-433"><a href="#ColumnReshapers-433"><span class="linenos">433</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers-434"><a href="#ColumnReshapers-434"><span class="linenos">434</span></a><span class="sd">            df: the dataframe to apply the explode operation.</span>
</span><span id="ColumnReshapers-435"><a href="#ColumnReshapers-435"><span class="linenos">435</span></a><span class="sd">            cols_to_explode: list of map columns to perform explode.</span>
</span><span id="ColumnReshapers-436"><a href="#ColumnReshapers-436"><span class="linenos">436</span></a>
</span><span id="ColumnReshapers-437"><a href="#ColumnReshapers-437"><span class="linenos">437</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers-438"><a href="#ColumnReshapers-438"><span class="linenos">438</span></a><span class="sd">            A dataframe with map columns exploded.</span>
</span><span id="ColumnReshapers-439"><a href="#ColumnReshapers-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers-440"><a href="#ColumnReshapers-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="n">cols_to_explode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ColumnReshapers-441"><a href="#ColumnReshapers-441"><span class="linenos">441</span></a>            <span class="n">cols_to_explode</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">spark_types</span><span class="o">.</span><span class="n">MapType</span><span class="p">)</span>
</span><span id="ColumnReshapers-442"><a href="#ColumnReshapers-442"><span class="linenos">442</span></a>
</span><span id="ColumnReshapers-443"><a href="#ColumnReshapers-443"><span class="linenos">443</span></a>        <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">cols_to_explode</span><span class="p">:</span>
</span><span id="ColumnReshapers-444"><a href="#ColumnReshapers-444"><span class="linenos">444</span></a>            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="n">explode_outer</span><span class="p">(</span><span class="n">map_entries</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">))))</span>
</span><span id="ColumnReshapers-445"><a href="#ColumnReshapers-445"><span class="linenos">445</span></a>
</span><span id="ColumnReshapers-446"><a href="#ColumnReshapers-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">df</span>
</span></pre></div>


            <div class="docstring"><p>Class containing column reshaping transformers.</p>
</div>


                    <div id="ColumnReshapers.cast" class="classattr">
                                <input id="ColumnReshapers.cast-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">cast</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.cast-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.cast"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.cast-30"><a href="#ColumnReshapers.cast-30"><span class="linenos">30</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.cast-31"><a href="#ColumnReshapers.cast-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.cast-32"><a href="#ColumnReshapers.cast-32"><span class="linenos">32</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cast specific columns into the designated type.</span>
</span><span id="ColumnReshapers.cast-33"><a href="#ColumnReshapers.cast-33"><span class="linenos">33</span></a>
</span><span id="ColumnReshapers.cast-34"><a href="#ColumnReshapers.cast-34"><span class="linenos">34</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.cast-35"><a href="#ColumnReshapers.cast-35"><span class="linenos">35</span></a><span class="sd">            cols: dict with columns and respective target types.</span>
</span><span id="ColumnReshapers.cast-36"><a href="#ColumnReshapers.cast-36"><span class="linenos">36</span></a><span class="sd">                Target types need to have the exact name of spark types:</span>
</span><span id="ColumnReshapers.cast-37"><a href="#ColumnReshapers.cast-37"><span class="linenos">37</span></a><span class="sd">                https://spark.apache.org/docs/latest/sql-ref-datatypes.html</span>
</span><span id="ColumnReshapers.cast-38"><a href="#ColumnReshapers.cast-38"><span class="linenos">38</span></a>
</span><span id="ColumnReshapers.cast-39"><a href="#ColumnReshapers.cast-39"><span class="linenos">39</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.cast-40"><a href="#ColumnReshapers.cast-40"><span class="linenos">40</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.cast-41"><a href="#ColumnReshapers.cast-41"><span class="linenos">41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.cast-42"><a href="#ColumnReshapers.cast-42"><span class="linenos">42</span></a>
</span><span id="ColumnReshapers.cast-43"><a href="#ColumnReshapers.cast-43"><span class="linenos">43</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.cast-44"><a href="#ColumnReshapers.cast-44"><span class="linenos">44</span></a>            <span class="n">cast_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="ColumnReshapers.cast-45"><a href="#ColumnReshapers.cast-45"><span class="linenos">45</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers.cast-46"><a href="#ColumnReshapers.cast-46"><span class="linenos">46</span></a>                <span class="n">cast_df</span> <span class="o">=</span> <span class="n">cast_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">spark_types</span><span class="p">,</span> <span class="n">t</span><span class="p">)()))</span>
</span><span id="ColumnReshapers.cast-47"><a href="#ColumnReshapers.cast-47"><span class="linenos">47</span></a>
</span><span id="ColumnReshapers.cast-48"><a href="#ColumnReshapers.cast-48"><span class="linenos">48</span></a>            <span class="k">return</span> <span class="n">cast_df</span>
</span><span id="ColumnReshapers.cast-49"><a href="#ColumnReshapers.cast-49"><span class="linenos">49</span></a>
</span><span id="ColumnReshapers.cast-50"><a href="#ColumnReshapers.cast-50"><span class="linenos">50</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Cast specific columns into the designated type.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>cols:</strong>  dict with columns and respective target types.
Target types need to have the exact name of spark types:
<a href="https://spark.apache.org/docs/latest/sql-ref-datatypes.html">https://spark.apache.org/docs/latest/sql-ref-datatypes.html</a></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-38"><span class="linenos">38</span></a><span class="p">{</span>
<a href="#-39"><span class="linenos">39</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cast&quot;</span><span class="p">,</span>
<a href="#-40"><span class="linenos">40</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-41"><span class="linenos">41</span></a><span class="w">        </span><span class="nt">&quot;cols&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-42"><span class="linenos">42</span></a><span class="w">            </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;StringType&quot;</span>
<a href="#-43"><span class="linenos">43</span></a><span class="w">        </span><span class="p">}</span>
<a href="#-44"><span class="linenos">44</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-45"><span class="linenos">45</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/schema_evolution/delta_load/batch_delta_disabled.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
                    <div id="ColumnReshapers.column_selector" class="classattr">
                                <input id="ColumnReshapers.column_selector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">column_selector</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">cols</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.column_selector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.column_selector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.column_selector-52"><a href="#ColumnReshapers.column_selector-52"><span class="linenos">52</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.column_selector-53"><a href="#ColumnReshapers.column_selector-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">column_selector</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.column_selector-54"><a href="#ColumnReshapers.column_selector-54"><span class="linenos">54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select specific columns with specific output aliases.</span>
</span><span id="ColumnReshapers.column_selector-55"><a href="#ColumnReshapers.column_selector-55"><span class="linenos">55</span></a>
</span><span id="ColumnReshapers.column_selector-56"><a href="#ColumnReshapers.column_selector-56"><span class="linenos">56</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.column_selector-57"><a href="#ColumnReshapers.column_selector-57"><span class="linenos">57</span></a><span class="sd">            cols: dict with columns to select and respective aliases.</span>
</span><span id="ColumnReshapers.column_selector-58"><a href="#ColumnReshapers.column_selector-58"><span class="linenos">58</span></a>
</span><span id="ColumnReshapers.column_selector-59"><a href="#ColumnReshapers.column_selector-59"><span class="linenos">59</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.column_selector-60"><a href="#ColumnReshapers.column_selector-60"><span class="linenos">60</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.column_selector-61"><a href="#ColumnReshapers.column_selector-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.column_selector-62"><a href="#ColumnReshapers.column_selector-62"><span class="linenos">62</span></a>
</span><span id="ColumnReshapers.column_selector-63"><a href="#ColumnReshapers.column_selector-63"><span class="linenos">63</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.column_selector-64"><a href="#ColumnReshapers.column_selector-64"><span class="linenos">64</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="ColumnReshapers.column_selector-65"><a href="#ColumnReshapers.column_selector-65"><span class="linenos">65</span></a>
</span><span id="ColumnReshapers.column_selector-66"><a href="#ColumnReshapers.column_selector-66"><span class="linenos">66</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Select specific columns with specific output aliases.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>cols:</strong>  dict with columns to select and respective aliases.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                    </div>
                    <div id="ColumnReshapers.flatten_schema" class="classattr">
                                <input id="ColumnReshapers.flatten_schema-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">flatten_schema</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">max_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">shorten_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">num_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span>,</span><span class="param">	<span class="n">ignore_cols</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.flatten_schema-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.flatten_schema"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.flatten_schema-68"><a href="#ColumnReshapers.flatten_schema-68"><span class="linenos"> 68</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.flatten_schema-69"><a href="#ColumnReshapers.flatten_schema-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">flatten_schema</span><span class="p">(</span>
</span><span id="ColumnReshapers.flatten_schema-70"><a href="#ColumnReshapers.flatten_schema-70"><span class="linenos"> 70</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-71"><a href="#ColumnReshapers.flatten_schema-71"><span class="linenos"> 71</span></a>        <span class="n">max_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-72"><a href="#ColumnReshapers.flatten_schema-72"><span class="linenos"> 72</span></a>        <span class="n">shorten_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-73"><a href="#ColumnReshapers.flatten_schema-73"><span class="linenos"> 73</span></a>        <span class="n">alias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-74"><a href="#ColumnReshapers.flatten_schema-74"><span class="linenos"> 74</span></a>        <span class="n">num_chars</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-75"><a href="#ColumnReshapers.flatten_schema-75"><span class="linenos"> 75</span></a>        <span class="n">ignore_cols</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-76"><a href="#ColumnReshapers.flatten_schema-76"><span class="linenos"> 76</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.flatten_schema-77"><a href="#ColumnReshapers.flatten_schema-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten the schema of the dataframe.</span>
</span><span id="ColumnReshapers.flatten_schema-78"><a href="#ColumnReshapers.flatten_schema-78"><span class="linenos"> 78</span></a>
</span><span id="ColumnReshapers.flatten_schema-79"><a href="#ColumnReshapers.flatten_schema-79"><span class="linenos"> 79</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.flatten_schema-80"><a href="#ColumnReshapers.flatten_schema-80"><span class="linenos"> 80</span></a><span class="sd">            max_level: level until which you want to flatten the schema.</span>
</span><span id="ColumnReshapers.flatten_schema-81"><a href="#ColumnReshapers.flatten_schema-81"><span class="linenos"> 81</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers.flatten_schema-82"><a href="#ColumnReshapers.flatten_schema-82"><span class="linenos"> 82</span></a><span class="sd">            shorten_names: whether to shorten the names of the prefixes</span>
</span><span id="ColumnReshapers.flatten_schema-83"><a href="#ColumnReshapers.flatten_schema-83"><span class="linenos"> 83</span></a><span class="sd">                of the fields being flattened or not. Default: False.</span>
</span><span id="ColumnReshapers.flatten_schema-84"><a href="#ColumnReshapers.flatten_schema-84"><span class="linenos"> 84</span></a><span class="sd">            alias: whether to define alias for the columns being flattened</span>
</span><span id="ColumnReshapers.flatten_schema-85"><a href="#ColumnReshapers.flatten_schema-85"><span class="linenos"> 85</span></a><span class="sd">                or not. Default: True.</span>
</span><span id="ColumnReshapers.flatten_schema-86"><a href="#ColumnReshapers.flatten_schema-86"><span class="linenos"> 86</span></a><span class="sd">            num_chars: number of characters to consider when shortening</span>
</span><span id="ColumnReshapers.flatten_schema-87"><a href="#ColumnReshapers.flatten_schema-87"><span class="linenos"> 87</span></a><span class="sd">                the names of the fields. Default: 7.</span>
</span><span id="ColumnReshapers.flatten_schema-88"><a href="#ColumnReshapers.flatten_schema-88"><span class="linenos"> 88</span></a><span class="sd">            ignore_cols: columns which you don&#39;t want to flatten.</span>
</span><span id="ColumnReshapers.flatten_schema-89"><a href="#ColumnReshapers.flatten_schema-89"><span class="linenos"> 89</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers.flatten_schema-90"><a href="#ColumnReshapers.flatten_schema-90"><span class="linenos"> 90</span></a>
</span><span id="ColumnReshapers.flatten_schema-91"><a href="#ColumnReshapers.flatten_schema-91"><span class="linenos"> 91</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.flatten_schema-92"><a href="#ColumnReshapers.flatten_schema-92"><span class="linenos"> 92</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.flatten_schema-93"><a href="#ColumnReshapers.flatten_schema-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.flatten_schema-94"><a href="#ColumnReshapers.flatten_schema-94"><span class="linenos"> 94</span></a>
</span><span id="ColumnReshapers.flatten_schema-95"><a href="#ColumnReshapers.flatten_schema-95"><span class="linenos"> 95</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.flatten_schema-96"><a href="#ColumnReshapers.flatten_schema-96"><span class="linenos"> 96</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers.flatten_schema-97"><a href="#ColumnReshapers.flatten_schema-97"><span class="linenos"> 97</span></a>                <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">schema_flattener</span><span class="p">(</span>
</span><span id="ColumnReshapers.flatten_schema-98"><a href="#ColumnReshapers.flatten_schema-98"><span class="linenos"> 98</span></a>                    <span class="n">schema</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-99"><a href="#ColumnReshapers.flatten_schema-99"><span class="linenos"> 99</span></a>                    <span class="n">max_level</span><span class="o">=</span><span class="n">max_level</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-100"><a href="#ColumnReshapers.flatten_schema-100"><span class="linenos">100</span></a>                    <span class="n">shorten_names</span><span class="o">=</span><span class="n">shorten_names</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-101"><a href="#ColumnReshapers.flatten_schema-101"><span class="linenos">101</span></a>                    <span class="n">alias</span><span class="o">=</span><span class="n">alias</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-102"><a href="#ColumnReshapers.flatten_schema-102"><span class="linenos">102</span></a>                    <span class="n">num_chars</span><span class="o">=</span><span class="n">num_chars</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-103"><a href="#ColumnReshapers.flatten_schema-103"><span class="linenos">103</span></a>                    <span class="n">ignore_cols</span><span class="o">=</span><span class="n">ignore_cols</span><span class="p">,</span>
</span><span id="ColumnReshapers.flatten_schema-104"><a href="#ColumnReshapers.flatten_schema-104"><span class="linenos">104</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers.flatten_schema-105"><a href="#ColumnReshapers.flatten_schema-105"><span class="linenos">105</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers.flatten_schema-106"><a href="#ColumnReshapers.flatten_schema-106"><span class="linenos">106</span></a>
</span><span id="ColumnReshapers.flatten_schema-107"><a href="#ColumnReshapers.flatten_schema-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Flatten the schema of the dataframe.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>max_level:</strong>  level until which you want to flatten the schema.
Default: None.</li>
<li><strong>shorten_names:</strong>  whether to shorten the names of the prefixes
of the fields being flattened or not. Default: False.</li>
<li><strong>alias:</strong>  whether to define alias for the columns being flattened
or not. Default: True.</li>
<li><strong>num_chars:</strong>  number of characters to consider when shortening
the names of the fields. Default: 7.</li>
<li><strong>ignore_cols:</strong>  columns which you don't want to flatten.
Default: None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-95"><span class="linenos"> 95</span></a><span class="p">{</span>
<a href="#-96"><span class="linenos"> 96</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;flatten_schema&quot;</span><span class="p">,</span>
<a href="#-97"><span class="linenos"> 97</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="nt">&quot;max_level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<a href="#-99"><span class="linenos"> 99</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-100"><span class="linenos">100</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/transformations/column_reshapers/flatten_schema/batch.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
                    <div id="ColumnReshapers.explode_columns" class="classattr">
                                <input id="ColumnReshapers.explode_columns-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">explode_columns</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">explode_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">array_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">explode_maps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">map_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.explode_columns-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.explode_columns"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.explode_columns-109"><a href="#ColumnReshapers.explode_columns-109"><span class="linenos">109</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.explode_columns-110"><a href="#ColumnReshapers.explode_columns-110"><span class="linenos">110</span></a>    <span class="k">def</span> <span class="nf">explode_columns</span><span class="p">(</span>
</span><span id="ColumnReshapers.explode_columns-111"><a href="#ColumnReshapers.explode_columns-111"><span class="linenos">111</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers.explode_columns-112"><a href="#ColumnReshapers.explode_columns-112"><span class="linenos">112</span></a>        <span class="n">explode_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.explode_columns-113"><a href="#ColumnReshapers.explode_columns-113"><span class="linenos">113</span></a>        <span class="n">array_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.explode_columns-114"><a href="#ColumnReshapers.explode_columns-114"><span class="linenos">114</span></a>        <span class="n">explode_maps</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.explode_columns-115"><a href="#ColumnReshapers.explode_columns-115"><span class="linenos">115</span></a>        <span class="n">map_cols_to_explode</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.explode_columns-116"><a href="#ColumnReshapers.explode_columns-116"><span class="linenos">116</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.explode_columns-117"><a href="#ColumnReshapers.explode_columns-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Explode columns with types like ArrayType and MapType.</span>
</span><span id="ColumnReshapers.explode_columns-118"><a href="#ColumnReshapers.explode_columns-118"><span class="linenos">118</span></a>
</span><span id="ColumnReshapers.explode_columns-119"><a href="#ColumnReshapers.explode_columns-119"><span class="linenos">119</span></a><span class="sd">        After it can be applied the flatten_schema transformation,</span>
</span><span id="ColumnReshapers.explode_columns-120"><a href="#ColumnReshapers.explode_columns-120"><span class="linenos">120</span></a><span class="sd">        if we desired for example to explode the map (as we explode a StructType)</span>
</span><span id="ColumnReshapers.explode_columns-121"><a href="#ColumnReshapers.explode_columns-121"><span class="linenos">121</span></a><span class="sd">        or to explode a StructType inside the array.</span>
</span><span id="ColumnReshapers.explode_columns-122"><a href="#ColumnReshapers.explode_columns-122"><span class="linenos">122</span></a><span class="sd">        We recommend you to specify always the columns desired to explode</span>
</span><span id="ColumnReshapers.explode_columns-123"><a href="#ColumnReshapers.explode_columns-123"><span class="linenos">123</span></a><span class="sd">        and not explode all columns.</span>
</span><span id="ColumnReshapers.explode_columns-124"><a href="#ColumnReshapers.explode_columns-124"><span class="linenos">124</span></a>
</span><span id="ColumnReshapers.explode_columns-125"><a href="#ColumnReshapers.explode_columns-125"><span class="linenos">125</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.explode_columns-126"><a href="#ColumnReshapers.explode_columns-126"><span class="linenos">126</span></a><span class="sd">            explode_arrays: whether you want to explode array columns (True)</span>
</span><span id="ColumnReshapers.explode_columns-127"><a href="#ColumnReshapers.explode_columns-127"><span class="linenos">127</span></a><span class="sd">                or not (False). Default: False.</span>
</span><span id="ColumnReshapers.explode_columns-128"><a href="#ColumnReshapers.explode_columns-128"><span class="linenos">128</span></a><span class="sd">            array_cols_to_explode: array columns which you want to explode.</span>
</span><span id="ColumnReshapers.explode_columns-129"><a href="#ColumnReshapers.explode_columns-129"><span class="linenos">129</span></a><span class="sd">                If you don&#39;t specify it will get all array columns and explode them.</span>
</span><span id="ColumnReshapers.explode_columns-130"><a href="#ColumnReshapers.explode_columns-130"><span class="linenos">130</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers.explode_columns-131"><a href="#ColumnReshapers.explode_columns-131"><span class="linenos">131</span></a><span class="sd">            explode_maps: whether you want to explode map columns (True)</span>
</span><span id="ColumnReshapers.explode_columns-132"><a href="#ColumnReshapers.explode_columns-132"><span class="linenos">132</span></a><span class="sd">                or not (False). Default: False.</span>
</span><span id="ColumnReshapers.explode_columns-133"><a href="#ColumnReshapers.explode_columns-133"><span class="linenos">133</span></a><span class="sd">            map_cols_to_explode: map columns which you want to explode.</span>
</span><span id="ColumnReshapers.explode_columns-134"><a href="#ColumnReshapers.explode_columns-134"><span class="linenos">134</span></a><span class="sd">                If you don&#39;t specify it will get all map columns and explode them.</span>
</span><span id="ColumnReshapers.explode_columns-135"><a href="#ColumnReshapers.explode_columns-135"><span class="linenos">135</span></a><span class="sd">                Default: None.</span>
</span><span id="ColumnReshapers.explode_columns-136"><a href="#ColumnReshapers.explode_columns-136"><span class="linenos">136</span></a>
</span><span id="ColumnReshapers.explode_columns-137"><a href="#ColumnReshapers.explode_columns-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.explode_columns-138"><a href="#ColumnReshapers.explode_columns-138"><span class="linenos">138</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.explode_columns-139"><a href="#ColumnReshapers.explode_columns-139"><span class="linenos">139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.explode_columns-140"><a href="#ColumnReshapers.explode_columns-140"><span class="linenos">140</span></a>
</span><span id="ColumnReshapers.explode_columns-141"><a href="#ColumnReshapers.explode_columns-141"><span class="linenos">141</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.explode_columns-142"><a href="#ColumnReshapers.explode_columns-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="n">explode_arrays</span> <span class="ow">or</span> <span class="p">(</span><span class="n">array_cols_to_explode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ColumnReshapers.explode_columns-143"><a href="#ColumnReshapers.explode_columns-143"><span class="linenos">143</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_explode_arrays</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">array_cols_to_explode</span><span class="p">)</span>
</span><span id="ColumnReshapers.explode_columns-144"><a href="#ColumnReshapers.explode_columns-144"><span class="linenos">144</span></a>
</span><span id="ColumnReshapers.explode_columns-145"><a href="#ColumnReshapers.explode_columns-145"><span class="linenos">145</span></a>            <span class="k">if</span> <span class="n">explode_maps</span> <span class="ow">or</span> <span class="p">(</span><span class="n">map_cols_to_explode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="ColumnReshapers.explode_columns-146"><a href="#ColumnReshapers.explode_columns-146"><span class="linenos">146</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_explode_maps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">map_cols_to_explode</span><span class="p">)</span>
</span><span id="ColumnReshapers.explode_columns-147"><a href="#ColumnReshapers.explode_columns-147"><span class="linenos">147</span></a>
</span><span id="ColumnReshapers.explode_columns-148"><a href="#ColumnReshapers.explode_columns-148"><span class="linenos">148</span></a>            <span class="k">return</span> <span class="n">df</span>
</span><span id="ColumnReshapers.explode_columns-149"><a href="#ColumnReshapers.explode_columns-149"><span class="linenos">149</span></a>
</span><span id="ColumnReshapers.explode_columns-150"><a href="#ColumnReshapers.explode_columns-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Explode columns with types like ArrayType and MapType.</p>

<p>After it can be applied the flatten_schema transformation,
if we desired for example to explode the map (as we explode a StructType)
or to explode a StructType inside the array.
We recommend you to specify always the columns desired to explode
and not explode all columns.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>explode_arrays:</strong>  whether you want to explode array columns (True)
or not (False). Default: False.</li>
<li><strong>array_cols_to_explode:</strong>  array columns which you want to explode.
If you don't specify it will get all array columns and explode them.
Default: None.</li>
<li><strong>explode_maps:</strong>  whether you want to explode map columns (True)
or not (False). Default: False.</li>
<li><strong>map_cols_to_explode:</strong>  map columns which you want to explode.
If you don't specify it will get all map columns and explode them.
Default: None.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-44"><span class="linenos">44</span></a><span class="p">{</span>
<a href="#-45"><span class="linenos">45</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;explode_columns&quot;</span><span class="p">,</span>
<a href="#-46"><span class="linenos">46</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-47"><span class="linenos">47</span></a><span class="w">        </span><span class="nt">&quot;explode_arrays&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<a href="#-48"><span class="linenos">48</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-49"><span class="linenos">49</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/transformations/column_reshapers/explode_arrays/batch.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
                    <div id="ColumnReshapers.with_expressions" class="classattr">
                                <input id="ColumnReshapers.with_expressions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">with_expressions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">cols_and_exprs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.with_expressions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.with_expressions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.with_expressions-173"><a href="#ColumnReshapers.with_expressions-173"><span class="linenos">173</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.with_expressions-174"><a href="#ColumnReshapers.with_expressions-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">with_expressions</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols_and_exprs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.with_expressions-175"><a href="#ColumnReshapers.with_expressions-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute Spark SQL expressions to create the specified columns.</span>
</span><span id="ColumnReshapers.with_expressions-176"><a href="#ColumnReshapers.with_expressions-176"><span class="linenos">176</span></a>
</span><span id="ColumnReshapers.with_expressions-177"><a href="#ColumnReshapers.with_expressions-177"><span class="linenos">177</span></a><span class="sd">        This function uses the Spark expr function. [Check here](</span>
</span><span id="ColumnReshapers.with_expressions-178"><a href="#ColumnReshapers.with_expressions-178"><span class="linenos">178</span></a><span class="sd">        https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.expr.html).</span>
</span><span id="ColumnReshapers.with_expressions-179"><a href="#ColumnReshapers.with_expressions-179"><span class="linenos">179</span></a>
</span><span id="ColumnReshapers.with_expressions-180"><a href="#ColumnReshapers.with_expressions-180"><span class="linenos">180</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.with_expressions-181"><a href="#ColumnReshapers.with_expressions-181"><span class="linenos">181</span></a><span class="sd">            cols_and_exprs: dict with columns and respective expressions to compute</span>
</span><span id="ColumnReshapers.with_expressions-182"><a href="#ColumnReshapers.with_expressions-182"><span class="linenos">182</span></a><span class="sd">                (Spark SQL expressions).</span>
</span><span id="ColumnReshapers.with_expressions-183"><a href="#ColumnReshapers.with_expressions-183"><span class="linenos">183</span></a>
</span><span id="ColumnReshapers.with_expressions-184"><a href="#ColumnReshapers.with_expressions-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.with_expressions-185"><a href="#ColumnReshapers.with_expressions-185"><span class="linenos">185</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.with_expressions-186"><a href="#ColumnReshapers.with_expressions-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.with_expressions-187"><a href="#ColumnReshapers.with_expressions-187"><span class="linenos">187</span></a>
</span><span id="ColumnReshapers.with_expressions-188"><a href="#ColumnReshapers.with_expressions-188"><span class="linenos">188</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.with_expressions-189"><a href="#ColumnReshapers.with_expressions-189"><span class="linenos">189</span></a>            <span class="n">enriched_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="ColumnReshapers.with_expressions-190"><a href="#ColumnReshapers.with_expressions-190"><span class="linenos">190</span></a>            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">cols_and_exprs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers.with_expressions-191"><a href="#ColumnReshapers.with_expressions-191"><span class="linenos">191</span></a>                <span class="n">enriched_df</span> <span class="o">=</span> <span class="n">enriched_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">expr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span><span id="ColumnReshapers.with_expressions-192"><a href="#ColumnReshapers.with_expressions-192"><span class="linenos">192</span></a>
</span><span id="ColumnReshapers.with_expressions-193"><a href="#ColumnReshapers.with_expressions-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="n">enriched_df</span>
</span><span id="ColumnReshapers.with_expressions-194"><a href="#ColumnReshapers.with_expressions-194"><span class="linenos">194</span></a>
</span><span id="ColumnReshapers.with_expressions-195"><a href="#ColumnReshapers.with_expressions-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Execute Spark SQL expressions to create the specified columns.</p>

<p>This function uses the Spark expr function. <a href="https://spark.apache.org/docs/latest/api/python/reference/pyspark.sql/api/pyspark.sql.functions.expr.html">Check here</a>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>cols_and_exprs:</strong>  dict with columns and respective expressions to compute
(Spark SQL expressions).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-25"><span class="linenos">25</span></a><span class="p">{</span>
<a href="#-26"><span class="linenos">26</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;with_expressions&quot;</span><span class="p">,</span>
<a href="#-27"><span class="linenos">27</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-28"><span class="linenos">28</span></a><span class="w">        </span><span class="nt">&quot;cols_and_exprs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-29"><span class="linenos">29</span></a><span class="w">            </span><span class="nt">&quot;constant&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&#39;just a constant&#39;&quot;</span><span class="p">,</span>
<a href="#-30"><span class="linenos">30</span></a><span class="w">            </span><span class="nt">&quot;length_customer2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;length(customer2)&quot;</span>
<a href="#-31"><span class="linenos">31</span></a><span class="w">        </span><span class="p">}</span>
<a href="#-32"><span class="linenos">32</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-33"><span class="linenos">33</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/transformations/column_reshapers/flatten_schema/batch.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
                    <div id="ColumnReshapers.rename" class="classattr">
                                <input id="ColumnReshapers.rename-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">rename</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="n">escape_col_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.rename-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.rename"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.rename-197"><a href="#ColumnReshapers.rename-197"><span class="linenos">197</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.rename-198"><a href="#ColumnReshapers.rename-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">escape_col_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.rename-199"><a href="#ColumnReshapers.rename-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename specific columns into the designated name.</span>
</span><span id="ColumnReshapers.rename-200"><a href="#ColumnReshapers.rename-200"><span class="linenos">200</span></a>
</span><span id="ColumnReshapers.rename-201"><a href="#ColumnReshapers.rename-201"><span class="linenos">201</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.rename-202"><a href="#ColumnReshapers.rename-202"><span class="linenos">202</span></a><span class="sd">            cols: dict with columns and respective target names.</span>
</span><span id="ColumnReshapers.rename-203"><a href="#ColumnReshapers.rename-203"><span class="linenos">203</span></a><span class="sd">            escape_col_names: whether to escape column names (e.g. `/BIC/COL1`) or not.</span>
</span><span id="ColumnReshapers.rename-204"><a href="#ColumnReshapers.rename-204"><span class="linenos">204</span></a><span class="sd">                If True it creates a column with the new name and drop the old one.</span>
</span><span id="ColumnReshapers.rename-205"><a href="#ColumnReshapers.rename-205"><span class="linenos">205</span></a><span class="sd">                If False, uses the native withColumnRenamed Spark function.</span>
</span><span id="ColumnReshapers.rename-206"><a href="#ColumnReshapers.rename-206"><span class="linenos">206</span></a><span class="sd">                Default: True.</span>
</span><span id="ColumnReshapers.rename-207"><a href="#ColumnReshapers.rename-207"><span class="linenos">207</span></a>
</span><span id="ColumnReshapers.rename-208"><a href="#ColumnReshapers.rename-208"><span class="linenos">208</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.rename-209"><a href="#ColumnReshapers.rename-209"><span class="linenos">209</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.rename-210"><a href="#ColumnReshapers.rename-210"><span class="linenos">210</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.rename-211"><a href="#ColumnReshapers.rename-211"><span class="linenos">211</span></a>
</span><span id="ColumnReshapers.rename-212"><a href="#ColumnReshapers.rename-212"><span class="linenos">212</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.rename-213"><a href="#ColumnReshapers.rename-213"><span class="linenos">213</span></a>            <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">df</span>
</span><span id="ColumnReshapers.rename-214"><a href="#ColumnReshapers.rename-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="n">escape_col_names</span><span class="p">:</span>
</span><span id="ColumnReshapers.rename-215"><a href="#ColumnReshapers.rename-215"><span class="linenos">215</span></a>                <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers.rename-216"><a href="#ColumnReshapers.rename-216"><span class="linenos">216</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">renamed_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">col</span><span class="p">(</span><span class="n">old_name</span><span class="p">))</span>
</span><span id="ColumnReshapers.rename-217"><a href="#ColumnReshapers.rename-217"><span class="linenos">217</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">renamed_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">old_name</span><span class="p">)</span>
</span><span id="ColumnReshapers.rename-218"><a href="#ColumnReshapers.rename-218"><span class="linenos">218</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ColumnReshapers.rename-219"><a href="#ColumnReshapers.rename-219"><span class="linenos">219</span></a>                <span class="k">for</span> <span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ColumnReshapers.rename-220"><a href="#ColumnReshapers.rename-220"><span class="linenos">220</span></a>                    <span class="n">renamed_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumnRenamed</span><span class="p">(</span><span class="n">old_name</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="ColumnReshapers.rename-221"><a href="#ColumnReshapers.rename-221"><span class="linenos">221</span></a>
</span><span id="ColumnReshapers.rename-222"><a href="#ColumnReshapers.rename-222"><span class="linenos">222</span></a>            <span class="k">return</span> <span class="n">renamed_df</span>
</span><span id="ColumnReshapers.rename-223"><a href="#ColumnReshapers.rename-223"><span class="linenos">223</span></a>
</span><span id="ColumnReshapers.rename-224"><a href="#ColumnReshapers.rename-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Rename specific columns into the designated name.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>cols:</strong>  dict with columns and respective target names.</li>
<li><strong>escape_col_names:</strong>  whether to escape column names (e.g. <code>/BIC/COL1</code>) or not.
If True it creates a column with the new name and drop the old one.
If False, uses the native withColumnRenamed Spark function.
Default: True.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-37"><span class="linenos">37</span></a><span class="p">{</span>
<a href="#-38"><span class="linenos">38</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rename&quot;</span><span class="p">,</span>
<a href="#-39"><span class="linenos">39</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-40"><span class="linenos">40</span></a><span class="w">        </span><span class="nt">&quot;cols&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-41"><span class="linenos">41</span></a><span class="w">            </span><span class="nt">&quot;ARTICLE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;article&quot;</span>
<a href="#-42"><span class="linenos">42</span></a><span class="w">        </span><span class="p">}</span>
<a href="#-43"><span class="linenos">43</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-44"><span class="linenos">44</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/schema_evolution/append_load/batch_append_disabled.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
                    <div id="ColumnReshapers.from_avro" class="classattr">
                                <input id="ColumnReshapers.from_avro-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_avro</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;key&#39;</span>,</span><span class="param">	<span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.from_avro-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.from_avro"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.from_avro-226"><a href="#ColumnReshapers.from_avro-226"><span class="linenos">226</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.from_avro-227"><a href="#ColumnReshapers.from_avro-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">from_avro</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro-228"><a href="#ColumnReshapers.from_avro-228"><span class="linenos">228</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-229"><a href="#ColumnReshapers.from_avro-229"><span class="linenos">229</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-230"><a href="#ColumnReshapers.from_avro-230"><span class="linenos">230</span></a>        <span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-231"><a href="#ColumnReshapers.from_avro-231"><span class="linenos">231</span></a>        <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-232"><a href="#ColumnReshapers.from_avro-232"><span class="linenos">232</span></a>        <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-233"><a href="#ColumnReshapers.from_avro-233"><span class="linenos">233</span></a>        <span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-234"><a href="#ColumnReshapers.from_avro-234"><span class="linenos">234</span></a>        <span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-235"><a href="#ColumnReshapers.from_avro-235"><span class="linenos">235</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_avro-236"><a href="#ColumnReshapers.from_avro-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select all attributes from avro.</span>
</span><span id="ColumnReshapers.from_avro-237"><a href="#ColumnReshapers.from_avro-237"><span class="linenos">237</span></a>
</span><span id="ColumnReshapers.from_avro-238"><a href="#ColumnReshapers.from_avro-238"><span class="linenos">238</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.from_avro-239"><a href="#ColumnReshapers.from_avro-239"><span class="linenos">239</span></a><span class="sd">            schema: the schema string.</span>
</span><span id="ColumnReshapers.from_avro-240"><a href="#ColumnReshapers.from_avro-240"><span class="linenos">240</span></a><span class="sd">            key_col: the name of the key column.</span>
</span><span id="ColumnReshapers.from_avro-241"><a href="#ColumnReshapers.from_avro-241"><span class="linenos">241</span></a><span class="sd">            value_col: the name of the value column.</span>
</span><span id="ColumnReshapers.from_avro-242"><a href="#ColumnReshapers.from_avro-242"><span class="linenos">242</span></a><span class="sd">            options: extra options (e.g., mode: &quot;PERMISSIVE&quot;).</span>
</span><span id="ColumnReshapers.from_avro-243"><a href="#ColumnReshapers.from_avro-243"><span class="linenos">243</span></a><span class="sd">            expand_key: whether you want to expand the content inside the key</span>
</span><span id="ColumnReshapers.from_avro-244"><a href="#ColumnReshapers.from_avro-244"><span class="linenos">244</span></a><span class="sd">                column or not. Default: false.</span>
</span><span id="ColumnReshapers.from_avro-245"><a href="#ColumnReshapers.from_avro-245"><span class="linenos">245</span></a><span class="sd">            expand_value: whether you want to expand the content inside the value</span>
</span><span id="ColumnReshapers.from_avro-246"><a href="#ColumnReshapers.from_avro-246"><span class="linenos">246</span></a><span class="sd">                column or not. Default: true.</span>
</span><span id="ColumnReshapers.from_avro-247"><a href="#ColumnReshapers.from_avro-247"><span class="linenos">247</span></a>
</span><span id="ColumnReshapers.from_avro-248"><a href="#ColumnReshapers.from_avro-248"><span class="linenos">248</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.from_avro-249"><a href="#ColumnReshapers.from_avro-249"><span class="linenos">249</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.from_avro-250"><a href="#ColumnReshapers.from_avro-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.from_avro-251"><a href="#ColumnReshapers.from_avro-251"><span class="linenos">251</span></a>
</span><span id="ColumnReshapers.from_avro-252"><a href="#ColumnReshapers.from_avro-252"><span class="linenos">252</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_avro-253"><a href="#ColumnReshapers.from_avro-253"><span class="linenos">253</span></a>            <span class="n">cols_to_select</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ColumnReshapers.from_avro-254"><a href="#ColumnReshapers.from_avro-254"><span class="linenos">254</span></a>                <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
</span><span id="ColumnReshapers.from_avro-255"><a href="#ColumnReshapers.from_avro-255"><span class="linenos">255</span></a>            <span class="p">]</span>
</span><span id="ColumnReshapers.from_avro-256"><a href="#ColumnReshapers.from_avro-256"><span class="linenos">256</span></a>
</span><span id="ColumnReshapers.from_avro-257"><a href="#ColumnReshapers.from_avro-257"><span class="linenos">257</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro-258"><a href="#ColumnReshapers.from_avro-258"><span class="linenos">258</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-259"><a href="#ColumnReshapers.from_avro-259"><span class="linenos">259</span></a>                <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-260"><a href="#ColumnReshapers.from_avro-260"><span class="linenos">260</span></a>                <span class="n">from_avro</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span> <span class="n">schema</span><span class="p">,</span> <span class="n">options</span> <span class="k">if</span> <span class="n">options</span> <span class="k">else</span> <span class="p">{})</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro-261"><a href="#ColumnReshapers.from_avro-261"><span class="linenos">261</span></a>                    <span class="n">value_col</span>
</span><span id="ColumnReshapers.from_avro-262"><a href="#ColumnReshapers.from_avro-262"><span class="linenos">262</span></a>                <span class="p">),</span>
</span><span id="ColumnReshapers.from_avro-263"><a href="#ColumnReshapers.from_avro-263"><span class="linenos">263</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro-264"><a href="#ColumnReshapers.from_avro-264"><span class="linenos">264</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-265"><a href="#ColumnReshapers.from_avro-265"><span class="linenos">265</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_key</span> <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-266"><a href="#ColumnReshapers.from_avro-266"><span class="linenos">266</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_value</span> <span class="k">else</span> <span class="n">value_col</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro-267"><a href="#ColumnReshapers.from_avro-267"><span class="linenos">267</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers.from_avro-268"><a href="#ColumnReshapers.from_avro-268"><span class="linenos">268</span></a>
</span><span id="ColumnReshapers.from_avro-269"><a href="#ColumnReshapers.from_avro-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Select all attributes from avro.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>schema:</strong>  the schema string.</li>
<li><strong>key_col:</strong>  the name of the key column.</li>
<li><strong>value_col:</strong>  the name of the value column.</li>
<li><strong>options:</strong>  extra options (e.g., mode: "PERMISSIVE").</li>
<li><strong>expand_key:</strong>  whether you want to expand the content inside the key
column or not. Default: false.</li>
<li><strong>expand_value:</strong>  whether you want to expand the content inside the value
column or not. Default: true.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Function to be called in .transform() spark function.</p>
</blockquote>
</div>


                    </div>
                    <div id="ColumnReshapers.from_avro_with_registry" class="classattr">
                                <input id="ColumnReshapers.from_avro_with_registry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_avro_with_registry</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">schema_registry</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">value_schema</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>,</span><span class="param">	<span class="n">key_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;key&#39;</span>,</span><span class="param">	<span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.from_avro_with_registry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.from_avro_with_registry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.from_avro_with_registry-271"><a href="#ColumnReshapers.from_avro_with_registry-271"><span class="linenos">271</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.from_avro_with_registry-272"><a href="#ColumnReshapers.from_avro_with_registry-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">from_avro_with_registry</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro_with_registry-273"><a href="#ColumnReshapers.from_avro_with_registry-273"><span class="linenos">273</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-274"><a href="#ColumnReshapers.from_avro_with_registry-274"><span class="linenos">274</span></a>        <span class="n">schema_registry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-275"><a href="#ColumnReshapers.from_avro_with_registry-275"><span class="linenos">275</span></a>        <span class="n">value_schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-276"><a href="#ColumnReshapers.from_avro_with_registry-276"><span class="linenos">276</span></a>        <span class="n">value_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-277"><a href="#ColumnReshapers.from_avro_with_registry-277"><span class="linenos">277</span></a>        <span class="n">key_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-278"><a href="#ColumnReshapers.from_avro_with_registry-278"><span class="linenos">278</span></a>        <span class="n">key_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-279"><a href="#ColumnReshapers.from_avro_with_registry-279"><span class="linenos">279</span></a>        <span class="n">expand_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-280"><a href="#ColumnReshapers.from_avro_with_registry-280"><span class="linenos">280</span></a>        <span class="n">expand_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-281"><a href="#ColumnReshapers.from_avro_with_registry-281"><span class="linenos">281</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_avro_with_registry-282"><a href="#ColumnReshapers.from_avro_with_registry-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Select all attributes from avro using a schema registry.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-283"><a href="#ColumnReshapers.from_avro_with_registry-283"><span class="linenos">283</span></a>
</span><span id="ColumnReshapers.from_avro_with_registry-284"><a href="#ColumnReshapers.from_avro_with_registry-284"><span class="linenos">284</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.from_avro_with_registry-285"><a href="#ColumnReshapers.from_avro_with_registry-285"><span class="linenos">285</span></a><span class="sd">            schema_registry: the url to the schema registry.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-286"><a href="#ColumnReshapers.from_avro_with_registry-286"><span class="linenos">286</span></a><span class="sd">            value_schema: the name of the value schema entry in the schema registry.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-287"><a href="#ColumnReshapers.from_avro_with_registry-287"><span class="linenos">287</span></a><span class="sd">            value_col: the name of the value column.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-288"><a href="#ColumnReshapers.from_avro_with_registry-288"><span class="linenos">288</span></a><span class="sd">            key_schema: the name of the key schema entry in the schema</span>
</span><span id="ColumnReshapers.from_avro_with_registry-289"><a href="#ColumnReshapers.from_avro_with_registry-289"><span class="linenos">289</span></a><span class="sd">                registry. Default: None.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-290"><a href="#ColumnReshapers.from_avro_with_registry-290"><span class="linenos">290</span></a><span class="sd">            key_col: the name of the key column.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-291"><a href="#ColumnReshapers.from_avro_with_registry-291"><span class="linenos">291</span></a><span class="sd">            expand_key: whether you want to expand the content inside the key</span>
</span><span id="ColumnReshapers.from_avro_with_registry-292"><a href="#ColumnReshapers.from_avro_with_registry-292"><span class="linenos">292</span></a><span class="sd">                column or not. Default: false.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-293"><a href="#ColumnReshapers.from_avro_with_registry-293"><span class="linenos">293</span></a><span class="sd">            expand_value: whether you want to expand the content inside the value</span>
</span><span id="ColumnReshapers.from_avro_with_registry-294"><a href="#ColumnReshapers.from_avro_with_registry-294"><span class="linenos">294</span></a><span class="sd">                column or not. Default: true.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-295"><a href="#ColumnReshapers.from_avro_with_registry-295"><span class="linenos">295</span></a>
</span><span id="ColumnReshapers.from_avro_with_registry-296"><a href="#ColumnReshapers.from_avro_with_registry-296"><span class="linenos">296</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.from_avro_with_registry-297"><a href="#ColumnReshapers.from_avro_with_registry-297"><span class="linenos">297</span></a><span class="sd">            Function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.from_avro_with_registry-298"><a href="#ColumnReshapers.from_avro_with_registry-298"><span class="linenos">298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.from_avro_with_registry-299"><a href="#ColumnReshapers.from_avro_with_registry-299"><span class="linenos">299</span></a>
</span><span id="ColumnReshapers.from_avro_with_registry-300"><a href="#ColumnReshapers.from_avro_with_registry-300"><span class="linenos">300</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_avro_with_registry-301"><a href="#ColumnReshapers.from_avro_with_registry-301"><span class="linenos">301</span></a>            <span class="n">cols_to_select</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ColumnReshapers.from_avro_with_registry-302"><a href="#ColumnReshapers.from_avro_with_registry-302"><span class="linenos">302</span></a>                <span class="n">column</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key_col</span><span class="p">,</span> <span class="n">value_col</span><span class="p">]</span>
</span><span id="ColumnReshapers.from_avro_with_registry-303"><a href="#ColumnReshapers.from_avro_with_registry-303"><span class="linenos">303</span></a>            <span class="p">]</span>
</span><span id="ColumnReshapers.from_avro_with_registry-304"><a href="#ColumnReshapers.from_avro_with_registry-304"><span class="linenos">304</span></a>
</span><span id="ColumnReshapers.from_avro_with_registry-305"><a href="#ColumnReshapers.from_avro_with_registry-305"><span class="linenos">305</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="ColumnReshapers.from_avro_with_registry-306"><a href="#ColumnReshapers.from_avro_with_registry-306"><span class="linenos">306</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-307"><a href="#ColumnReshapers.from_avro_with_registry-307"><span class="linenos">307</span></a>                <span class="n">from_avro</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro_with_registry-308"><a href="#ColumnReshapers.from_avro_with_registry-308"><span class="linenos">308</span></a>                    <span class="n">col</span><span class="p">(</span><span class="n">key_col</span><span class="p">),</span> <span class="n">key_schema</span><span class="p">,</span> <span class="n">schema_registry</span>  <span class="c1"># type: ignore</span>
</span><span id="ColumnReshapers.from_avro_with_registry-309"><a href="#ColumnReshapers.from_avro_with_registry-309"><span class="linenos">309</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">key_col</span><span class="p">)</span>
</span><span id="ColumnReshapers.from_avro_with_registry-310"><a href="#ColumnReshapers.from_avro_with_registry-310"><span class="linenos">310</span></a>                <span class="k">if</span> <span class="n">key_schema</span>
</span><span id="ColumnReshapers.from_avro_with_registry-311"><a href="#ColumnReshapers.from_avro_with_registry-311"><span class="linenos">311</span></a>                <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-312"><a href="#ColumnReshapers.from_avro_with_registry-312"><span class="linenos">312</span></a>                <span class="n">from_avro</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro_with_registry-313"><a href="#ColumnReshapers.from_avro_with_registry-313"><span class="linenos">313</span></a>                    <span class="n">col</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span> <span class="n">value_schema</span><span class="p">,</span> <span class="n">schema_registry</span>  <span class="c1"># type: ignore</span>
</span><span id="ColumnReshapers.from_avro_with_registry-314"><a href="#ColumnReshapers.from_avro_with_registry-314"><span class="linenos">314</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">value_col</span><span class="p">),</span>
</span><span id="ColumnReshapers.from_avro_with_registry-315"><a href="#ColumnReshapers.from_avro_with_registry-315"><span class="linenos">315</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_avro_with_registry-316"><a href="#ColumnReshapers.from_avro_with_registry-316"><span class="linenos">316</span></a>                <span class="o">*</span><span class="n">cols_to_select</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-317"><a href="#ColumnReshapers.from_avro_with_registry-317"><span class="linenos">317</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_key</span> <span class="k">else</span> <span class="n">key_col</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-318"><a href="#ColumnReshapers.from_avro_with_registry-318"><span class="linenos">318</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value_col</span><span class="si">}</span><span class="s2">.*&quot;</span> <span class="k">if</span> <span class="n">expand_value</span> <span class="k">else</span> <span class="n">value_col</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_avro_with_registry-319"><a href="#ColumnReshapers.from_avro_with_registry-319"><span class="linenos">319</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers.from_avro_with_registry-320"><a href="#ColumnReshapers.from_avro_with_registry-320"><span class="linenos">320</span></a>
</span><span id="ColumnReshapers.from_avro_with_registry-321"><a href="#ColumnReshapers.from_avro_with_registry-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Select all attributes from avro using a schema registry.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>schema_registry:</strong>  the url to the schema registry.</li>
<li><strong>value_schema:</strong>  the name of the value schema entry in the schema registry.</li>
<li><strong>value_col:</strong>  the name of the value column.</li>
<li><strong>key_schema:</strong>  the name of the key schema entry in the schema
registry. Default: None.</li>
<li><strong>key_col:</strong>  the name of the key column.</li>
<li><strong>expand_key:</strong>  whether you want to expand the content inside the key
column or not. Default: false.</li>
<li><strong>expand_value:</strong>  whether you want to expand the content inside the value
column or not. Default: true.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Function to be called in .transform() spark function.</p>
</blockquote>
</div>


                    </div>
                    <div id="ColumnReshapers.from_json" class="classattr">
                                <input id="ColumnReshapers.from_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_json</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">input_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">schema_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop_all_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">disable_dbfs_retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.from_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.from_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.from_json-323"><a href="#ColumnReshapers.from_json-323"><span class="linenos">323</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.from_json-324"><a href="#ColumnReshapers.from_json-324"><span class="linenos">324</span></a>    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_json-325"><a href="#ColumnReshapers.from_json-325"><span class="linenos">325</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-326"><a href="#ColumnReshapers.from_json-326"><span class="linenos">326</span></a>        <span class="n">input_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-327"><a href="#ColumnReshapers.from_json-327"><span class="linenos">327</span></a>        <span class="n">schema_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-328"><a href="#ColumnReshapers.from_json-328"><span class="linenos">328</span></a>        <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-329"><a href="#ColumnReshapers.from_json-329"><span class="linenos">329</span></a>        <span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-330"><a href="#ColumnReshapers.from_json-330"><span class="linenos">330</span></a>        <span class="n">drop_all_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-331"><a href="#ColumnReshapers.from_json-331"><span class="linenos">331</span></a>        <span class="n">disable_dbfs_retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-332"><a href="#ColumnReshapers.from_json-332"><span class="linenos">332</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-333"><a href="#ColumnReshapers.from_json-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a json string into a json column (struct).</span>
</span><span id="ColumnReshapers.from_json-334"><a href="#ColumnReshapers.from_json-334"><span class="linenos">334</span></a>
</span><span id="ColumnReshapers.from_json-335"><a href="#ColumnReshapers.from_json-335"><span class="linenos">335</span></a><span class="sd">        The new json column can be added to the existing columns (default) or it can</span>
</span><span id="ColumnReshapers.from_json-336"><a href="#ColumnReshapers.from_json-336"><span class="linenos">336</span></a><span class="sd">        replace all the others, being the only one to output. The new column gets the</span>
</span><span id="ColumnReshapers.from_json-337"><a href="#ColumnReshapers.from_json-337"><span class="linenos">337</span></a><span class="sd">        same name as the original one suffixed with &#39;_json&#39;.</span>
</span><span id="ColumnReshapers.from_json-338"><a href="#ColumnReshapers.from_json-338"><span class="linenos">338</span></a>
</span><span id="ColumnReshapers.from_json-339"><a href="#ColumnReshapers.from_json-339"><span class="linenos">339</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.from_json-340"><a href="#ColumnReshapers.from_json-340"><span class="linenos">340</span></a><span class="sd">            input_col: dict with columns and respective target names.</span>
</span><span id="ColumnReshapers.from_json-341"><a href="#ColumnReshapers.from_json-341"><span class="linenos">341</span></a><span class="sd">            schema_path: path to the StructType schema (spark schema).</span>
</span><span id="ColumnReshapers.from_json-342"><a href="#ColumnReshapers.from_json-342"><span class="linenos">342</span></a><span class="sd">            schema: dict with the StructType schema (spark schema).</span>
</span><span id="ColumnReshapers.from_json-343"><a href="#ColumnReshapers.from_json-343"><span class="linenos">343</span></a><span class="sd">            json_options: options to parse the json value.</span>
</span><span id="ColumnReshapers.from_json-344"><a href="#ColumnReshapers.from_json-344"><span class="linenos">344</span></a><span class="sd">            drop_all_cols: whether to drop all the input columns or not.</span>
</span><span id="ColumnReshapers.from_json-345"><a href="#ColumnReshapers.from_json-345"><span class="linenos">345</span></a><span class="sd">                Defaults to False.</span>
</span><span id="ColumnReshapers.from_json-346"><a href="#ColumnReshapers.from_json-346"><span class="linenos">346</span></a><span class="sd">            disable_dbfs_retry: optional flag to disable file storage dbfs.</span>
</span><span id="ColumnReshapers.from_json-347"><a href="#ColumnReshapers.from_json-347"><span class="linenos">347</span></a>
</span><span id="ColumnReshapers.from_json-348"><a href="#ColumnReshapers.from_json-348"><span class="linenos">348</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.from_json-349"><a href="#ColumnReshapers.from_json-349"><span class="linenos">349</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.from_json-350"><a href="#ColumnReshapers.from_json-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.from_json-351"><a href="#ColumnReshapers.from_json-351"><span class="linenos">351</span></a>
</span><span id="ColumnReshapers.from_json-352"><a href="#ColumnReshapers.from_json-352"><span class="linenos">352</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-353"><a href="#ColumnReshapers.from_json-353"><span class="linenos">353</span></a>            <span class="k">if</span> <span class="n">schema_path</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-354"><a href="#ColumnReshapers.from_json-354"><span class="linenos">354</span></a>                <span class="n">json_schema</span> <span class="o">=</span> <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">schema_path</span><span class="p">,</span> <span class="n">disable_dbfs_retry</span><span class="p">)</span>
</span><span id="ColumnReshapers.from_json-355"><a href="#ColumnReshapers.from_json-355"><span class="linenos">355</span></a>            <span class="k">elif</span> <span class="n">schema</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-356"><a href="#ColumnReshapers.from_json-356"><span class="linenos">356</span></a>                <span class="n">json_schema</span> <span class="o">=</span> <span class="n">SchemaUtils</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</span><span id="ColumnReshapers.from_json-357"><a href="#ColumnReshapers.from_json-357"><span class="linenos">357</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-358"><a href="#ColumnReshapers.from_json-358"><span class="linenos">358</span></a>                <span class="k">raise</span> <span class="n">WrongArgumentsException</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_json-359"><a href="#ColumnReshapers.from_json-359"><span class="linenos">359</span></a>                    <span class="s2">&quot;A file or dict schema needs to be provided.&quot;</span>
</span><span id="ColumnReshapers.from_json-360"><a href="#ColumnReshapers.from_json-360"><span class="linenos">360</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers.from_json-361"><a href="#ColumnReshapers.from_json-361"><span class="linenos">361</span></a>
</span><span id="ColumnReshapers.from_json-362"><a href="#ColumnReshapers.from_json-362"><span class="linenos">362</span></a>            <span class="k">if</span> <span class="n">drop_all_cols</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-363"><a href="#ColumnReshapers.from_json-363"><span class="linenos">363</span></a>                <span class="n">df_with_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_json-364"><a href="#ColumnReshapers.from_json-364"><span class="linenos">364</span></a>                    <span class="n">from_json</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_json-365"><a href="#ColumnReshapers.from_json-365"><span class="linenos">365</span></a>                        <span class="n">col</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="ColumnReshapers.from_json-366"><a href="#ColumnReshapers.from_json-366"><span class="linenos">366</span></a>                        <span class="n">json_schema</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-367"><a href="#ColumnReshapers.from_json-367"><span class="linenos">367</span></a>                        <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="ColumnReshapers.from_json-368"><a href="#ColumnReshapers.from_json-368"><span class="linenos">368</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">)</span>
</span><span id="ColumnReshapers.from_json-369"><a href="#ColumnReshapers.from_json-369"><span class="linenos">369</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers.from_json-370"><a href="#ColumnReshapers.from_json-370"><span class="linenos">370</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ColumnReshapers.from_json-371"><a href="#ColumnReshapers.from_json-371"><span class="linenos">371</span></a>                <span class="n">df_with_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_json-372"><a href="#ColumnReshapers.from_json-372"><span class="linenos">372</span></a>                    <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-373"><a href="#ColumnReshapers.from_json-373"><span class="linenos">373</span></a>                    <span class="n">from_json</span><span class="p">(</span>
</span><span id="ColumnReshapers.from_json-374"><a href="#ColumnReshapers.from_json-374"><span class="linenos">374</span></a>                        <span class="n">col</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="ColumnReshapers.from_json-375"><a href="#ColumnReshapers.from_json-375"><span class="linenos">375</span></a>                        <span class="n">json_schema</span><span class="p">,</span>
</span><span id="ColumnReshapers.from_json-376"><a href="#ColumnReshapers.from_json-376"><span class="linenos">376</span></a>                        <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{},</span>
</span><span id="ColumnReshapers.from_json-377"><a href="#ColumnReshapers.from_json-377"><span class="linenos">377</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">input_col</span><span class="si">}</span><span class="s2">_json&quot;</span><span class="p">),</span>
</span><span id="ColumnReshapers.from_json-378"><a href="#ColumnReshapers.from_json-378"><span class="linenos">378</span></a>                <span class="p">)</span>
</span><span id="ColumnReshapers.from_json-379"><a href="#ColumnReshapers.from_json-379"><span class="linenos">379</span></a>
</span><span id="ColumnReshapers.from_json-380"><a href="#ColumnReshapers.from_json-380"><span class="linenos">380</span></a>            <span class="k">return</span> <span class="n">df_with_json</span>
</span><span id="ColumnReshapers.from_json-381"><a href="#ColumnReshapers.from_json-381"><span class="linenos">381</span></a>
</span><span id="ColumnReshapers.from_json-382"><a href="#ColumnReshapers.from_json-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Convert a json string into a json column (struct).</p>

<p>The new json column can be added to the existing columns (default) or it can
replace all the others, being the only one to output. The new column gets the
same name as the original one suffixed with '_json'.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>input_col:</strong>  dict with columns and respective target names.</li>
<li><strong>schema_path:</strong>  path to the StructType schema (spark schema).</li>
<li><strong>schema:</strong>  dict with the StructType schema (spark schema).</li>
<li><strong>json_options:</strong>  options to parse the json value.</li>
<li><strong>drop_all_cols:</strong>  whether to drop all the input columns or not.
Defaults to False.</li>
<li><strong>disable_dbfs_retry:</strong>  optional flag to disable file storage dbfs.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-34"><span class="linenos">34</span></a><span class="p">{</span>
<a href="#-35"><span class="linenos">35</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;from_json&quot;</span><span class="p">,</span>
<a href="#-36"><span class="linenos">36</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-37"><span class="linenos">37</span></a><span class="w">        </span><span class="nt">&quot;input_col&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sample&quot;</span><span class="p">,</span>
<a href="#-38"><span class="linenos">38</span></a><span class="w">        </span><span class="nt">&quot;schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-39"><span class="linenos">39</span></a><span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;struct&quot;</span><span class="p">,</span>
<a href="#-40"><span class="linenos">40</span></a><span class="w">            </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#-41"><span class="linenos">41</span></a><span class="w">                </span><span class="p">{</span>
<a href="#-42"><span class="linenos">42</span></a><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field1&quot;</span><span class="p">,</span>
<a href="#-43"><span class="linenos">43</span></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a href="#-44"><span class="linenos">44</span></a><span class="w">                    </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#-45"><span class="linenos">45</span></a><span class="w">                    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<a href="#-46"><span class="linenos">46</span></a><span class="w">                </span><span class="p">},</span>
<a href="#-47"><span class="linenos">47</span></a><span class="w">                </span><span class="p">{</span>
<a href="#-48"><span class="linenos">48</span></a><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field2&quot;</span><span class="p">,</span>
<a href="#-49"><span class="linenos">49</span></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a href="#-50"><span class="linenos">50</span></a><span class="w">                    </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#-51"><span class="linenos">51</span></a><span class="w">                    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<a href="#-52"><span class="linenos">52</span></a><span class="w">                </span><span class="p">},</span>
<a href="#-53"><span class="linenos">53</span></a><span class="w">                </span><span class="p">{</span>
<a href="#-54"><span class="linenos">54</span></a><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field3&quot;</span><span class="p">,</span>
<a href="#-55"><span class="linenos">55</span></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;double&quot;</span><span class="p">,</span>
<a href="#-56"><span class="linenos">56</span></a><span class="w">                    </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#-57"><span class="linenos">57</span></a><span class="w">                    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<a href="#-58"><span class="linenos">58</span></a><span class="w">                </span><span class="p">},</span>
<a href="#-59"><span class="linenos">59</span></a><span class="w">                </span><span class="p">{</span>
<a href="#-60"><span class="linenos">60</span></a><span class="w">                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field4&quot;</span><span class="p">,</span>
<a href="#-61"><span class="linenos">61</span></a><span class="w">                    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-62"><span class="linenos">62</span></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;struct&quot;</span><span class="p">,</span>
<a href="#-63"><span class="linenos">63</span></a><span class="w">                        </span><span class="nt">&quot;fields&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#-64"><span class="linenos">64</span></a><span class="w">                            </span><span class="p">{</span>
<a href="#-65"><span class="linenos">65</span></a><span class="w">                                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field1&quot;</span><span class="p">,</span>
<a href="#-66"><span class="linenos">66</span></a><span class="w">                                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a href="#-67"><span class="linenos">67</span></a><span class="w">                                </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#-68"><span class="linenos">68</span></a><span class="w">                                </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<a href="#-69"><span class="linenos">69</span></a><span class="w">                            </span><span class="p">},</span>
<a href="#-70"><span class="linenos">70</span></a><span class="w">                            </span><span class="p">{</span>
<a href="#-71"><span class="linenos">71</span></a><span class="w">                                </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;field2&quot;</span><span class="p">,</span>
<a href="#-72"><span class="linenos">72</span></a><span class="w">                                </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
<a href="#-73"><span class="linenos">73</span></a><span class="w">                                </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#-74"><span class="linenos">74</span></a><span class="w">                                </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<a href="#-75"><span class="linenos">75</span></a><span class="w">                            </span><span class="p">}</span>
<a href="#-76"><span class="linenos">76</span></a><span class="w">                        </span><span class="p">]</span>
<a href="#-77"><span class="linenos">77</span></a><span class="w">                    </span><span class="p">},</span>
<a href="#-78"><span class="linenos">78</span></a><span class="w">                    </span><span class="nt">&quot;nullable&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#-79"><span class="linenos">79</span></a><span class="w">                    </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<a href="#-80"><span class="linenos">80</span></a><span class="w">                </span><span class="p">}</span>
<a href="#-81"><span class="linenos">81</span></a><span class="w">            </span><span class="p">]</span>
<a href="#-82"><span class="linenos">82</span></a><span class="w">        </span><span class="p">}</span>
<a href="#-83"><span class="linenos">83</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-84"><span class="linenos">84</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/transformations/column_reshapers/flatten_schema/batch.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
                    <div id="ColumnReshapers.to_json" class="classattr">
                                <input id="ColumnReshapers.to_json-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">to_json</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">in_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">out_col</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Callable</span>:</span></span>

                <label class="view-source-button" for="ColumnReshapers.to_json-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ColumnReshapers.to_json"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ColumnReshapers.to_json-384"><a href="#ColumnReshapers.to_json-384"><span class="linenos">384</span></a>    <span class="nd">@classmethod</span>
</span><span id="ColumnReshapers.to_json-385"><a href="#ColumnReshapers.to_json-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span>
</span><span id="ColumnReshapers.to_json-386"><a href="#ColumnReshapers.to_json-386"><span class="linenos">386</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">in_cols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">out_col</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ColumnReshapers.to_json-387"><a href="#ColumnReshapers.to_json-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="ColumnReshapers.to_json-388"><a href="#ColumnReshapers.to_json-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert dataframe columns into a json value.</span>
</span><span id="ColumnReshapers.to_json-389"><a href="#ColumnReshapers.to_json-389"><span class="linenos">389</span></a>
</span><span id="ColumnReshapers.to_json-390"><a href="#ColumnReshapers.to_json-390"><span class="linenos">390</span></a><span class="sd">        Args:</span>
</span><span id="ColumnReshapers.to_json-391"><a href="#ColumnReshapers.to_json-391"><span class="linenos">391</span></a><span class="sd">            in_cols: name(s) of the input column(s).</span>
</span><span id="ColumnReshapers.to_json-392"><a href="#ColumnReshapers.to_json-392"><span class="linenos">392</span></a><span class="sd">                Example values:</span>
</span><span id="ColumnReshapers.to_json-393"><a href="#ColumnReshapers.to_json-393"><span class="linenos">393</span></a><span class="sd">                &quot;*&quot; - all</span>
</span><span id="ColumnReshapers.to_json-394"><a href="#ColumnReshapers.to_json-394"><span class="linenos">394</span></a><span class="sd">                columns; &quot;my_col&quot; - one column named &quot;my_col&quot;;</span>
</span><span id="ColumnReshapers.to_json-395"><a href="#ColumnReshapers.to_json-395"><span class="linenos">395</span></a><span class="sd">                &quot;my_col1, my_col2&quot; - two columns.</span>
</span><span id="ColumnReshapers.to_json-396"><a href="#ColumnReshapers.to_json-396"><span class="linenos">396</span></a><span class="sd">            out_col: name of the output column.</span>
</span><span id="ColumnReshapers.to_json-397"><a href="#ColumnReshapers.to_json-397"><span class="linenos">397</span></a><span class="sd">            json_options: options to parse the json value.</span>
</span><span id="ColumnReshapers.to_json-398"><a href="#ColumnReshapers.to_json-398"><span class="linenos">398</span></a>
</span><span id="ColumnReshapers.to_json-399"><a href="#ColumnReshapers.to_json-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="ColumnReshapers.to_json-400"><a href="#ColumnReshapers.to_json-400"><span class="linenos">400</span></a><span class="sd">            A function to be called in .transform() spark function.</span>
</span><span id="ColumnReshapers.to_json-401"><a href="#ColumnReshapers.to_json-401"><span class="linenos">401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ColumnReshapers.to_json-402"><a href="#ColumnReshapers.to_json-402"><span class="linenos">402</span></a>
</span><span id="ColumnReshapers.to_json-403"><a href="#ColumnReshapers.to_json-403"><span class="linenos">403</span></a>        <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
</span><span id="ColumnReshapers.to_json-404"><a href="#ColumnReshapers.to_json-404"><span class="linenos">404</span></a>            <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span>
</span><span id="ColumnReshapers.to_json-405"><a href="#ColumnReshapers.to_json-405"><span class="linenos">405</span></a>                <span class="n">out_col</span><span class="p">,</span> <span class="n">to_json</span><span class="p">(</span><span class="n">struct</span><span class="p">(</span><span class="o">*</span><span class="n">in_cols</span><span class="p">),</span> <span class="n">json_options</span> <span class="k">if</span> <span class="n">json_options</span> <span class="k">else</span> <span class="p">{})</span>
</span><span id="ColumnReshapers.to_json-406"><a href="#ColumnReshapers.to_json-406"><span class="linenos">406</span></a>            <span class="p">)</span>
</span><span id="ColumnReshapers.to_json-407"><a href="#ColumnReshapers.to_json-407"><span class="linenos">407</span></a>
</span><span id="ColumnReshapers.to_json-408"><a href="#ColumnReshapers.to_json-408"><span class="linenos">408</span></a>        <span class="k">return</span> <span class="n">inner</span>
</span></pre></div>


            <div class="docstring"><p>Convert dataframe columns into a json value.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>in_cols:</strong>  name(s) of the input column(s).
Example values:
"*" - all
columns; "my_col" - one column named "my_col";
"my_col1, my_col2" - two columns.</li>
<li><strong>out_col:</strong>  name of the output column.</li>
<li><strong>json_options:</strong>  options to parse the json value.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A function to be called in .transform() spark function.</p>
</blockquote>
</div>


                                <details>
    <summary>View Example</summary>
    <div class="pdoc-code codehilite"><pre><span></span><a href="#-85"><span class="linenos">85</span></a><span class="p">{</span>
<a href="#-86"><span class="linenos">86</span></a><span class="w">    </span><span class="nt">&quot;function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;to_json&quot;</span><span class="p">,</span>
<a href="#-87"><span class="linenos">87</span></a><span class="w">    </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a href="#-88"><span class="linenos">88</span></a><span class="w">        </span><span class="nt">&quot;in_cols&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#-89"><span class="linenos">89</span></a><span class="w">            </span><span class="s2">&quot;item&quot;</span><span class="p">,</span>
<a href="#-90"><span class="linenos">90</span></a><span class="w">            </span><span class="s2">&quot;amount&quot;</span>
<a href="#-91"><span class="linenos">91</span></a><span class="w">        </span><span class="p">],</span>
<a href="#-92"><span class="linenos">92</span></a><span class="w">        </span><span class="nt">&quot;out_col&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;item_amount_json&quot;</span>
<a href="#-93"><span class="linenos">93</span></a><span class="w">    </span><span class="p">}</span>
<a href="#-94"><span class="linenos">94</span></a><span class="p">}</span>
</pre></div>

    </details>

                                <section>
        <a class="pdoc-button git-button" href="https://github.com/adidas/lakehouse-engine/blob/master/tests/resources/feature/transformations/column_reshapers/flatten_schema/batch.json" target="_blank">View Full Acon</a>
    </section>
    </br>
    </br>

                    </div>
        </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>