<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>lakehouse_engine.algorithms.data_loader</title>
            <link rel="icon" href="https://github.com/adidas/lakehouse-engine/blob/master/assets/img/lakehouse_engine_logo_no_bg_160.png?raw=true"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#000000;background-color:#f1efef;border-color:#f1f1f1;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:150%;overflow:auto;margin-bottom:1rem;}.pdoc table th, .pdoc table td{padding:12px 13px;border:1px solid var(--accent2);}.pdoc table th{font-weight:600;}</style>
    <style>/*! custom.css */</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../algorithms.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;lakehouse_engine.algorithms</a>

            <img src="https://github.com/adidas/lakehouse-engine/blob/master/assets/img/lakehouse_engine_logo_no_bg_160.png?raw=true" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#DataLoader">DataLoader</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DataLoader.__init__">DataLoader</a>
                        </li>
                        <li>
                                <a class="function" href="#DataLoader.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#DataLoader.transform">transform</a>
                        </li>
                        <li>
                                <a class="function" href="#DataLoader.process_dq">process_dq</a>
                        </li>
                        <li>
                                <a class="function" href="#DataLoader.write">write</a>
                        </li>
                        <li>
                                <a class="function" href="#DataLoader.terminate">terminate</a>
                        </li>
                        <li>
                                <a class="function" href="#DataLoader.execute">execute</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>Lakehouse Engine v1.20.1</footer>

</div>
    </nav>
    <main class="pdoc">
    <section class="module-info">

                <h1 class="modulename">
<a href="./../../lakehouse_engine.html">lakehouse_engine</a><wbr>.<a href="./../algorithms.html">algorithms</a><wbr>.data_loader    </h1>

                <div class="docstring"><p>Module to define DataLoader class.</p>
</div>

                    <input id="mod-data_loader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                    <label class="view-source-button" for="mod-data_loader-view-source"><span>View Source</span></label>

                    <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Module to define DataLoader class.&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">Logger</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.algorithms.algorithm</span> <span class="kn">import</span> <span class="n">Algorithm</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.core.definitions</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>    <span class="n">DQFunctionSpec</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="n">DQSpec</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="n">DQType</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">InputSpec</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>    <span class="n">MergeOptions</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="n">OutputFormat</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="n">OutputSpec</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">ReadType</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="n">TerminatorSpec</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="n">TransformerSpec</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="n">TransformSpec</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="p">)</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.dq_processors.dq_factory</span> <span class="kn">import</span> <span class="n">DQFactory</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.io.writer_factory</span> <span class="kn">import</span> <span class="n">WriterFactory</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.terminators.notifier_factory</span> <span class="kn">import</span> <span class="n">NotifierFactory</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.terminators.terminator_factory</span> <span class="kn">import</span> <span class="n">TerminatorFactory</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.transformers.transformer_factory</span> <span class="kn">import</span> <span class="n">TransformerFactory</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.utils.logging_handler</span> <span class="kn">import</span> <span class="n">LoggingHandler</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="k">class</span> <span class="nc">DataLoader</span><span class="p">(</span><span class="n">Algorithm</span><span class="p">):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data using an algorithm configuration (ACON represented as dict).</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">    This algorithm focuses on the cases where users will be specifying all the algorithm</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    steps and configurations through a dict based configuration, which we name ACON</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    in our framework.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    Since an ACON is a dict you can pass a custom transformer through a python function</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    and, therefore, the DataLoader can also be used to load data with custom</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    transformations not provided in our transformers package.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    As the algorithm base class of the lakehouse-engine framework is based on the</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    concept of ACON, this DataLoader algorithm simply inherits from Algorithm,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    without overriding anything. We designed the codebase like this to avoid</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    instantiating the Algorithm class directly, which was always meant to be an</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    abstraction for any specific algorithm included in the lakehouse-engine framework.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acon</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct DataLoader algorithm instances.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        A data loader needs several specifications to work properly,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">        but some of them might be optional. The available specifications are:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        - input specifications (mandatory): specify how to read data.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        - transform specifications (optional): specify how to transform data.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">        - data quality specifications (optional): specify how to execute the data</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">            quality process.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        - output specifications (mandatory): specify how to write data to the</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">            target.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        - terminate specifications (optional): specify what to do after writing into</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">            the target (e.g., optimizing target table, vacuum, compute stats, etc).</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Args:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">            acon: algorithm configuration.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">acon</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_specs</span><span class="p">()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="c1"># the streaming transformers plan is needed to future change the</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="c1"># execution specification to accommodate streaming mode limitations in invoking</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="c1"># certain functions (e.g., sort, window, generate row ids/auto increments, ...).</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_specs</span><span class="p">()</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="c1"># our data quality process is not compatible with streaming mode, hence we</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="c1"># have to run it in micro batches, similar to what happens to certain</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="c1"># transformation functions not supported in streaming mode.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dq_specs</span><span class="p">()</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_output_specs</span><span class="p">()</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_terminate_specs</span><span class="p">()</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from an input location into a distributed dataframe.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        Returns:</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">             An ordered dict with all the dataframes that were read.</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="n">read_dfs</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({})</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_specs</span><span class="p">:</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found input specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="n">read_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="n">read_dfs</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform (optionally) the data that was read.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        If there isn&#39;t a transformation specification this step will be skipped, and the</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        original dataframes that were read will be returned.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        Transformations can have dependency from another transformation result, however</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        we need to keep in mind if we are using streaming source and for some reason we</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        need to enable micro batch processing, this result cannot be used as input to</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        another transformation. Micro batch processing in pyspark streaming is only</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        available in .write(), which means this transformation with micro batch needs</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        to be the end of the process.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Args:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">            data: input dataframes in an ordered dict.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        Returns:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">            Another ordered dict with the transformed dataframes, according to the</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">            transformation specification.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="n">transformed_dfs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found transform specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transformed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>                <span class="k">for</span> <span class="n">transformer</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">transformers</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                    <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transformed_df</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>                        <span class="n">TransformerFactory</span><span class="o">.</span><span class="n">get_transformer</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">transformed_dfs</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                    <span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                <span class="n">transformed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_df</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="k">return</span> <span class="n">transformed_dfs</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">process_dq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the data quality tasks for the data that was read and/or transformed.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        It supports multiple input dataframes. Although just one is advisable.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">        It is possible to use data quality validators/expectations that will validate</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        your data and fail the process in case the expectations are not met. The DQ</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        process also generates and keeps updating a site containing the results of the</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        expectations that were done on your data. The location of the site is</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        configurable and can either be on file system or S3. If you define it to be</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">        stored on S3, you can even configure your S3 bucket to serve the site so that</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">        people can easily check the quality of your data. Moreover, it is also</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">        possible to store the result of the DQ process into a defined result sink.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">        Args:</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">            data: dataframes from previous steps of the algorithm that we which to</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">                run the DQ process on.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        Returns:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            Another ordered dict with the validated dataframes.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="n">dq_processed_dfs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="n">df_processed_df</span> <span class="o">=</span> <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found data quality specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                    <span class="n">spec</span><span class="o">.</span><span class="n">dq_functions</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                    <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">dq_type</span> <span class="o">==</span> <span class="n">DQType</span><span class="o">.</span><span class="n">ASSISTANT</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                    <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="p">):</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">cache_df</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                        <span class="n">df_processed_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                    <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">DQFactory</span><span class="o">.</span><span class="n">run_dq_process</span><span class="p">(</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                        <span class="n">spec</span><span class="p">,</span> <span class="n">df_processed_df</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                    <span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                    <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_processed_df</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="k">return</span> <span class="n">dq_processed_dfs</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the data that was read and transformed (if applicable).</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        It supports writing multiple datasets. However, we only recommend to write one</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">        dataframe. This recommendation is based on easy debugging and reproducibility,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        since if we start mixing several datasets being fueled by the same algorithm, it</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="sd">        would unleash an infinite sea of reproducibility issues plus tight coupling and</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        dependencies between datasets. Having said that, there may be cases where</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        writing multiple datasets is desirable according to the use case requirements.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">        Use it accordingly.</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a><span class="sd">        Args:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">            data: dataframes that were read and transformed (if applicable).</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        Returns:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a><span class="sd">            Dataframes that were written.</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">written_dfs</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({})</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_specs</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found output specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="n">written_output</span> <span class="o">=</span> <span class="n">WriterFactory</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>                <span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">],</span> <span class="n">data</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="k">if</span> <span class="n">written_output</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>                <span class="n">written_dfs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">written_output</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                <span class="n">written_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">written_dfs</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminate the algorithm.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        Args:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">            data: dataframes that were written.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found terminate specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                <span class="n">TerminatorFactory</span><span class="o">.</span><span class="n">execute_terminator</span><span class="p">(</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                    <span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">input_id</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">]:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the algorithm execution behaviour.&quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting read stage...&quot;</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="n">read_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting transform stage...&quot;</span><span class="p">)</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="n">transformed_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">read_dfs</span><span class="p">)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting data quality stage...&quot;</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="n">validated_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dq</span><span class="p">(</span><span class="n">transformed_dfs</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting write stage...&quot;</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="n">written_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">validated_dfs</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting terminate stage...&quot;</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span><span class="p">(</span><span class="n">written_dfs</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Execution of the algorithm has finished!&quot;</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">NotifierFactory</span><span class="o">.</span><span class="n">generate_failure_notification</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="n">written_dfs</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">_get_input_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">InputSpec</span><span class="p">]:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input specifications from an acon.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        Returns:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">            List of input specifications.</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">InputSpec</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">)</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;input_specs&quot;</span><span class="p">]]</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">_get_transform_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformSpec</span><span class="p">]:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the transformation specifications from an acon.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        If we are executing the algorithm in streaming mode and if the</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">        transformer function is not supported in streaming mode, it is</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        important to note that ONLY those unsupported operations will</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">        go into the streaming_micro_batch_transformers (see if in the function code),</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        in the same order that they appear in the list of transformations. This means</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">        that other supported transformations that appear after an</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        unsupported one continue to stay one the normal execution plan,</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">        i.e., outside the foreachBatch function. Therefore, this may</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        make your algorithm to execute a different logic than the one you</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        originally intended. For this reason:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">            1) ALWAYS PLACE UNSUPPORTED STREAMING TRANSFORMATIONS AT LAST;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">            2) USE force_streaming_foreach_batch_processing option in transform_spec</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">            section.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">            3) USE THE CUSTOM_TRANSFORMATION AND WRITE ALL YOUR TRANSFORMATION LOGIC</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">            THERE.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">        Check list of unsupported spark streaming operations here:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="sd">        https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#unsupported-operations</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">            List of transformation specifications.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>        <span class="n">input_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_read_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;input_specs&quot;</span><span class="p">])</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="n">transform_input_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_input_ids</span><span class="p">(</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transform_specs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="n">prev_spec_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous_spec_read_types</span><span class="p">(</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="n">input_read_types</span><span class="p">,</span> <span class="n">transform_input_ids</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">transform_specs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transform_specs&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">transform_spec</span> <span class="o">=</span> <span class="n">TransformSpec</span><span class="p">(</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">],</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                <span class="n">input_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">transformers</span><span class="o">=</span><span class="p">[],</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                <span class="n">force_streaming_foreach_batch_processing</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                    <span class="s2">&quot;force_streaming_foreach_batch_processing&quot;</span><span class="p">,</span> <span class="kc">False</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="p">),</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;transformers&quot;</span><span class="p">]:</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>                <span class="n">transformer_spec</span> <span class="o">=</span> <span class="n">TransformerSpec</span><span class="p">(</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>                    <span class="n">function</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>                <span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                    <span class="n">prev_spec_read_types</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                    <span class="o">==</span> <span class="n">ReadType</span><span class="o">.</span><span class="n">STREAMING</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                    <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>                    <span class="ow">in</span> <span class="n">TransformerFactory</span><span class="o">.</span><span class="n">UNSUPPORTED_STREAMING_TRANSFORMERS</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>                    <span class="n">prev_spec_read_types</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>                    <span class="o">==</span> <span class="n">ReadType</span><span class="o">.</span><span class="n">STREAMING</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                    <span class="ow">and</span> <span class="n">transform_spec</span><span class="o">.</span><span class="n">force_streaming_foreach_batch_processing</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                <span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_move_to_streaming_micro_batch_transformers</span><span class="p">(</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>                        <span class="n">transform_spec</span><span class="p">,</span> <span class="n">transformer_spec</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                    <span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                    <span class="n">transform_spec</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformer_spec</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="n">transform_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transform_spec</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="k">return</span> <span class="n">transform_specs</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="nf">_get_dq_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of data quality specification objects from acon.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        In streaming mode, we automatically convert the data quality specification in</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        the streaming_micro_batch_dq_processors list for the respective output spec.</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        This is needed because our dq process cannot be executed using native streaming</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        functions.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        Returns:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">            List of data quality spec objects.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="n">input_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_read_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;input_specs&quot;</span><span class="p">])</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="n">transform_input_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_input_ids</span><span class="p">(</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transform_specs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="n">prev_spec_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous_spec_read_types</span><span class="p">(</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="n">input_read_types</span><span class="p">,</span> <span class="n">transform_input_ids</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">dq_specs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dq_specs&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="n">dq_spec</span><span class="p">,</span> <span class="n">dq_functions</span><span class="p">,</span> <span class="n">critical_functions</span> <span class="o">=</span> <span class="n">Algorithm</span><span class="o">.</span><span class="n">get_dq_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="k">if</span> <span class="n">prev_spec_read_types</span><span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">ReadType</span><span class="o">.</span><span class="n">STREAMING</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                <span class="c1"># we need to use deepcopy to explicitly create a copy of the dict</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                <span class="c1"># otherwise python only create binding for dicts, and we would be</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="c1"># modifying the original dict, which we don&#39;t want to.</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_move_to_streaming_micro_batch_dq_processors</span><span class="p">(</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                    <span class="n">deepcopy</span><span class="p">(</span><span class="n">dq_spec</span><span class="p">),</span> <span class="n">dq_functions</span><span class="p">,</span> <span class="n">critical_functions</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                <span class="p">)</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                <span class="n">dq_spec</span><span class="o">.</span><span class="n">dq_functions</span> <span class="o">=</span> <span class="n">dq_functions</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                <span class="n">dq_spec</span><span class="o">.</span><span class="n">critical_functions</span> <span class="o">=</span> <span class="n">critical_functions</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                <span class="sa">f</span><span class="s2">&quot;Streaming Micro Batch DQ Plan: &quot;</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="n">dq_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dq_spec</span><span class="p">)</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">dq_specs</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">_get_output_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputSpec</span><span class="p">]:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the output specifications from an acon.</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">        Returns:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="sd">            List of output specifications.</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>            <span class="n">OutputSpec</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">],</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="n">input_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                <span class="n">write_type</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_format&quot;</span><span class="p">,</span> <span class="n">OutputFormat</span><span class="o">.</span><span class="n">DELTAFILES</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                <span class="n">db_table</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;db_table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                <span class="n">location</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                <span class="n">merge_opts</span><span class="o">=</span><span class="n">MergeOptions</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;merge_opts&quot;</span><span class="p">])</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;merge_opts&quot;</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                <span class="n">partitions</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partitions&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                <span class="n">streaming_micro_batch_transformers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_streaming_transformer_plan</span><span class="p">(</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>                    <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>                <span class="p">),</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>                <span class="n">streaming_once</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_once&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                <span class="n">streaming_processing_time</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_processing_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>                <span class="n">streaming_available_now</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>                    <span class="s2">&quot;streaming_available_now&quot;</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>                    <span class="kc">False</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>                        <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_once&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                        <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_processing_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>                        <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_continuous&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>                    <span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>                    <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                <span class="p">),</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                <span class="n">streaming_continuous</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_continuous&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                <span class="n">streaming_await_termination</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                    <span class="s2">&quot;streaming_await_termination&quot;</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                <span class="p">),</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>                <span class="n">streaming_await_termination_timeout</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>                    <span class="s2">&quot;streaming_await_termination_timeout&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>                <span class="p">),</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>                <span class="n">with_batch_id</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;with_batch_id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>                <span class="n">options</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>                <span class="n">streaming_micro_batch_dq_processors</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span> <span class="p">[])</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>                <span class="p">),</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;output_specs&quot;</span><span class="p">]</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="p">]</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">_get_streaming_transformer_plan</span><span class="p">(</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">input_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dq_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformerSpec</span><span class="p">]:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the plan for transformations to be applied on streaming micro batches.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        When running both DQ processes and transformations in streaming micro batches,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        the _streaming_micro_batch_transformers_plan to consider is the one associated</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">        with the transformer spec_id and not with the dq spec_id. Thus, on those cases,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">        this method maps the input id of the output_spec (which is the spec_id of a</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">        dq_spec) with the dependent transformer spec_id.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        Args:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">            input_id: id of the corresponding input specification.</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">            dq_specs: data quality specifications.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">        Returns:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">            a list of TransformerSpec, representing the transformations plan.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="n">transformer_id</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">input_id</span> <span class="k">for</span> <span class="n">dq_spec</span> <span class="ow">in</span> <span class="n">dq_specs</span> <span class="k">if</span> <span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="o">==</span> <span class="n">input_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">input_id</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="k">else</span> <span class="n">input_id</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>        <span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">transformer_id</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="k">def</span> <span class="nf">_get_terminate_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">]:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the terminate specifications from an acon.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        Returns:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">            List of terminate specifications.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">)</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;terminate_specs&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="k">def</span> <span class="nf">_move_to_streaming_micro_batch_transformers</span><span class="p">(</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">transform_spec</span><span class="p">:</span> <span class="n">TransformSpec</span><span class="p">,</span> <span class="n">transformer_spec</span><span class="p">:</span> <span class="n">TransformerSpec</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move the transformer to the list of streaming micro batch transformations.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        If the transform specs contain functions that cannot be executed in streaming</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">        mode, this function sends those functions to the output specs</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        streaming_micro_batch_transformers, where they will be executed inside the</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">        stream foreachBatch function.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        To accomplish that we use an instance variable that associates the</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        streaming_micro_batch_transformers to each output spec, in order to do reverse</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        lookup when creating the OutputSpec.</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        Args:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">            transform_spec: transform specification (overall</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">                transformation specification - a transformation may contain multiple</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">                transformers).</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">            transformer_spec: the specific transformer function and arguments.</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="k">if</span> <span class="n">transform_spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>            <span class="n">transformer_spec</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    <span class="k">def</span> <span class="nf">_move_to_streaming_micro_batch_dq_processors</span><span class="p">(</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">dq_spec</span><span class="p">:</span> <span class="n">DQSpec</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">dq_functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQFunctionSpec</span><span class="p">],</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">critical_functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQFunctionSpec</span><span class="p">],</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move the dq function to the list of streaming micro batch transformations.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">        If the dq specs contain functions that cannot be executed in streaming mode,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        this function sends those functions to the output specs</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">        streaming_micro_batch_dq_processors, where they will be executed inside the</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">        stream foreachBatch function.</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        To accomplish that we use an instance variable that associates the</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        streaming_micro_batch_dq_processors to each output spec, in order to do reverse</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        lookup when creating the OutputSpec.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">        Args:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">            dq_spec: dq specification (overall dq process specification).</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">            dq_functions: the list of dq functions to be considered.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">            critical_functions: list of critical functions to be considered.</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="k">if</span> <span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">dq_spec</span><span class="o">.</span><span class="n">dq_functions</span> <span class="o">=</span> <span class="n">dq_functions</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="n">dq_spec</span><span class="o">.</span><span class="n">critical_functions</span> <span class="o">=</span> <span class="n">critical_functions</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dq_spec</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="k">def</span> <span class="nf">_get_input_read_types</span><span class="p">(</span><span class="n">list_of_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a dict of spec ids and read types from a list of input specs.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        Args:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">            list_of_specs: list of input specs ([{k:v}]).</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        Returns:</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">            Dict of {input_spec_id: read_type}.</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;read_type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_of_specs</span><span class="p">}</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">_get_transform_input_ids</span><span class="p">(</span><span class="n">list_of_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a dict of transform spec ids and input ids from list of transform specs.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">        Args:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">            list_of_specs: list of transform specs ([{k:v}]).</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        Returns:</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">            Dict of {transform_spec_id: input_id}.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_of_specs</span><span class="p">}</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="k">def</span> <span class="nf">_get_previous_spec_read_types</span><span class="p">(</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="n">input_read_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">transform_input_ids</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the read types of the previous specification: input and/or transform.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">        For the chaining transformations and for DQ process to work seamlessly in batch</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        and streaming mode, we have to figure out if the previous spec to the transform</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        or dq spec(e.g., input spec or transform spec) refers to a batch read type or</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        a streaming read type.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        Args:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">            input_read_types: dict of {input_spec_id: read_type}.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">            transform_input_ids: dict of {transform_spec_id: input_id}.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">        Returns:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">            Dict of {input_spec_id or transform_spec_id: read_type}</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="n">combined_read_types</span> <span class="o">=</span> <span class="n">input_read_types</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">for</span> <span class="n">spec_id</span><span class="p">,</span> <span class="n">input_id</span> <span class="ow">in</span> <span class="n">transform_input_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="n">combined_read_types</span><span class="p">[</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_read_types</span><span class="p">[</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="k">return</span> <span class="n">combined_read_types</span>
</span></pre></div>


    </section>
        <section id="DataLoader">
                    <input id="DataLoader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DataLoader</span><wbr>(<span class="base"><a href="algorithm.html#Algorithm">lakehouse_engine.algorithms.algorithm.Algorithm</a></span>):

                <label class="view-source-button" for="DataLoader-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader-31"><a href="#DataLoader-31"><span class="linenos"> 31</span></a><span class="k">class</span> <span class="nc">DataLoader</span><span class="p">(</span><span class="n">Algorithm</span><span class="p">):</span>
</span><span id="DataLoader-32"><a href="#DataLoader-32"><span class="linenos"> 32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data using an algorithm configuration (ACON represented as dict).</span>
</span><span id="DataLoader-33"><a href="#DataLoader-33"><span class="linenos"> 33</span></a>
</span><span id="DataLoader-34"><a href="#DataLoader-34"><span class="linenos"> 34</span></a><span class="sd">    This algorithm focuses on the cases where users will be specifying all the algorithm</span>
</span><span id="DataLoader-35"><a href="#DataLoader-35"><span class="linenos"> 35</span></a><span class="sd">    steps and configurations through a dict based configuration, which we name ACON</span>
</span><span id="DataLoader-36"><a href="#DataLoader-36"><span class="linenos"> 36</span></a><span class="sd">    in our framework.</span>
</span><span id="DataLoader-37"><a href="#DataLoader-37"><span class="linenos"> 37</span></a>
</span><span id="DataLoader-38"><a href="#DataLoader-38"><span class="linenos"> 38</span></a><span class="sd">    Since an ACON is a dict you can pass a custom transformer through a python function</span>
</span><span id="DataLoader-39"><a href="#DataLoader-39"><span class="linenos"> 39</span></a><span class="sd">    and, therefore, the DataLoader can also be used to load data with custom</span>
</span><span id="DataLoader-40"><a href="#DataLoader-40"><span class="linenos"> 40</span></a><span class="sd">    transformations not provided in our transformers package.</span>
</span><span id="DataLoader-41"><a href="#DataLoader-41"><span class="linenos"> 41</span></a>
</span><span id="DataLoader-42"><a href="#DataLoader-42"><span class="linenos"> 42</span></a><span class="sd">    As the algorithm base class of the lakehouse-engine framework is based on the</span>
</span><span id="DataLoader-43"><a href="#DataLoader-43"><span class="linenos"> 43</span></a><span class="sd">    concept of ACON, this DataLoader algorithm simply inherits from Algorithm,</span>
</span><span id="DataLoader-44"><a href="#DataLoader-44"><span class="linenos"> 44</span></a><span class="sd">    without overriding anything. We designed the codebase like this to avoid</span>
</span><span id="DataLoader-45"><a href="#DataLoader-45"><span class="linenos"> 45</span></a><span class="sd">    instantiating the Algorithm class directly, which was always meant to be an</span>
</span><span id="DataLoader-46"><a href="#DataLoader-46"><span class="linenos"> 46</span></a><span class="sd">    abstraction for any specific algorithm included in the lakehouse-engine framework.</span>
</span><span id="DataLoader-47"><a href="#DataLoader-47"><span class="linenos"> 47</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DataLoader-48"><a href="#DataLoader-48"><span class="linenos"> 48</span></a>
</span><span id="DataLoader-49"><a href="#DataLoader-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acon</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataLoader-50"><a href="#DataLoader-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct DataLoader algorithm instances.</span>
</span><span id="DataLoader-51"><a href="#DataLoader-51"><span class="linenos"> 51</span></a>
</span><span id="DataLoader-52"><a href="#DataLoader-52"><span class="linenos"> 52</span></a><span class="sd">        A data loader needs several specifications to work properly,</span>
</span><span id="DataLoader-53"><a href="#DataLoader-53"><span class="linenos"> 53</span></a><span class="sd">        but some of them might be optional. The available specifications are:</span>
</span><span id="DataLoader-54"><a href="#DataLoader-54"><span class="linenos"> 54</span></a>
</span><span id="DataLoader-55"><a href="#DataLoader-55"><span class="linenos"> 55</span></a><span class="sd">        - input specifications (mandatory): specify how to read data.</span>
</span><span id="DataLoader-56"><a href="#DataLoader-56"><span class="linenos"> 56</span></a><span class="sd">        - transform specifications (optional): specify how to transform data.</span>
</span><span id="DataLoader-57"><a href="#DataLoader-57"><span class="linenos"> 57</span></a><span class="sd">        - data quality specifications (optional): specify how to execute the data</span>
</span><span id="DataLoader-58"><a href="#DataLoader-58"><span class="linenos"> 58</span></a><span class="sd">            quality process.</span>
</span><span id="DataLoader-59"><a href="#DataLoader-59"><span class="linenos"> 59</span></a><span class="sd">        - output specifications (mandatory): specify how to write data to the</span>
</span><span id="DataLoader-60"><a href="#DataLoader-60"><span class="linenos"> 60</span></a><span class="sd">            target.</span>
</span><span id="DataLoader-61"><a href="#DataLoader-61"><span class="linenos"> 61</span></a><span class="sd">        - terminate specifications (optional): specify what to do after writing into</span>
</span><span id="DataLoader-62"><a href="#DataLoader-62"><span class="linenos"> 62</span></a><span class="sd">            the target (e.g., optimizing target table, vacuum, compute stats, etc).</span>
</span><span id="DataLoader-63"><a href="#DataLoader-63"><span class="linenos"> 63</span></a>
</span><span id="DataLoader-64"><a href="#DataLoader-64"><span class="linenos"> 64</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-65"><a href="#DataLoader-65"><span class="linenos"> 65</span></a><span class="sd">            acon: algorithm configuration.</span>
</span><span id="DataLoader-66"><a href="#DataLoader-66"><span class="linenos"> 66</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-67"><a href="#DataLoader-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="DataLoader-68"><a href="#DataLoader-68"><span class="linenos"> 68</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">acon</span><span class="p">)</span>
</span><span id="DataLoader-69"><a href="#DataLoader-69"><span class="linenos"> 69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_specs</span><span class="p">()</span>
</span><span id="DataLoader-70"><a href="#DataLoader-70"><span class="linenos"> 70</span></a>        <span class="c1"># the streaming transformers plan is needed to future change the</span>
</span><span id="DataLoader-71"><a href="#DataLoader-71"><span class="linenos"> 71</span></a>        <span class="c1"># execution specification to accommodate streaming mode limitations in invoking</span>
</span><span id="DataLoader-72"><a href="#DataLoader-72"><span class="linenos"> 72</span></a>        <span class="c1"># certain functions (e.g., sort, window, generate row ids/auto increments, ...).</span>
</span><span id="DataLoader-73"><a href="#DataLoader-73"><span class="linenos"> 73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DataLoader-74"><a href="#DataLoader-74"><span class="linenos"> 74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_specs</span><span class="p">()</span>
</span><span id="DataLoader-75"><a href="#DataLoader-75"><span class="linenos"> 75</span></a>        <span class="c1"># our data quality process is not compatible with streaming mode, hence we</span>
</span><span id="DataLoader-76"><a href="#DataLoader-76"><span class="linenos"> 76</span></a>        <span class="c1"># have to run it in micro batches, similar to what happens to certain</span>
</span><span id="DataLoader-77"><a href="#DataLoader-77"><span class="linenos"> 77</span></a>        <span class="c1"># transformation functions not supported in streaming mode.</span>
</span><span id="DataLoader-78"><a href="#DataLoader-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DataLoader-79"><a href="#DataLoader-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dq_specs</span><span class="p">()</span>
</span><span id="DataLoader-80"><a href="#DataLoader-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_output_specs</span><span class="p">()</span>
</span><span id="DataLoader-81"><a href="#DataLoader-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_terminate_specs</span><span class="p">()</span>
</span><span id="DataLoader-82"><a href="#DataLoader-82"><span class="linenos"> 82</span></a>
</span><span id="DataLoader-83"><a href="#DataLoader-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader-84"><a href="#DataLoader-84"><span class="linenos"> 84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from an input location into a distributed dataframe.</span>
</span><span id="DataLoader-85"><a href="#DataLoader-85"><span class="linenos"> 85</span></a>
</span><span id="DataLoader-86"><a href="#DataLoader-86"><span class="linenos"> 86</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-87"><a href="#DataLoader-87"><span class="linenos"> 87</span></a><span class="sd">             An ordered dict with all the dataframes that were read.</span>
</span><span id="DataLoader-88"><a href="#DataLoader-88"><span class="linenos"> 88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-89"><a href="#DataLoader-89"><span class="linenos"> 89</span></a>        <span class="n">read_dfs</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({})</span>
</span><span id="DataLoader-90"><a href="#DataLoader-90"><span class="linenos"> 90</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_specs</span><span class="p">:</span>
</span><span id="DataLoader-91"><a href="#DataLoader-91"><span class="linenos"> 91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found input specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader-92"><a href="#DataLoader-92"><span class="linenos"> 92</span></a>            <span class="n">read_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="DataLoader-93"><a href="#DataLoader-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="n">read_dfs</span>
</span><span id="DataLoader-94"><a href="#DataLoader-94"><span class="linenos"> 94</span></a>
</span><span id="DataLoader-95"><a href="#DataLoader-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader-96"><a href="#DataLoader-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform (optionally) the data that was read.</span>
</span><span id="DataLoader-97"><a href="#DataLoader-97"><span class="linenos"> 97</span></a>
</span><span id="DataLoader-98"><a href="#DataLoader-98"><span class="linenos"> 98</span></a><span class="sd">        If there isn&#39;t a transformation specification this step will be skipped, and the</span>
</span><span id="DataLoader-99"><a href="#DataLoader-99"><span class="linenos"> 99</span></a><span class="sd">        original dataframes that were read will be returned.</span>
</span><span id="DataLoader-100"><a href="#DataLoader-100"><span class="linenos">100</span></a><span class="sd">        Transformations can have dependency from another transformation result, however</span>
</span><span id="DataLoader-101"><a href="#DataLoader-101"><span class="linenos">101</span></a><span class="sd">        we need to keep in mind if we are using streaming source and for some reason we</span>
</span><span id="DataLoader-102"><a href="#DataLoader-102"><span class="linenos">102</span></a><span class="sd">        need to enable micro batch processing, this result cannot be used as input to</span>
</span><span id="DataLoader-103"><a href="#DataLoader-103"><span class="linenos">103</span></a><span class="sd">        another transformation. Micro batch processing in pyspark streaming is only</span>
</span><span id="DataLoader-104"><a href="#DataLoader-104"><span class="linenos">104</span></a><span class="sd">        available in .write(), which means this transformation with micro batch needs</span>
</span><span id="DataLoader-105"><a href="#DataLoader-105"><span class="linenos">105</span></a><span class="sd">        to be the end of the process.</span>
</span><span id="DataLoader-106"><a href="#DataLoader-106"><span class="linenos">106</span></a>
</span><span id="DataLoader-107"><a href="#DataLoader-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-108"><a href="#DataLoader-108"><span class="linenos">108</span></a><span class="sd">            data: input dataframes in an ordered dict.</span>
</span><span id="DataLoader-109"><a href="#DataLoader-109"><span class="linenos">109</span></a>
</span><span id="DataLoader-110"><a href="#DataLoader-110"><span class="linenos">110</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-111"><a href="#DataLoader-111"><span class="linenos">111</span></a><span class="sd">            Another ordered dict with the transformed dataframes, according to the</span>
</span><span id="DataLoader-112"><a href="#DataLoader-112"><span class="linenos">112</span></a><span class="sd">            transformation specification.</span>
</span><span id="DataLoader-113"><a href="#DataLoader-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-114"><a href="#DataLoader-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span>
</span><span id="DataLoader-115"><a href="#DataLoader-115"><span class="linenos">115</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="DataLoader-116"><a href="#DataLoader-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader-117"><a href="#DataLoader-117"><span class="linenos">117</span></a>            <span class="n">transformed_dfs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DataLoader-118"><a href="#DataLoader-118"><span class="linenos">118</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span>
</span><span id="DataLoader-119"><a href="#DataLoader-119"><span class="linenos">119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found transform specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader-120"><a href="#DataLoader-120"><span class="linenos">120</span></a>                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transformed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader-121"><a href="#DataLoader-121"><span class="linenos">121</span></a>                <span class="k">for</span> <span class="n">transformer</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">transformers</span><span class="p">:</span>
</span><span id="DataLoader-122"><a href="#DataLoader-122"><span class="linenos">122</span></a>                    <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transformed_df</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
</span><span id="DataLoader-123"><a href="#DataLoader-123"><span class="linenos">123</span></a>                        <span class="n">TransformerFactory</span><span class="o">.</span><span class="n">get_transformer</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">transformed_dfs</span><span class="p">)</span>
</span><span id="DataLoader-124"><a href="#DataLoader-124"><span class="linenos">124</span></a>                    <span class="p">)</span>
</span><span id="DataLoader-125"><a href="#DataLoader-125"><span class="linenos">125</span></a>                <span class="n">transformed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_df</span>
</span><span id="DataLoader-126"><a href="#DataLoader-126"><span class="linenos">126</span></a>            <span class="k">return</span> <span class="n">transformed_dfs</span>
</span><span id="DataLoader-127"><a href="#DataLoader-127"><span class="linenos">127</span></a>
</span><span id="DataLoader-128"><a href="#DataLoader-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">process_dq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader-129"><a href="#DataLoader-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the data quality tasks for the data that was read and/or transformed.</span>
</span><span id="DataLoader-130"><a href="#DataLoader-130"><span class="linenos">130</span></a>
</span><span id="DataLoader-131"><a href="#DataLoader-131"><span class="linenos">131</span></a><span class="sd">        It supports multiple input dataframes. Although just one is advisable.</span>
</span><span id="DataLoader-132"><a href="#DataLoader-132"><span class="linenos">132</span></a>
</span><span id="DataLoader-133"><a href="#DataLoader-133"><span class="linenos">133</span></a><span class="sd">        It is possible to use data quality validators/expectations that will validate</span>
</span><span id="DataLoader-134"><a href="#DataLoader-134"><span class="linenos">134</span></a><span class="sd">        your data and fail the process in case the expectations are not met. The DQ</span>
</span><span id="DataLoader-135"><a href="#DataLoader-135"><span class="linenos">135</span></a><span class="sd">        process also generates and keeps updating a site containing the results of the</span>
</span><span id="DataLoader-136"><a href="#DataLoader-136"><span class="linenos">136</span></a><span class="sd">        expectations that were done on your data. The location of the site is</span>
</span><span id="DataLoader-137"><a href="#DataLoader-137"><span class="linenos">137</span></a><span class="sd">        configurable and can either be on file system or S3. If you define it to be</span>
</span><span id="DataLoader-138"><a href="#DataLoader-138"><span class="linenos">138</span></a><span class="sd">        stored on S3, you can even configure your S3 bucket to serve the site so that</span>
</span><span id="DataLoader-139"><a href="#DataLoader-139"><span class="linenos">139</span></a><span class="sd">        people can easily check the quality of your data. Moreover, it is also</span>
</span><span id="DataLoader-140"><a href="#DataLoader-140"><span class="linenos">140</span></a><span class="sd">        possible to store the result of the DQ process into a defined result sink.</span>
</span><span id="DataLoader-141"><a href="#DataLoader-141"><span class="linenos">141</span></a>
</span><span id="DataLoader-142"><a href="#DataLoader-142"><span class="linenos">142</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-143"><a href="#DataLoader-143"><span class="linenos">143</span></a><span class="sd">            data: dataframes from previous steps of the algorithm that we which to</span>
</span><span id="DataLoader-144"><a href="#DataLoader-144"><span class="linenos">144</span></a><span class="sd">                run the DQ process on.</span>
</span><span id="DataLoader-145"><a href="#DataLoader-145"><span class="linenos">145</span></a>
</span><span id="DataLoader-146"><a href="#DataLoader-146"><span class="linenos">146</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-147"><a href="#DataLoader-147"><span class="linenos">147</span></a><span class="sd">            Another ordered dict with the validated dataframes.</span>
</span><span id="DataLoader-148"><a href="#DataLoader-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-149"><a href="#DataLoader-149"><span class="linenos">149</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span>
</span><span id="DataLoader-150"><a href="#DataLoader-150"><span class="linenos">150</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="DataLoader-151"><a href="#DataLoader-151"><span class="linenos">151</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader-152"><a href="#DataLoader-152"><span class="linenos">152</span></a>            <span class="n">dq_processed_dfs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DataLoader-153"><a href="#DataLoader-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span>
</span><span id="DataLoader-154"><a href="#DataLoader-154"><span class="linenos">154</span></a>                <span class="n">df_processed_df</span> <span class="o">=</span> <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader-155"><a href="#DataLoader-155"><span class="linenos">155</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found data quality specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader-156"><a href="#DataLoader-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DataLoader-157"><a href="#DataLoader-157"><span class="linenos">157</span></a>                    <span class="n">spec</span><span class="o">.</span><span class="n">dq_functions</span>
</span><span id="DataLoader-158"><a href="#DataLoader-158"><span class="linenos">158</span></a>                    <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">dq_type</span> <span class="o">==</span> <span class="n">DQType</span><span class="o">.</span><span class="n">ASSISTANT</span><span class="o">.</span><span class="n">value</span>
</span><span id="DataLoader-159"><a href="#DataLoader-159"><span class="linenos">159</span></a>                    <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span>
</span><span id="DataLoader-160"><a href="#DataLoader-160"><span class="linenos">160</span></a>                <span class="p">):</span>
</span><span id="DataLoader-161"><a href="#DataLoader-161"><span class="linenos">161</span></a>                    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">cache_df</span><span class="p">:</span>
</span><span id="DataLoader-162"><a href="#DataLoader-162"><span class="linenos">162</span></a>                        <span class="n">df_processed_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</span><span id="DataLoader-163"><a href="#DataLoader-163"><span class="linenos">163</span></a>                    <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">DQFactory</span><span class="o">.</span><span class="n">run_dq_process</span><span class="p">(</span>
</span><span id="DataLoader-164"><a href="#DataLoader-164"><span class="linenos">164</span></a>                        <span class="n">spec</span><span class="p">,</span> <span class="n">df_processed_df</span>
</span><span id="DataLoader-165"><a href="#DataLoader-165"><span class="linenos">165</span></a>                    <span class="p">)</span>
</span><span id="DataLoader-166"><a href="#DataLoader-166"><span class="linenos">166</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader-167"><a href="#DataLoader-167"><span class="linenos">167</span></a>                    <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_processed_df</span>
</span><span id="DataLoader-168"><a href="#DataLoader-168"><span class="linenos">168</span></a>            <span class="k">return</span> <span class="n">dq_processed_dfs</span>
</span><span id="DataLoader-169"><a href="#DataLoader-169"><span class="linenos">169</span></a>
</span><span id="DataLoader-170"><a href="#DataLoader-170"><span class="linenos">170</span></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader-171"><a href="#DataLoader-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the data that was read and transformed (if applicable).</span>
</span><span id="DataLoader-172"><a href="#DataLoader-172"><span class="linenos">172</span></a>
</span><span id="DataLoader-173"><a href="#DataLoader-173"><span class="linenos">173</span></a><span class="sd">        It supports writing multiple datasets. However, we only recommend to write one</span>
</span><span id="DataLoader-174"><a href="#DataLoader-174"><span class="linenos">174</span></a><span class="sd">        dataframe. This recommendation is based on easy debugging and reproducibility,</span>
</span><span id="DataLoader-175"><a href="#DataLoader-175"><span class="linenos">175</span></a><span class="sd">        since if we start mixing several datasets being fueled by the same algorithm, it</span>
</span><span id="DataLoader-176"><a href="#DataLoader-176"><span class="linenos">176</span></a><span class="sd">        would unleash an infinite sea of reproducibility issues plus tight coupling and</span>
</span><span id="DataLoader-177"><a href="#DataLoader-177"><span class="linenos">177</span></a><span class="sd">        dependencies between datasets. Having said that, there may be cases where</span>
</span><span id="DataLoader-178"><a href="#DataLoader-178"><span class="linenos">178</span></a><span class="sd">        writing multiple datasets is desirable according to the use case requirements.</span>
</span><span id="DataLoader-179"><a href="#DataLoader-179"><span class="linenos">179</span></a><span class="sd">        Use it accordingly.</span>
</span><span id="DataLoader-180"><a href="#DataLoader-180"><span class="linenos">180</span></a>
</span><span id="DataLoader-181"><a href="#DataLoader-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-182"><a href="#DataLoader-182"><span class="linenos">182</span></a><span class="sd">            data: dataframes that were read and transformed (if applicable).</span>
</span><span id="DataLoader-183"><a href="#DataLoader-183"><span class="linenos">183</span></a>
</span><span id="DataLoader-184"><a href="#DataLoader-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-185"><a href="#DataLoader-185"><span class="linenos">185</span></a><span class="sd">            Dataframes that were written.</span>
</span><span id="DataLoader-186"><a href="#DataLoader-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-187"><a href="#DataLoader-187"><span class="linenos">187</span></a>        <span class="n">written_dfs</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({})</span>
</span><span id="DataLoader-188"><a href="#DataLoader-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_specs</span><span class="p">:</span>
</span><span id="DataLoader-189"><a href="#DataLoader-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found output specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader-190"><a href="#DataLoader-190"><span class="linenos">190</span></a>
</span><span id="DataLoader-191"><a href="#DataLoader-191"><span class="linenos">191</span></a>            <span class="n">written_output</span> <span class="o">=</span> <span class="n">WriterFactory</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span>
</span><span id="DataLoader-192"><a href="#DataLoader-192"><span class="linenos">192</span></a>                <span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">],</span> <span class="n">data</span>
</span><span id="DataLoader-193"><a href="#DataLoader-193"><span class="linenos">193</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</span><span id="DataLoader-194"><a href="#DataLoader-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="n">written_output</span><span class="p">:</span>
</span><span id="DataLoader-195"><a href="#DataLoader-195"><span class="linenos">195</span></a>                <span class="n">written_dfs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">written_output</span><span class="p">)</span>
</span><span id="DataLoader-196"><a href="#DataLoader-196"><span class="linenos">196</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader-197"><a href="#DataLoader-197"><span class="linenos">197</span></a>                <span class="n">written_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader-198"><a href="#DataLoader-198"><span class="linenos">198</span></a>
</span><span id="DataLoader-199"><a href="#DataLoader-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="n">written_dfs</span>
</span><span id="DataLoader-200"><a href="#DataLoader-200"><span class="linenos">200</span></a>
</span><span id="DataLoader-201"><a href="#DataLoader-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataLoader-202"><a href="#DataLoader-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminate the algorithm.</span>
</span><span id="DataLoader-203"><a href="#DataLoader-203"><span class="linenos">203</span></a>
</span><span id="DataLoader-204"><a href="#DataLoader-204"><span class="linenos">204</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-205"><a href="#DataLoader-205"><span class="linenos">205</span></a><span class="sd">            data: dataframes that were written.</span>
</span><span id="DataLoader-206"><a href="#DataLoader-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-207"><a href="#DataLoader-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span>
</span><span id="DataLoader-208"><a href="#DataLoader-208"><span class="linenos">208</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span>
</span><span id="DataLoader-209"><a href="#DataLoader-209"><span class="linenos">209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found terminate specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader-210"><a href="#DataLoader-210"><span class="linenos">210</span></a>                <span class="n">TerminatorFactory</span><span class="o">.</span><span class="n">execute_terminator</span><span class="p">(</span>
</span><span id="DataLoader-211"><a href="#DataLoader-211"><span class="linenos">211</span></a>                    <span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">input_id</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="DataLoader-212"><a href="#DataLoader-212"><span class="linenos">212</span></a>                <span class="p">)</span>
</span><span id="DataLoader-213"><a href="#DataLoader-213"><span class="linenos">213</span></a>
</span><span id="DataLoader-214"><a href="#DataLoader-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">]:</span>
</span><span id="DataLoader-215"><a href="#DataLoader-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the algorithm execution behaviour.&quot;&quot;&quot;</span>
</span><span id="DataLoader-216"><a href="#DataLoader-216"><span class="linenos">216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataLoader-217"><a href="#DataLoader-217"><span class="linenos">217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting read stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader-218"><a href="#DataLoader-218"><span class="linenos">218</span></a>            <span class="n">read_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="DataLoader-219"><a href="#DataLoader-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting transform stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader-220"><a href="#DataLoader-220"><span class="linenos">220</span></a>            <span class="n">transformed_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">read_dfs</span><span class="p">)</span>
</span><span id="DataLoader-221"><a href="#DataLoader-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting data quality stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader-222"><a href="#DataLoader-222"><span class="linenos">222</span></a>            <span class="n">validated_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dq</span><span class="p">(</span><span class="n">transformed_dfs</span><span class="p">)</span>
</span><span id="DataLoader-223"><a href="#DataLoader-223"><span class="linenos">223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting write stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader-224"><a href="#DataLoader-224"><span class="linenos">224</span></a>            <span class="n">written_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">validated_dfs</span><span class="p">)</span>
</span><span id="DataLoader-225"><a href="#DataLoader-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting terminate stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader-226"><a href="#DataLoader-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span><span class="p">(</span><span class="n">written_dfs</span><span class="p">)</span>
</span><span id="DataLoader-227"><a href="#DataLoader-227"><span class="linenos">227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Execution of the algorithm has finished!&quot;</span><span class="p">)</span>
</span><span id="DataLoader-228"><a href="#DataLoader-228"><span class="linenos">228</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataLoader-229"><a href="#DataLoader-229"><span class="linenos">229</span></a>            <span class="n">NotifierFactory</span><span class="o">.</span><span class="n">generate_failure_notification</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="DataLoader-230"><a href="#DataLoader-230"><span class="linenos">230</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="DataLoader-231"><a href="#DataLoader-231"><span class="linenos">231</span></a>
</span><span id="DataLoader-232"><a href="#DataLoader-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">written_dfs</span>
</span><span id="DataLoader-233"><a href="#DataLoader-233"><span class="linenos">233</span></a>
</span><span id="DataLoader-234"><a href="#DataLoader-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">_get_input_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">InputSpec</span><span class="p">]:</span>
</span><span id="DataLoader-235"><a href="#DataLoader-235"><span class="linenos">235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the input specifications from an acon.</span>
</span><span id="DataLoader-236"><a href="#DataLoader-236"><span class="linenos">236</span></a>
</span><span id="DataLoader-237"><a href="#DataLoader-237"><span class="linenos">237</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-238"><a href="#DataLoader-238"><span class="linenos">238</span></a><span class="sd">            List of input specifications.</span>
</span><span id="DataLoader-239"><a href="#DataLoader-239"><span class="linenos">239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-240"><a href="#DataLoader-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">InputSpec</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">)</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;input_specs&quot;</span><span class="p">]]</span>
</span><span id="DataLoader-241"><a href="#DataLoader-241"><span class="linenos">241</span></a>
</span><span id="DataLoader-242"><a href="#DataLoader-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">_get_transform_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformSpec</span><span class="p">]:</span>
</span><span id="DataLoader-243"><a href="#DataLoader-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the transformation specifications from an acon.</span>
</span><span id="DataLoader-244"><a href="#DataLoader-244"><span class="linenos">244</span></a>
</span><span id="DataLoader-245"><a href="#DataLoader-245"><span class="linenos">245</span></a><span class="sd">        If we are executing the algorithm in streaming mode and if the</span>
</span><span id="DataLoader-246"><a href="#DataLoader-246"><span class="linenos">246</span></a><span class="sd">        transformer function is not supported in streaming mode, it is</span>
</span><span id="DataLoader-247"><a href="#DataLoader-247"><span class="linenos">247</span></a><span class="sd">        important to note that ONLY those unsupported operations will</span>
</span><span id="DataLoader-248"><a href="#DataLoader-248"><span class="linenos">248</span></a><span class="sd">        go into the streaming_micro_batch_transformers (see if in the function code),</span>
</span><span id="DataLoader-249"><a href="#DataLoader-249"><span class="linenos">249</span></a><span class="sd">        in the same order that they appear in the list of transformations. This means</span>
</span><span id="DataLoader-250"><a href="#DataLoader-250"><span class="linenos">250</span></a><span class="sd">        that other supported transformations that appear after an</span>
</span><span id="DataLoader-251"><a href="#DataLoader-251"><span class="linenos">251</span></a><span class="sd">        unsupported one continue to stay one the normal execution plan,</span>
</span><span id="DataLoader-252"><a href="#DataLoader-252"><span class="linenos">252</span></a><span class="sd">        i.e., outside the foreachBatch function. Therefore, this may</span>
</span><span id="DataLoader-253"><a href="#DataLoader-253"><span class="linenos">253</span></a><span class="sd">        make your algorithm to execute a different logic than the one you</span>
</span><span id="DataLoader-254"><a href="#DataLoader-254"><span class="linenos">254</span></a><span class="sd">        originally intended. For this reason:</span>
</span><span id="DataLoader-255"><a href="#DataLoader-255"><span class="linenos">255</span></a><span class="sd">            1) ALWAYS PLACE UNSUPPORTED STREAMING TRANSFORMATIONS AT LAST;</span>
</span><span id="DataLoader-256"><a href="#DataLoader-256"><span class="linenos">256</span></a><span class="sd">            2) USE force_streaming_foreach_batch_processing option in transform_spec</span>
</span><span id="DataLoader-257"><a href="#DataLoader-257"><span class="linenos">257</span></a><span class="sd">            section.</span>
</span><span id="DataLoader-258"><a href="#DataLoader-258"><span class="linenos">258</span></a><span class="sd">            3) USE THE CUSTOM_TRANSFORMATION AND WRITE ALL YOUR TRANSFORMATION LOGIC</span>
</span><span id="DataLoader-259"><a href="#DataLoader-259"><span class="linenos">259</span></a><span class="sd">            THERE.</span>
</span><span id="DataLoader-260"><a href="#DataLoader-260"><span class="linenos">260</span></a>
</span><span id="DataLoader-261"><a href="#DataLoader-261"><span class="linenos">261</span></a><span class="sd">        Check list of unsupported spark streaming operations here:</span>
</span><span id="DataLoader-262"><a href="#DataLoader-262"><span class="linenos">262</span></a><span class="sd">        https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#unsupported-operations</span>
</span><span id="DataLoader-263"><a href="#DataLoader-263"><span class="linenos">263</span></a>
</span><span id="DataLoader-264"><a href="#DataLoader-264"><span class="linenos">264</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-265"><a href="#DataLoader-265"><span class="linenos">265</span></a><span class="sd">            List of transformation specifications.</span>
</span><span id="DataLoader-266"><a href="#DataLoader-266"><span class="linenos">266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-267"><a href="#DataLoader-267"><span class="linenos">267</span></a>        <span class="n">input_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_read_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;input_specs&quot;</span><span class="p">])</span>
</span><span id="DataLoader-268"><a href="#DataLoader-268"><span class="linenos">268</span></a>        <span class="n">transform_input_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_input_ids</span><span class="p">(</span>
</span><span id="DataLoader-269"><a href="#DataLoader-269"><span class="linenos">269</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transform_specs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="DataLoader-270"><a href="#DataLoader-270"><span class="linenos">270</span></a>        <span class="p">)</span>
</span><span id="DataLoader-271"><a href="#DataLoader-271"><span class="linenos">271</span></a>        <span class="n">prev_spec_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous_spec_read_types</span><span class="p">(</span>
</span><span id="DataLoader-272"><a href="#DataLoader-272"><span class="linenos">272</span></a>            <span class="n">input_read_types</span><span class="p">,</span> <span class="n">transform_input_ids</span>
</span><span id="DataLoader-273"><a href="#DataLoader-273"><span class="linenos">273</span></a>        <span class="p">)</span>
</span><span id="DataLoader-274"><a href="#DataLoader-274"><span class="linenos">274</span></a>        <span class="n">transform_specs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataLoader-275"><a href="#DataLoader-275"><span class="linenos">275</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transform_specs&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="DataLoader-276"><a href="#DataLoader-276"><span class="linenos">276</span></a>            <span class="n">transform_spec</span> <span class="o">=</span> <span class="n">TransformSpec</span><span class="p">(</span>
</span><span id="DataLoader-277"><a href="#DataLoader-277"><span class="linenos">277</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">],</span>
</span><span id="DataLoader-278"><a href="#DataLoader-278"><span class="linenos">278</span></a>                <span class="n">input_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span>
</span><span id="DataLoader-279"><a href="#DataLoader-279"><span class="linenos">279</span></a>                <span class="n">transformers</span><span class="o">=</span><span class="p">[],</span>
</span><span id="DataLoader-280"><a href="#DataLoader-280"><span class="linenos">280</span></a>                <span class="n">force_streaming_foreach_batch_processing</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataLoader-281"><a href="#DataLoader-281"><span class="linenos">281</span></a>                    <span class="s2">&quot;force_streaming_foreach_batch_processing&quot;</span><span class="p">,</span> <span class="kc">False</span>
</span><span id="DataLoader-282"><a href="#DataLoader-282"><span class="linenos">282</span></a>                <span class="p">),</span>
</span><span id="DataLoader-283"><a href="#DataLoader-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="DataLoader-284"><a href="#DataLoader-284"><span class="linenos">284</span></a>
</span><span id="DataLoader-285"><a href="#DataLoader-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;transformers&quot;</span><span class="p">]:</span>
</span><span id="DataLoader-286"><a href="#DataLoader-286"><span class="linenos">286</span></a>                <span class="n">transformer_spec</span> <span class="o">=</span> <span class="n">TransformerSpec</span><span class="p">(</span>
</span><span id="DataLoader-287"><a href="#DataLoader-287"><span class="linenos">287</span></a>                    <span class="n">function</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="DataLoader-288"><a href="#DataLoader-288"><span class="linenos">288</span></a>                <span class="p">)</span>
</span><span id="DataLoader-289"><a href="#DataLoader-289"><span class="linenos">289</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DataLoader-290"><a href="#DataLoader-290"><span class="linenos">290</span></a>                    <span class="n">prev_spec_read_types</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader-291"><a href="#DataLoader-291"><span class="linenos">291</span></a>                    <span class="o">==</span> <span class="n">ReadType</span><span class="o">.</span><span class="n">STREAMING</span><span class="o">.</span><span class="n">value</span>
</span><span id="DataLoader-292"><a href="#DataLoader-292"><span class="linenos">292</span></a>                    <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span>
</span><span id="DataLoader-293"><a href="#DataLoader-293"><span class="linenos">293</span></a>                    <span class="ow">in</span> <span class="n">TransformerFactory</span><span class="o">.</span><span class="n">UNSUPPORTED_STREAMING_TRANSFORMERS</span>
</span><span id="DataLoader-294"><a href="#DataLoader-294"><span class="linenos">294</span></a>                <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
</span><span id="DataLoader-295"><a href="#DataLoader-295"><span class="linenos">295</span></a>                    <span class="n">prev_spec_read_types</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader-296"><a href="#DataLoader-296"><span class="linenos">296</span></a>                    <span class="o">==</span> <span class="n">ReadType</span><span class="o">.</span><span class="n">STREAMING</span><span class="o">.</span><span class="n">value</span>
</span><span id="DataLoader-297"><a href="#DataLoader-297"><span class="linenos">297</span></a>                    <span class="ow">and</span> <span class="n">transform_spec</span><span class="o">.</span><span class="n">force_streaming_foreach_batch_processing</span>
</span><span id="DataLoader-298"><a href="#DataLoader-298"><span class="linenos">298</span></a>                <span class="p">):</span>
</span><span id="DataLoader-299"><a href="#DataLoader-299"><span class="linenos">299</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_move_to_streaming_micro_batch_transformers</span><span class="p">(</span>
</span><span id="DataLoader-300"><a href="#DataLoader-300"><span class="linenos">300</span></a>                        <span class="n">transform_spec</span><span class="p">,</span> <span class="n">transformer_spec</span>
</span><span id="DataLoader-301"><a href="#DataLoader-301"><span class="linenos">301</span></a>                    <span class="p">)</span>
</span><span id="DataLoader-302"><a href="#DataLoader-302"><span class="linenos">302</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader-303"><a href="#DataLoader-303"><span class="linenos">303</span></a>                    <span class="n">transform_spec</span><span class="o">.</span><span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transformer_spec</span><span class="p">)</span>
</span><span id="DataLoader-304"><a href="#DataLoader-304"><span class="linenos">304</span></a>
</span><span id="DataLoader-305"><a href="#DataLoader-305"><span class="linenos">305</span></a>            <span class="n">transform_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transform_spec</span><span class="p">)</span>
</span><span id="DataLoader-306"><a href="#DataLoader-306"><span class="linenos">306</span></a>
</span><span id="DataLoader-307"><a href="#DataLoader-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">transform_specs</span>
</span><span id="DataLoader-308"><a href="#DataLoader-308"><span class="linenos">308</span></a>
</span><span id="DataLoader-309"><a href="#DataLoader-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="nf">_get_dq_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]:</span>
</span><span id="DataLoader-310"><a href="#DataLoader-310"><span class="linenos">310</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of data quality specification objects from acon.</span>
</span><span id="DataLoader-311"><a href="#DataLoader-311"><span class="linenos">311</span></a>
</span><span id="DataLoader-312"><a href="#DataLoader-312"><span class="linenos">312</span></a><span class="sd">        In streaming mode, we automatically convert the data quality specification in</span>
</span><span id="DataLoader-313"><a href="#DataLoader-313"><span class="linenos">313</span></a><span class="sd">        the streaming_micro_batch_dq_processors list for the respective output spec.</span>
</span><span id="DataLoader-314"><a href="#DataLoader-314"><span class="linenos">314</span></a><span class="sd">        This is needed because our dq process cannot be executed using native streaming</span>
</span><span id="DataLoader-315"><a href="#DataLoader-315"><span class="linenos">315</span></a><span class="sd">        functions.</span>
</span><span id="DataLoader-316"><a href="#DataLoader-316"><span class="linenos">316</span></a>
</span><span id="DataLoader-317"><a href="#DataLoader-317"><span class="linenos">317</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-318"><a href="#DataLoader-318"><span class="linenos">318</span></a><span class="sd">            List of data quality spec objects.</span>
</span><span id="DataLoader-319"><a href="#DataLoader-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-320"><a href="#DataLoader-320"><span class="linenos">320</span></a>        <span class="n">input_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_read_types</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;input_specs&quot;</span><span class="p">])</span>
</span><span id="DataLoader-321"><a href="#DataLoader-321"><span class="linenos">321</span></a>        <span class="n">transform_input_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_input_ids</span><span class="p">(</span>
</span><span id="DataLoader-322"><a href="#DataLoader-322"><span class="linenos">322</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;transform_specs&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="DataLoader-323"><a href="#DataLoader-323"><span class="linenos">323</span></a>        <span class="p">)</span>
</span><span id="DataLoader-324"><a href="#DataLoader-324"><span class="linenos">324</span></a>        <span class="n">prev_spec_read_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_previous_spec_read_types</span><span class="p">(</span>
</span><span id="DataLoader-325"><a href="#DataLoader-325"><span class="linenos">325</span></a>            <span class="n">input_read_types</span><span class="p">,</span> <span class="n">transform_input_ids</span>
</span><span id="DataLoader-326"><a href="#DataLoader-326"><span class="linenos">326</span></a>        <span class="p">)</span>
</span><span id="DataLoader-327"><a href="#DataLoader-327"><span class="linenos">327</span></a>
</span><span id="DataLoader-328"><a href="#DataLoader-328"><span class="linenos">328</span></a>        <span class="n">dq_specs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataLoader-329"><a href="#DataLoader-329"><span class="linenos">329</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dq_specs&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="DataLoader-330"><a href="#DataLoader-330"><span class="linenos">330</span></a>            <span class="n">dq_spec</span><span class="p">,</span> <span class="n">dq_functions</span><span class="p">,</span> <span class="n">critical_functions</span> <span class="o">=</span> <span class="n">Algorithm</span><span class="o">.</span><span class="n">get_dq_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="DataLoader-331"><a href="#DataLoader-331"><span class="linenos">331</span></a>
</span><span id="DataLoader-332"><a href="#DataLoader-332"><span class="linenos">332</span></a>            <span class="k">if</span> <span class="n">prev_spec_read_types</span><span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">ReadType</span><span class="o">.</span><span class="n">STREAMING</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="DataLoader-333"><a href="#DataLoader-333"><span class="linenos">333</span></a>                <span class="c1"># we need to use deepcopy to explicitly create a copy of the dict</span>
</span><span id="DataLoader-334"><a href="#DataLoader-334"><span class="linenos">334</span></a>                <span class="c1"># otherwise python only create binding for dicts, and we would be</span>
</span><span id="DataLoader-335"><a href="#DataLoader-335"><span class="linenos">335</span></a>                <span class="c1"># modifying the original dict, which we don&#39;t want to.</span>
</span><span id="DataLoader-336"><a href="#DataLoader-336"><span class="linenos">336</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_move_to_streaming_micro_batch_dq_processors</span><span class="p">(</span>
</span><span id="DataLoader-337"><a href="#DataLoader-337"><span class="linenos">337</span></a>                    <span class="n">deepcopy</span><span class="p">(</span><span class="n">dq_spec</span><span class="p">),</span> <span class="n">dq_functions</span><span class="p">,</span> <span class="n">critical_functions</span>
</span><span id="DataLoader-338"><a href="#DataLoader-338"><span class="linenos">338</span></a>                <span class="p">)</span>
</span><span id="DataLoader-339"><a href="#DataLoader-339"><span class="linenos">339</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader-340"><a href="#DataLoader-340"><span class="linenos">340</span></a>                <span class="n">dq_spec</span><span class="o">.</span><span class="n">dq_functions</span> <span class="o">=</span> <span class="n">dq_functions</span>
</span><span id="DataLoader-341"><a href="#DataLoader-341"><span class="linenos">341</span></a>                <span class="n">dq_spec</span><span class="o">.</span><span class="n">critical_functions</span> <span class="o">=</span> <span class="n">critical_functions</span>
</span><span id="DataLoader-342"><a href="#DataLoader-342"><span class="linenos">342</span></a>
</span><span id="DataLoader-343"><a href="#DataLoader-343"><span class="linenos">343</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="DataLoader-344"><a href="#DataLoader-344"><span class="linenos">344</span></a>                <span class="sa">f</span><span class="s2">&quot;Streaming Micro Batch DQ Plan: &quot;</span>
</span><span id="DataLoader-345"><a href="#DataLoader-345"><span class="linenos">345</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DataLoader-346"><a href="#DataLoader-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="DataLoader-347"><a href="#DataLoader-347"><span class="linenos">347</span></a>            <span class="n">dq_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dq_spec</span><span class="p">)</span>
</span><span id="DataLoader-348"><a href="#DataLoader-348"><span class="linenos">348</span></a>
</span><span id="DataLoader-349"><a href="#DataLoader-349"><span class="linenos">349</span></a>        <span class="k">return</span> <span class="n">dq_specs</span>
</span><span id="DataLoader-350"><a href="#DataLoader-350"><span class="linenos">350</span></a>
</span><span id="DataLoader-351"><a href="#DataLoader-351"><span class="linenos">351</span></a>    <span class="k">def</span> <span class="nf">_get_output_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputSpec</span><span class="p">]:</span>
</span><span id="DataLoader-352"><a href="#DataLoader-352"><span class="linenos">352</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the output specifications from an acon.</span>
</span><span id="DataLoader-353"><a href="#DataLoader-353"><span class="linenos">353</span></a>
</span><span id="DataLoader-354"><a href="#DataLoader-354"><span class="linenos">354</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-355"><a href="#DataLoader-355"><span class="linenos">355</span></a><span class="sd">            List of output specifications.</span>
</span><span id="DataLoader-356"><a href="#DataLoader-356"><span class="linenos">356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-357"><a href="#DataLoader-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="DataLoader-358"><a href="#DataLoader-358"><span class="linenos">358</span></a>            <span class="n">OutputSpec</span><span class="p">(</span>
</span><span id="DataLoader-359"><a href="#DataLoader-359"><span class="linenos">359</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">],</span>
</span><span id="DataLoader-360"><a href="#DataLoader-360"><span class="linenos">360</span></a>                <span class="n">input_id</span><span class="o">=</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span>
</span><span id="DataLoader-361"><a href="#DataLoader-361"><span class="linenos">361</span></a>                <span class="n">write_type</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;write_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-362"><a href="#DataLoader-362"><span class="linenos">362</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data_format&quot;</span><span class="p">,</span> <span class="n">OutputFormat</span><span class="o">.</span><span class="n">DELTAFILES</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
</span><span id="DataLoader-363"><a href="#DataLoader-363"><span class="linenos">363</span></a>                <span class="n">db_table</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;db_table&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-364"><a href="#DataLoader-364"><span class="linenos">364</span></a>                <span class="n">location</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-365"><a href="#DataLoader-365"><span class="linenos">365</span></a>                <span class="n">merge_opts</span><span class="o">=</span><span class="n">MergeOptions</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;merge_opts&quot;</span><span class="p">])</span>
</span><span id="DataLoader-366"><a href="#DataLoader-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;merge_opts&quot;</span><span class="p">)</span>
</span><span id="DataLoader-367"><a href="#DataLoader-367"><span class="linenos">367</span></a>                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DataLoader-368"><a href="#DataLoader-368"><span class="linenos">368</span></a>                <span class="n">partitions</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;partitions&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="DataLoader-369"><a href="#DataLoader-369"><span class="linenos">369</span></a>                <span class="n">streaming_micro_batch_transformers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_streaming_transformer_plan</span><span class="p">(</span>
</span><span id="DataLoader-370"><a href="#DataLoader-370"><span class="linenos">370</span></a>                    <span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span>
</span><span id="DataLoader-371"><a href="#DataLoader-371"><span class="linenos">371</span></a>                <span class="p">),</span>
</span><span id="DataLoader-372"><a href="#DataLoader-372"><span class="linenos">372</span></a>                <span class="n">streaming_once</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_once&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-373"><a href="#DataLoader-373"><span class="linenos">373</span></a>                <span class="n">streaming_processing_time</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_processing_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-374"><a href="#DataLoader-374"><span class="linenos">374</span></a>                <span class="n">streaming_available_now</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataLoader-375"><a href="#DataLoader-375"><span class="linenos">375</span></a>                    <span class="s2">&quot;streaming_available_now&quot;</span><span class="p">,</span>
</span><span id="DataLoader-376"><a href="#DataLoader-376"><span class="linenos">376</span></a>                    <span class="kc">False</span>
</span><span id="DataLoader-377"><a href="#DataLoader-377"><span class="linenos">377</span></a>                    <span class="k">if</span> <span class="p">(</span>
</span><span id="DataLoader-378"><a href="#DataLoader-378"><span class="linenos">378</span></a>                        <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_once&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DataLoader-379"><a href="#DataLoader-379"><span class="linenos">379</span></a>                        <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_processing_time&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DataLoader-380"><a href="#DataLoader-380"><span class="linenos">380</span></a>                        <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_continuous&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="DataLoader-381"><a href="#DataLoader-381"><span class="linenos">381</span></a>                    <span class="p">)</span>
</span><span id="DataLoader-382"><a href="#DataLoader-382"><span class="linenos">382</span></a>                    <span class="k">else</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="DataLoader-383"><a href="#DataLoader-383"><span class="linenos">383</span></a>                <span class="p">),</span>
</span><span id="DataLoader-384"><a href="#DataLoader-384"><span class="linenos">384</span></a>                <span class="n">streaming_continuous</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming_continuous&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-385"><a href="#DataLoader-385"><span class="linenos">385</span></a>                <span class="n">streaming_await_termination</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataLoader-386"><a href="#DataLoader-386"><span class="linenos">386</span></a>                    <span class="s2">&quot;streaming_await_termination&quot;</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="DataLoader-387"><a href="#DataLoader-387"><span class="linenos">387</span></a>                <span class="p">),</span>
</span><span id="DataLoader-388"><a href="#DataLoader-388"><span class="linenos">388</span></a>                <span class="n">streaming_await_termination_timeout</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="DataLoader-389"><a href="#DataLoader-389"><span class="linenos">389</span></a>                    <span class="s2">&quot;streaming_await_termination_timeout&quot;</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="DataLoader-390"><a href="#DataLoader-390"><span class="linenos">390</span></a>                <span class="p">),</span>
</span><span id="DataLoader-391"><a href="#DataLoader-391"><span class="linenos">391</span></a>                <span class="n">with_batch_id</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;with_batch_id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="DataLoader-392"><a href="#DataLoader-392"><span class="linenos">392</span></a>                <span class="n">options</span><span class="o">=</span><span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="DataLoader-393"><a href="#DataLoader-393"><span class="linenos">393</span></a>                <span class="n">streaming_micro_batch_dq_processors</span><span class="o">=</span><span class="p">(</span>
</span><span id="DataLoader-394"><a href="#DataLoader-394"><span class="linenos">394</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">],</span> <span class="p">[])</span>
</span><span id="DataLoader-395"><a href="#DataLoader-395"><span class="linenos">395</span></a>                <span class="p">),</span>
</span><span id="DataLoader-396"><a href="#DataLoader-396"><span class="linenos">396</span></a>            <span class="p">)</span>
</span><span id="DataLoader-397"><a href="#DataLoader-397"><span class="linenos">397</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="p">[</span><span class="s2">&quot;output_specs&quot;</span><span class="p">]</span>
</span><span id="DataLoader-398"><a href="#DataLoader-398"><span class="linenos">398</span></a>        <span class="p">]</span>
</span><span id="DataLoader-399"><a href="#DataLoader-399"><span class="linenos">399</span></a>
</span><span id="DataLoader-400"><a href="#DataLoader-400"><span class="linenos">400</span></a>    <span class="k">def</span> <span class="nf">_get_streaming_transformer_plan</span><span class="p">(</span>
</span><span id="DataLoader-401"><a href="#DataLoader-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">input_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dq_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]</span>
</span><span id="DataLoader-402"><a href="#DataLoader-402"><span class="linenos">402</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformerSpec</span><span class="p">]:</span>
</span><span id="DataLoader-403"><a href="#DataLoader-403"><span class="linenos">403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the plan for transformations to be applied on streaming micro batches.</span>
</span><span id="DataLoader-404"><a href="#DataLoader-404"><span class="linenos">404</span></a>
</span><span id="DataLoader-405"><a href="#DataLoader-405"><span class="linenos">405</span></a><span class="sd">        When running both DQ processes and transformations in streaming micro batches,</span>
</span><span id="DataLoader-406"><a href="#DataLoader-406"><span class="linenos">406</span></a><span class="sd">        the _streaming_micro_batch_transformers_plan to consider is the one associated</span>
</span><span id="DataLoader-407"><a href="#DataLoader-407"><span class="linenos">407</span></a><span class="sd">        with the transformer spec_id and not with the dq spec_id. Thus, on those cases,</span>
</span><span id="DataLoader-408"><a href="#DataLoader-408"><span class="linenos">408</span></a><span class="sd">        this method maps the input id of the output_spec (which is the spec_id of a</span>
</span><span id="DataLoader-409"><a href="#DataLoader-409"><span class="linenos">409</span></a><span class="sd">        dq_spec) with the dependent transformer spec_id.</span>
</span><span id="DataLoader-410"><a href="#DataLoader-410"><span class="linenos">410</span></a>
</span><span id="DataLoader-411"><a href="#DataLoader-411"><span class="linenos">411</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-412"><a href="#DataLoader-412"><span class="linenos">412</span></a><span class="sd">            input_id: id of the corresponding input specification.</span>
</span><span id="DataLoader-413"><a href="#DataLoader-413"><span class="linenos">413</span></a><span class="sd">            dq_specs: data quality specifications.</span>
</span><span id="DataLoader-414"><a href="#DataLoader-414"><span class="linenos">414</span></a>
</span><span id="DataLoader-415"><a href="#DataLoader-415"><span class="linenos">415</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-416"><a href="#DataLoader-416"><span class="linenos">416</span></a><span class="sd">            a list of TransformerSpec, representing the transformations plan.</span>
</span><span id="DataLoader-417"><a href="#DataLoader-417"><span class="linenos">417</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-418"><a href="#DataLoader-418"><span class="linenos">418</span></a>        <span class="n">transformer_id</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="DataLoader-419"><a href="#DataLoader-419"><span class="linenos">419</span></a>            <span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">input_id</span> <span class="k">for</span> <span class="n">dq_spec</span> <span class="ow">in</span> <span class="n">dq_specs</span> <span class="k">if</span> <span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="o">==</span> <span class="n">input_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="DataLoader-420"><a href="#DataLoader-420"><span class="linenos">420</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">input_id</span><span class="p">)</span>
</span><span id="DataLoader-421"><a href="#DataLoader-421"><span class="linenos">421</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span>
</span><span id="DataLoader-422"><a href="#DataLoader-422"><span class="linenos">422</span></a>            <span class="k">else</span> <span class="n">input_id</span>
</span><span id="DataLoader-423"><a href="#DataLoader-423"><span class="linenos">423</span></a>        <span class="p">)</span>
</span><span id="DataLoader-424"><a href="#DataLoader-424"><span class="linenos">424</span></a>
</span><span id="DataLoader-425"><a href="#DataLoader-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">transformer_id</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="DataLoader-426"><a href="#DataLoader-426"><span class="linenos">426</span></a>
</span><span id="DataLoader-427"><a href="#DataLoader-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">_get_terminate_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">]:</span>
</span><span id="DataLoader-428"><a href="#DataLoader-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the terminate specifications from an acon.</span>
</span><span id="DataLoader-429"><a href="#DataLoader-429"><span class="linenos">429</span></a>
</span><span id="DataLoader-430"><a href="#DataLoader-430"><span class="linenos">430</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-431"><a href="#DataLoader-431"><span class="linenos">431</span></a><span class="sd">            List of terminate specifications.</span>
</span><span id="DataLoader-432"><a href="#DataLoader-432"><span class="linenos">432</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-433"><a href="#DataLoader-433"><span class="linenos">433</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">(</span><span class="o">**</span><span class="n">spec</span><span class="p">)</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acon</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;terminate_specs&quot;</span><span class="p">,</span> <span class="p">[])]</span>
</span><span id="DataLoader-434"><a href="#DataLoader-434"><span class="linenos">434</span></a>
</span><span id="DataLoader-435"><a href="#DataLoader-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">_move_to_streaming_micro_batch_transformers</span><span class="p">(</span>
</span><span id="DataLoader-436"><a href="#DataLoader-436"><span class="linenos">436</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">transform_spec</span><span class="p">:</span> <span class="n">TransformSpec</span><span class="p">,</span> <span class="n">transformer_spec</span><span class="p">:</span> <span class="n">TransformerSpec</span>
</span><span id="DataLoader-437"><a href="#DataLoader-437"><span class="linenos">437</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataLoader-438"><a href="#DataLoader-438"><span class="linenos">438</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move the transformer to the list of streaming micro batch transformations.</span>
</span><span id="DataLoader-439"><a href="#DataLoader-439"><span class="linenos">439</span></a>
</span><span id="DataLoader-440"><a href="#DataLoader-440"><span class="linenos">440</span></a><span class="sd">        If the transform specs contain functions that cannot be executed in streaming</span>
</span><span id="DataLoader-441"><a href="#DataLoader-441"><span class="linenos">441</span></a><span class="sd">        mode, this function sends those functions to the output specs</span>
</span><span id="DataLoader-442"><a href="#DataLoader-442"><span class="linenos">442</span></a><span class="sd">        streaming_micro_batch_transformers, where they will be executed inside the</span>
</span><span id="DataLoader-443"><a href="#DataLoader-443"><span class="linenos">443</span></a><span class="sd">        stream foreachBatch function.</span>
</span><span id="DataLoader-444"><a href="#DataLoader-444"><span class="linenos">444</span></a>
</span><span id="DataLoader-445"><a href="#DataLoader-445"><span class="linenos">445</span></a><span class="sd">        To accomplish that we use an instance variable that associates the</span>
</span><span id="DataLoader-446"><a href="#DataLoader-446"><span class="linenos">446</span></a><span class="sd">        streaming_micro_batch_transformers to each output spec, in order to do reverse</span>
</span><span id="DataLoader-447"><a href="#DataLoader-447"><span class="linenos">447</span></a><span class="sd">        lookup when creating the OutputSpec.</span>
</span><span id="DataLoader-448"><a href="#DataLoader-448"><span class="linenos">448</span></a>
</span><span id="DataLoader-449"><a href="#DataLoader-449"><span class="linenos">449</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-450"><a href="#DataLoader-450"><span class="linenos">450</span></a><span class="sd">            transform_spec: transform specification (overall</span>
</span><span id="DataLoader-451"><a href="#DataLoader-451"><span class="linenos">451</span></a><span class="sd">                transformation specification - a transformation may contain multiple</span>
</span><span id="DataLoader-452"><a href="#DataLoader-452"><span class="linenos">452</span></a><span class="sd">                transformers).</span>
</span><span id="DataLoader-453"><a href="#DataLoader-453"><span class="linenos">453</span></a><span class="sd">            transformer_spec: the specific transformer function and arguments.</span>
</span><span id="DataLoader-454"><a href="#DataLoader-454"><span class="linenos">454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-455"><a href="#DataLoader-455"><span class="linenos">455</span></a>        <span class="k">if</span> <span class="n">transform_spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">:</span>
</span><span id="DataLoader-456"><a href="#DataLoader-456"><span class="linenos">456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataLoader-457"><a href="#DataLoader-457"><span class="linenos">457</span></a>
</span><span id="DataLoader-458"><a href="#DataLoader-458"><span class="linenos">458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">[</span><span class="n">transform_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="DataLoader-459"><a href="#DataLoader-459"><span class="linenos">459</span></a>            <span class="n">transformer_spec</span>
</span><span id="DataLoader-460"><a href="#DataLoader-460"><span class="linenos">460</span></a>        <span class="p">)</span>
</span><span id="DataLoader-461"><a href="#DataLoader-461"><span class="linenos">461</span></a>
</span><span id="DataLoader-462"><a href="#DataLoader-462"><span class="linenos">462</span></a>    <span class="k">def</span> <span class="nf">_move_to_streaming_micro_batch_dq_processors</span><span class="p">(</span>
</span><span id="DataLoader-463"><a href="#DataLoader-463"><span class="linenos">463</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DataLoader-464"><a href="#DataLoader-464"><span class="linenos">464</span></a>        <span class="n">dq_spec</span><span class="p">:</span> <span class="n">DQSpec</span><span class="p">,</span>
</span><span id="DataLoader-465"><a href="#DataLoader-465"><span class="linenos">465</span></a>        <span class="n">dq_functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQFunctionSpec</span><span class="p">],</span>
</span><span id="DataLoader-466"><a href="#DataLoader-466"><span class="linenos">466</span></a>        <span class="n">critical_functions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQFunctionSpec</span><span class="p">],</span>
</span><span id="DataLoader-467"><a href="#DataLoader-467"><span class="linenos">467</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataLoader-468"><a href="#DataLoader-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Move the dq function to the list of streaming micro batch transformations.</span>
</span><span id="DataLoader-469"><a href="#DataLoader-469"><span class="linenos">469</span></a>
</span><span id="DataLoader-470"><a href="#DataLoader-470"><span class="linenos">470</span></a><span class="sd">        If the dq specs contain functions that cannot be executed in streaming mode,</span>
</span><span id="DataLoader-471"><a href="#DataLoader-471"><span class="linenos">471</span></a><span class="sd">        this function sends those functions to the output specs</span>
</span><span id="DataLoader-472"><a href="#DataLoader-472"><span class="linenos">472</span></a><span class="sd">        streaming_micro_batch_dq_processors, where they will be executed inside the</span>
</span><span id="DataLoader-473"><a href="#DataLoader-473"><span class="linenos">473</span></a><span class="sd">        stream foreachBatch function.</span>
</span><span id="DataLoader-474"><a href="#DataLoader-474"><span class="linenos">474</span></a>
</span><span id="DataLoader-475"><a href="#DataLoader-475"><span class="linenos">475</span></a><span class="sd">        To accomplish that we use an instance variable that associates the</span>
</span><span id="DataLoader-476"><a href="#DataLoader-476"><span class="linenos">476</span></a><span class="sd">        streaming_micro_batch_dq_processors to each output spec, in order to do reverse</span>
</span><span id="DataLoader-477"><a href="#DataLoader-477"><span class="linenos">477</span></a><span class="sd">        lookup when creating the OutputSpec.</span>
</span><span id="DataLoader-478"><a href="#DataLoader-478"><span class="linenos">478</span></a>
</span><span id="DataLoader-479"><a href="#DataLoader-479"><span class="linenos">479</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-480"><a href="#DataLoader-480"><span class="linenos">480</span></a><span class="sd">            dq_spec: dq specification (overall dq process specification).</span>
</span><span id="DataLoader-481"><a href="#DataLoader-481"><span class="linenos">481</span></a><span class="sd">            dq_functions: the list of dq functions to be considered.</span>
</span><span id="DataLoader-482"><a href="#DataLoader-482"><span class="linenos">482</span></a><span class="sd">            critical_functions: list of critical functions to be considered.</span>
</span><span id="DataLoader-483"><a href="#DataLoader-483"><span class="linenos">483</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-484"><a href="#DataLoader-484"><span class="linenos">484</span></a>        <span class="k">if</span> <span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">:</span>
</span><span id="DataLoader-485"><a href="#DataLoader-485"><span class="linenos">485</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DataLoader-486"><a href="#DataLoader-486"><span class="linenos">486</span></a>
</span><span id="DataLoader-487"><a href="#DataLoader-487"><span class="linenos">487</span></a>        <span class="n">dq_spec</span><span class="o">.</span><span class="n">dq_functions</span> <span class="o">=</span> <span class="n">dq_functions</span>
</span><span id="DataLoader-488"><a href="#DataLoader-488"><span class="linenos">488</span></a>        <span class="n">dq_spec</span><span class="o">.</span><span class="n">critical_functions</span> <span class="o">=</span> <span class="n">critical_functions</span>
</span><span id="DataLoader-489"><a href="#DataLoader-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">[</span><span class="n">dq_spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dq_spec</span><span class="p">)</span>
</span><span id="DataLoader-490"><a href="#DataLoader-490"><span class="linenos">490</span></a>
</span><span id="DataLoader-491"><a href="#DataLoader-491"><span class="linenos">491</span></a>    <span class="nd">@staticmethod</span>
</span><span id="DataLoader-492"><a href="#DataLoader-492"><span class="linenos">492</span></a>    <span class="k">def</span> <span class="nf">_get_input_read_types</span><span class="p">(</span><span class="n">list_of_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="DataLoader-493"><a href="#DataLoader-493"><span class="linenos">493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a dict of spec ids and read types from a list of input specs.</span>
</span><span id="DataLoader-494"><a href="#DataLoader-494"><span class="linenos">494</span></a>
</span><span id="DataLoader-495"><a href="#DataLoader-495"><span class="linenos">495</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-496"><a href="#DataLoader-496"><span class="linenos">496</span></a><span class="sd">            list_of_specs: list of input specs ([{k:v}]).</span>
</span><span id="DataLoader-497"><a href="#DataLoader-497"><span class="linenos">497</span></a>
</span><span id="DataLoader-498"><a href="#DataLoader-498"><span class="linenos">498</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-499"><a href="#DataLoader-499"><span class="linenos">499</span></a><span class="sd">            Dict of {input_spec_id: read_type}.</span>
</span><span id="DataLoader-500"><a href="#DataLoader-500"><span class="linenos">500</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-501"><a href="#DataLoader-501"><span class="linenos">501</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;read_type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_of_specs</span><span class="p">}</span>
</span><span id="DataLoader-502"><a href="#DataLoader-502"><span class="linenos">502</span></a>
</span><span id="DataLoader-503"><a href="#DataLoader-503"><span class="linenos">503</span></a>    <span class="nd">@staticmethod</span>
</span><span id="DataLoader-504"><a href="#DataLoader-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="nf">_get_transform_input_ids</span><span class="p">(</span><span class="n">list_of_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="DataLoader-505"><a href="#DataLoader-505"><span class="linenos">505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a dict of transform spec ids and input ids from list of transform specs.</span>
</span><span id="DataLoader-506"><a href="#DataLoader-506"><span class="linenos">506</span></a>
</span><span id="DataLoader-507"><a href="#DataLoader-507"><span class="linenos">507</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-508"><a href="#DataLoader-508"><span class="linenos">508</span></a><span class="sd">            list_of_specs: list of transform specs ([{k:v}]).</span>
</span><span id="DataLoader-509"><a href="#DataLoader-509"><span class="linenos">509</span></a>
</span><span id="DataLoader-510"><a href="#DataLoader-510"><span class="linenos">510</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-511"><a href="#DataLoader-511"><span class="linenos">511</span></a><span class="sd">            Dict of {transform_spec_id: input_id}.</span>
</span><span id="DataLoader-512"><a href="#DataLoader-512"><span class="linenos">512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-513"><a href="#DataLoader-513"><span class="linenos">513</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;spec_id&quot;</span><span class="p">]:</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;input_id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_of_specs</span><span class="p">}</span>
</span><span id="DataLoader-514"><a href="#DataLoader-514"><span class="linenos">514</span></a>
</span><span id="DataLoader-515"><a href="#DataLoader-515"><span class="linenos">515</span></a>    <span class="nd">@staticmethod</span>
</span><span id="DataLoader-516"><a href="#DataLoader-516"><span class="linenos">516</span></a>    <span class="k">def</span> <span class="nf">_get_previous_spec_read_types</span><span class="p">(</span>
</span><span id="DataLoader-517"><a href="#DataLoader-517"><span class="linenos">517</span></a>        <span class="n">input_read_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">transform_input_ids</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="DataLoader-518"><a href="#DataLoader-518"><span class="linenos">518</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="DataLoader-519"><a href="#DataLoader-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the read types of the previous specification: input and/or transform.</span>
</span><span id="DataLoader-520"><a href="#DataLoader-520"><span class="linenos">520</span></a>
</span><span id="DataLoader-521"><a href="#DataLoader-521"><span class="linenos">521</span></a><span class="sd">        For the chaining transformations and for DQ process to work seamlessly in batch</span>
</span><span id="DataLoader-522"><a href="#DataLoader-522"><span class="linenos">522</span></a><span class="sd">        and streaming mode, we have to figure out if the previous spec to the transform</span>
</span><span id="DataLoader-523"><a href="#DataLoader-523"><span class="linenos">523</span></a><span class="sd">        or dq spec(e.g., input spec or transform spec) refers to a batch read type or</span>
</span><span id="DataLoader-524"><a href="#DataLoader-524"><span class="linenos">524</span></a><span class="sd">        a streaming read type.</span>
</span><span id="DataLoader-525"><a href="#DataLoader-525"><span class="linenos">525</span></a>
</span><span id="DataLoader-526"><a href="#DataLoader-526"><span class="linenos">526</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader-527"><a href="#DataLoader-527"><span class="linenos">527</span></a><span class="sd">            input_read_types: dict of {input_spec_id: read_type}.</span>
</span><span id="DataLoader-528"><a href="#DataLoader-528"><span class="linenos">528</span></a><span class="sd">            transform_input_ids: dict of {transform_spec_id: input_id}.</span>
</span><span id="DataLoader-529"><a href="#DataLoader-529"><span class="linenos">529</span></a>
</span><span id="DataLoader-530"><a href="#DataLoader-530"><span class="linenos">530</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader-531"><a href="#DataLoader-531"><span class="linenos">531</span></a><span class="sd">            Dict of {input_spec_id or transform_spec_id: read_type}</span>
</span><span id="DataLoader-532"><a href="#DataLoader-532"><span class="linenos">532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader-533"><a href="#DataLoader-533"><span class="linenos">533</span></a>        <span class="n">combined_read_types</span> <span class="o">=</span> <span class="n">input_read_types</span>
</span><span id="DataLoader-534"><a href="#DataLoader-534"><span class="linenos">534</span></a>        <span class="k">for</span> <span class="n">spec_id</span><span class="p">,</span> <span class="n">input_id</span> <span class="ow">in</span> <span class="n">transform_input_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="DataLoader-535"><a href="#DataLoader-535"><span class="linenos">535</span></a>            <span class="n">combined_read_types</span><span class="p">[</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">combined_read_types</span><span class="p">[</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader-536"><a href="#DataLoader-536"><span class="linenos">536</span></a>
</span><span id="DataLoader-537"><a href="#DataLoader-537"><span class="linenos">537</span></a>        <span class="k">return</span> <span class="n">combined_read_types</span>
</span></pre></div>


            <div class="docstring"><p>Load data using an algorithm configuration (ACON represented as dict).</p>

<p>This algorithm focuses on the cases where users will be specifying all the algorithm
steps and configurations through a dict based configuration, which we name ACON
in our framework.</p>

<p>Since an ACON is a dict you can pass a custom transformer through a python function
and, therefore, the DataLoader can also be used to load data with custom
transformations not provided in our transformers package.</p>

<p>As the algorithm base class of the lakehouse-engine framework is based on the
concept of ACON, this DataLoader algorithm simply inherits from Algorithm,
without overriding anything. We designed the codebase like this to avoid
instantiating the Algorithm class directly, which was always meant to be an
abstraction for any specific algorithm included in the lakehouse-engine framework.</p>
</div>


                    <div id="DataLoader.__init__" class="classattr">
                                <input id="DataLoader.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DataLoader</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">acon</span><span class="p">:</span> <span class="nb">dict</span></span>)</span>

                <label class="view-source-button" for="DataLoader.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.__init__-49"><a href="#DataLoader.__init__-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acon</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="DataLoader.__init__-50"><a href="#DataLoader.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct DataLoader algorithm instances.</span>
</span><span id="DataLoader.__init__-51"><a href="#DataLoader.__init__-51"><span class="linenos">51</span></a>
</span><span id="DataLoader.__init__-52"><a href="#DataLoader.__init__-52"><span class="linenos">52</span></a><span class="sd">        A data loader needs several specifications to work properly,</span>
</span><span id="DataLoader.__init__-53"><a href="#DataLoader.__init__-53"><span class="linenos">53</span></a><span class="sd">        but some of them might be optional. The available specifications are:</span>
</span><span id="DataLoader.__init__-54"><a href="#DataLoader.__init__-54"><span class="linenos">54</span></a>
</span><span id="DataLoader.__init__-55"><a href="#DataLoader.__init__-55"><span class="linenos">55</span></a><span class="sd">        - input specifications (mandatory): specify how to read data.</span>
</span><span id="DataLoader.__init__-56"><a href="#DataLoader.__init__-56"><span class="linenos">56</span></a><span class="sd">        - transform specifications (optional): specify how to transform data.</span>
</span><span id="DataLoader.__init__-57"><a href="#DataLoader.__init__-57"><span class="linenos">57</span></a><span class="sd">        - data quality specifications (optional): specify how to execute the data</span>
</span><span id="DataLoader.__init__-58"><a href="#DataLoader.__init__-58"><span class="linenos">58</span></a><span class="sd">            quality process.</span>
</span><span id="DataLoader.__init__-59"><a href="#DataLoader.__init__-59"><span class="linenos">59</span></a><span class="sd">        - output specifications (mandatory): specify how to write data to the</span>
</span><span id="DataLoader.__init__-60"><a href="#DataLoader.__init__-60"><span class="linenos">60</span></a><span class="sd">            target.</span>
</span><span id="DataLoader.__init__-61"><a href="#DataLoader.__init__-61"><span class="linenos">61</span></a><span class="sd">        - terminate specifications (optional): specify what to do after writing into</span>
</span><span id="DataLoader.__init__-62"><a href="#DataLoader.__init__-62"><span class="linenos">62</span></a><span class="sd">            the target (e.g., optimizing target table, vacuum, compute stats, etc).</span>
</span><span id="DataLoader.__init__-63"><a href="#DataLoader.__init__-63"><span class="linenos">63</span></a>
</span><span id="DataLoader.__init__-64"><a href="#DataLoader.__init__-64"><span class="linenos">64</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader.__init__-65"><a href="#DataLoader.__init__-65"><span class="linenos">65</span></a><span class="sd">            acon: algorithm configuration.</span>
</span><span id="DataLoader.__init__-66"><a href="#DataLoader.__init__-66"><span class="linenos">66</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader.__init__-67"><a href="#DataLoader.__init__-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="DataLoader.__init__-68"><a href="#DataLoader.__init__-68"><span class="linenos">68</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">acon</span><span class="p">)</span>
</span><span id="DataLoader.__init__-69"><a href="#DataLoader.__init__-69"><span class="linenos">69</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_specs</span><span class="p">()</span>
</span><span id="DataLoader.__init__-70"><a href="#DataLoader.__init__-70"><span class="linenos">70</span></a>        <span class="c1"># the streaming transformers plan is needed to future change the</span>
</span><span id="DataLoader.__init__-71"><a href="#DataLoader.__init__-71"><span class="linenos">71</span></a>        <span class="c1"># execution specification to accommodate streaming mode limitations in invoking</span>
</span><span id="DataLoader.__init__-72"><a href="#DataLoader.__init__-72"><span class="linenos">72</span></a>        <span class="c1"># certain functions (e.g., sort, window, generate row ids/auto increments, ...).</span>
</span><span id="DataLoader.__init__-73"><a href="#DataLoader.__init__-73"><span class="linenos">73</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_transformers_plan</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DataLoader.__init__-74"><a href="#DataLoader.__init__-74"><span class="linenos">74</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TransformSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_transform_specs</span><span class="p">()</span>
</span><span id="DataLoader.__init__-75"><a href="#DataLoader.__init__-75"><span class="linenos">75</span></a>        <span class="c1"># our data quality process is not compatible with streaming mode, hence we</span>
</span><span id="DataLoader.__init__-76"><a href="#DataLoader.__init__-76"><span class="linenos">76</span></a>        <span class="c1"># have to run it in micro batches, similar to what happens to certain</span>
</span><span id="DataLoader.__init__-77"><a href="#DataLoader.__init__-77"><span class="linenos">77</span></a>        <span class="c1"># transformation functions not supported in streaming mode.</span>
</span><span id="DataLoader.__init__-78"><a href="#DataLoader.__init__-78"><span class="linenos">78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="DataLoader.__init__-79"><a href="#DataLoader.__init__-79"><span class="linenos">79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DQSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dq_specs</span><span class="p">()</span>
</span><span id="DataLoader.__init__-80"><a href="#DataLoader.__init__-80"><span class="linenos">80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OutputSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_output_specs</span><span class="p">()</span>
</span><span id="DataLoader.__init__-81"><a href="#DataLoader.__init__-81"><span class="linenos">81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TerminatorSpec</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_terminate_specs</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Construct DataLoader algorithm instances.</p>

<p>A data loader needs several specifications to work properly,
but some of them might be optional. The available specifications are:</p>

<ul>
<li>input specifications (mandatory): specify how to read data.</li>
<li>transform specifications (optional): specify how to transform data.</li>
<li>data quality specifications (optional): specify how to execute the data
quality process.</li>
<li>output specifications (mandatory): specify how to write data to the
target.</li>
<li>terminate specifications (optional): specify what to do after writing into
the target (e.g., optimizing target table, vacuum, compute stats, etc).</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>acon:</strong>  algorithm configuration.</li>
</ul>
</div>


                    </div>
                    <div id="DataLoader.read" class="classattr">
                                <input id="DataLoader.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span>:</span></span>

                <label class="view-source-button" for="DataLoader.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.read-83"><a href="#DataLoader.read-83"><span class="linenos">83</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader.read-84"><a href="#DataLoader.read-84"><span class="linenos">84</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read data from an input location into a distributed dataframe.</span>
</span><span id="DataLoader.read-85"><a href="#DataLoader.read-85"><span class="linenos">85</span></a>
</span><span id="DataLoader.read-86"><a href="#DataLoader.read-86"><span class="linenos">86</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader.read-87"><a href="#DataLoader.read-87"><span class="linenos">87</span></a><span class="sd">             An ordered dict with all the dataframes that were read.</span>
</span><span id="DataLoader.read-88"><a href="#DataLoader.read-88"><span class="linenos">88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader.read-89"><a href="#DataLoader.read-89"><span class="linenos">89</span></a>        <span class="n">read_dfs</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({})</span>
</span><span id="DataLoader.read-90"><a href="#DataLoader.read-90"><span class="linenos">90</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_specs</span><span class="p">:</span>
</span><span id="DataLoader.read-91"><a href="#DataLoader.read-91"><span class="linenos">91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found input specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader.read-92"><a href="#DataLoader.read-92"><span class="linenos">92</span></a>            <span class="n">read_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</span><span id="DataLoader.read-93"><a href="#DataLoader.read-93"><span class="linenos">93</span></a>        <span class="k">return</span> <span class="n">read_dfs</span>
</span></pre></div>


            <div class="docstring"><p>Read data from an input location into a distributed dataframe.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>An ordered dict with all the dataframes that were read.</p>
</blockquote>
</div>


                    </div>
                    <div id="DataLoader.transform" class="classattr">
                                <input id="DataLoader.transform-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transform</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span></span><span class="return-annotation">) -> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span>:</span></span>

                <label class="view-source-button" for="DataLoader.transform-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.transform"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.transform-95"><a href="#DataLoader.transform-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader.transform-96"><a href="#DataLoader.transform-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform (optionally) the data that was read.</span>
</span><span id="DataLoader.transform-97"><a href="#DataLoader.transform-97"><span class="linenos"> 97</span></a>
</span><span id="DataLoader.transform-98"><a href="#DataLoader.transform-98"><span class="linenos"> 98</span></a><span class="sd">        If there isn&#39;t a transformation specification this step will be skipped, and the</span>
</span><span id="DataLoader.transform-99"><a href="#DataLoader.transform-99"><span class="linenos"> 99</span></a><span class="sd">        original dataframes that were read will be returned.</span>
</span><span id="DataLoader.transform-100"><a href="#DataLoader.transform-100"><span class="linenos">100</span></a><span class="sd">        Transformations can have dependency from another transformation result, however</span>
</span><span id="DataLoader.transform-101"><a href="#DataLoader.transform-101"><span class="linenos">101</span></a><span class="sd">        we need to keep in mind if we are using streaming source and for some reason we</span>
</span><span id="DataLoader.transform-102"><a href="#DataLoader.transform-102"><span class="linenos">102</span></a><span class="sd">        need to enable micro batch processing, this result cannot be used as input to</span>
</span><span id="DataLoader.transform-103"><a href="#DataLoader.transform-103"><span class="linenos">103</span></a><span class="sd">        another transformation. Micro batch processing in pyspark streaming is only</span>
</span><span id="DataLoader.transform-104"><a href="#DataLoader.transform-104"><span class="linenos">104</span></a><span class="sd">        available in .write(), which means this transformation with micro batch needs</span>
</span><span id="DataLoader.transform-105"><a href="#DataLoader.transform-105"><span class="linenos">105</span></a><span class="sd">        to be the end of the process.</span>
</span><span id="DataLoader.transform-106"><a href="#DataLoader.transform-106"><span class="linenos">106</span></a>
</span><span id="DataLoader.transform-107"><a href="#DataLoader.transform-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader.transform-108"><a href="#DataLoader.transform-108"><span class="linenos">108</span></a><span class="sd">            data: input dataframes in an ordered dict.</span>
</span><span id="DataLoader.transform-109"><a href="#DataLoader.transform-109"><span class="linenos">109</span></a>
</span><span id="DataLoader.transform-110"><a href="#DataLoader.transform-110"><span class="linenos">110</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader.transform-111"><a href="#DataLoader.transform-111"><span class="linenos">111</span></a><span class="sd">            Another ordered dict with the transformed dataframes, according to the</span>
</span><span id="DataLoader.transform-112"><a href="#DataLoader.transform-112"><span class="linenos">112</span></a><span class="sd">            transformation specification.</span>
</span><span id="DataLoader.transform-113"><a href="#DataLoader.transform-113"><span class="linenos">113</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader.transform-114"><a href="#DataLoader.transform-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span>
</span><span id="DataLoader.transform-115"><a href="#DataLoader.transform-115"><span class="linenos">115</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="DataLoader.transform-116"><a href="#DataLoader.transform-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader.transform-117"><a href="#DataLoader.transform-117"><span class="linenos">117</span></a>            <span class="n">transformed_dfs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DataLoader.transform-118"><a href="#DataLoader.transform-118"><span class="linenos">118</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_specs</span><span class="p">:</span>
</span><span id="DataLoader.transform-119"><a href="#DataLoader.transform-119"><span class="linenos">119</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found transform specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader.transform-120"><a href="#DataLoader.transform-120"><span class="linenos">120</span></a>                <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transformed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader.transform-121"><a href="#DataLoader.transform-121"><span class="linenos">121</span></a>                <span class="k">for</span> <span class="n">transformer</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">transformers</span><span class="p">:</span>
</span><span id="DataLoader.transform-122"><a href="#DataLoader.transform-122"><span class="linenos">122</span></a>                    <span class="n">transformed_df</span> <span class="o">=</span> <span class="n">transformed_df</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
</span><span id="DataLoader.transform-123"><a href="#DataLoader.transform-123"><span class="linenos">123</span></a>                        <span class="n">TransformerFactory</span><span class="o">.</span><span class="n">get_transformer</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">transformed_dfs</span><span class="p">)</span>
</span><span id="DataLoader.transform-124"><a href="#DataLoader.transform-124"><span class="linenos">124</span></a>                    <span class="p">)</span>
</span><span id="DataLoader.transform-125"><a href="#DataLoader.transform-125"><span class="linenos">125</span></a>                <span class="n">transformed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">transformed_df</span>
</span><span id="DataLoader.transform-126"><a href="#DataLoader.transform-126"><span class="linenos">126</span></a>            <span class="k">return</span> <span class="n">transformed_dfs</span>
</span></pre></div>


            <div class="docstring"><p>Transform (optionally) the data that was read.</p>

<p>If there isn't a transformation specification this step will be skipped, and the
original dataframes that were read will be returned.
Transformations can have dependency from another transformation result, however
we need to keep in mind if we are using streaming source and for some reason we
need to enable micro batch processing, this result cannot be used as input to
another transformation. Micro batch processing in pyspark streaming is only
available in .write(), which means this transformation with micro batch needs
to be the end of the process.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data:</strong>  input dataframes in an ordered dict.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Another ordered dict with the transformed dataframes, according to the
  transformation specification.</p>
</blockquote>
</div>


                    </div>
                    <div id="DataLoader.process_dq" class="classattr">
                                <input id="DataLoader.process_dq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">process_dq</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span></span><span class="return-annotation">) -> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span>:</span></span>

                <label class="view-source-button" for="DataLoader.process_dq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.process_dq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.process_dq-128"><a href="#DataLoader.process_dq-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">process_dq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader.process_dq-129"><a href="#DataLoader.process_dq-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Process the data quality tasks for the data that was read and/or transformed.</span>
</span><span id="DataLoader.process_dq-130"><a href="#DataLoader.process_dq-130"><span class="linenos">130</span></a>
</span><span id="DataLoader.process_dq-131"><a href="#DataLoader.process_dq-131"><span class="linenos">131</span></a><span class="sd">        It supports multiple input dataframes. Although just one is advisable.</span>
</span><span id="DataLoader.process_dq-132"><a href="#DataLoader.process_dq-132"><span class="linenos">132</span></a>
</span><span id="DataLoader.process_dq-133"><a href="#DataLoader.process_dq-133"><span class="linenos">133</span></a><span class="sd">        It is possible to use data quality validators/expectations that will validate</span>
</span><span id="DataLoader.process_dq-134"><a href="#DataLoader.process_dq-134"><span class="linenos">134</span></a><span class="sd">        your data and fail the process in case the expectations are not met. The DQ</span>
</span><span id="DataLoader.process_dq-135"><a href="#DataLoader.process_dq-135"><span class="linenos">135</span></a><span class="sd">        process also generates and keeps updating a site containing the results of the</span>
</span><span id="DataLoader.process_dq-136"><a href="#DataLoader.process_dq-136"><span class="linenos">136</span></a><span class="sd">        expectations that were done on your data. The location of the site is</span>
</span><span id="DataLoader.process_dq-137"><a href="#DataLoader.process_dq-137"><span class="linenos">137</span></a><span class="sd">        configurable and can either be on file system or S3. If you define it to be</span>
</span><span id="DataLoader.process_dq-138"><a href="#DataLoader.process_dq-138"><span class="linenos">138</span></a><span class="sd">        stored on S3, you can even configure your S3 bucket to serve the site so that</span>
</span><span id="DataLoader.process_dq-139"><a href="#DataLoader.process_dq-139"><span class="linenos">139</span></a><span class="sd">        people can easily check the quality of your data. Moreover, it is also</span>
</span><span id="DataLoader.process_dq-140"><a href="#DataLoader.process_dq-140"><span class="linenos">140</span></a><span class="sd">        possible to store the result of the DQ process into a defined result sink.</span>
</span><span id="DataLoader.process_dq-141"><a href="#DataLoader.process_dq-141"><span class="linenos">141</span></a>
</span><span id="DataLoader.process_dq-142"><a href="#DataLoader.process_dq-142"><span class="linenos">142</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader.process_dq-143"><a href="#DataLoader.process_dq-143"><span class="linenos">143</span></a><span class="sd">            data: dataframes from previous steps of the algorithm that we which to</span>
</span><span id="DataLoader.process_dq-144"><a href="#DataLoader.process_dq-144"><span class="linenos">144</span></a><span class="sd">                run the DQ process on.</span>
</span><span id="DataLoader.process_dq-145"><a href="#DataLoader.process_dq-145"><span class="linenos">145</span></a>
</span><span id="DataLoader.process_dq-146"><a href="#DataLoader.process_dq-146"><span class="linenos">146</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader.process_dq-147"><a href="#DataLoader.process_dq-147"><span class="linenos">147</span></a><span class="sd">            Another ordered dict with the validated dataframes.</span>
</span><span id="DataLoader.process_dq-148"><a href="#DataLoader.process_dq-148"><span class="linenos">148</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader.process_dq-149"><a href="#DataLoader.process_dq-149"><span class="linenos">149</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span>
</span><span id="DataLoader.process_dq-150"><a href="#DataLoader.process_dq-150"><span class="linenos">150</span></a>            <span class="k">return</span> <span class="n">data</span>
</span><span id="DataLoader.process_dq-151"><a href="#DataLoader.process_dq-151"><span class="linenos">151</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader.process_dq-152"><a href="#DataLoader.process_dq-152"><span class="linenos">152</span></a>            <span class="n">dq_processed_dfs</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="DataLoader.process_dq-153"><a href="#DataLoader.process_dq-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_specs</span><span class="p">:</span>
</span><span id="DataLoader.process_dq-154"><a href="#DataLoader.process_dq-154"><span class="linenos">154</span></a>                <span class="n">df_processed_df</span> <span class="o">=</span> <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader.process_dq-155"><a href="#DataLoader.process_dq-155"><span class="linenos">155</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found data quality specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader.process_dq-156"><a href="#DataLoader.process_dq-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="DataLoader.process_dq-157"><a href="#DataLoader.process_dq-157"><span class="linenos">157</span></a>                    <span class="n">spec</span><span class="o">.</span><span class="n">dq_functions</span>
</span><span id="DataLoader.process_dq-158"><a href="#DataLoader.process_dq-158"><span class="linenos">158</span></a>                    <span class="ow">or</span> <span class="n">spec</span><span class="o">.</span><span class="n">dq_type</span> <span class="o">==</span> <span class="n">DQType</span><span class="o">.</span><span class="n">ASSISTANT</span><span class="o">.</span><span class="n">value</span>
</span><span id="DataLoader.process_dq-159"><a href="#DataLoader.process_dq-159"><span class="linenos">159</span></a>                    <span class="ow">and</span> <span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_streaming_micro_batch_dq_plan</span>
</span><span id="DataLoader.process_dq-160"><a href="#DataLoader.process_dq-160"><span class="linenos">160</span></a>                <span class="p">):</span>
</span><span id="DataLoader.process_dq-161"><a href="#DataLoader.process_dq-161"><span class="linenos">161</span></a>                    <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">cache_df</span><span class="p">:</span>
</span><span id="DataLoader.process_dq-162"><a href="#DataLoader.process_dq-162"><span class="linenos">162</span></a>                        <span class="n">df_processed_df</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
</span><span id="DataLoader.process_dq-163"><a href="#DataLoader.process_dq-163"><span class="linenos">163</span></a>                    <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">DQFactory</span><span class="o">.</span><span class="n">run_dq_process</span><span class="p">(</span>
</span><span id="DataLoader.process_dq-164"><a href="#DataLoader.process_dq-164"><span class="linenos">164</span></a>                        <span class="n">spec</span><span class="p">,</span> <span class="n">df_processed_df</span>
</span><span id="DataLoader.process_dq-165"><a href="#DataLoader.process_dq-165"><span class="linenos">165</span></a>                    <span class="p">)</span>
</span><span id="DataLoader.process_dq-166"><a href="#DataLoader.process_dq-166"><span class="linenos">166</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader.process_dq-167"><a href="#DataLoader.process_dq-167"><span class="linenos">167</span></a>                    <span class="n">dq_processed_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_processed_df</span>
</span><span id="DataLoader.process_dq-168"><a href="#DataLoader.process_dq-168"><span class="linenos">168</span></a>            <span class="k">return</span> <span class="n">dq_processed_dfs</span>
</span></pre></div>


            <div class="docstring"><p>Process the data quality tasks for the data that was read and/or transformed.</p>

<p>It supports multiple input dataframes. Although just one is advisable.</p>

<p>It is possible to use data quality validators/expectations that will validate
your data and fail the process in case the expectations are not met. The DQ
process also generates and keeps updating a site containing the results of the
expectations that were done on your data. The location of the site is
configurable and can either be on file system or S3. If you define it to be
stored on S3, you can even configure your S3 bucket to serve the site so that
people can easily check the quality of your data. Moreover, it is also
possible to store the result of the DQ process into a defined result sink.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data:</strong>  dataframes from previous steps of the algorithm that we which to
run the DQ process on.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Another ordered dict with the validated dataframes.</p>
</blockquote>
</div>


                    </div>
                    <div id="DataLoader.write" class="classattr">
                                <input id="DataLoader.write-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span></span><span class="return-annotation">) -> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span>:</span></span>

                <label class="view-source-button" for="DataLoader.write-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.write"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.write-170"><a href="#DataLoader.write-170"><span class="linenos">170</span></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
</span><span id="DataLoader.write-171"><a href="#DataLoader.write-171"><span class="linenos">171</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write the data that was read and transformed (if applicable).</span>
</span><span id="DataLoader.write-172"><a href="#DataLoader.write-172"><span class="linenos">172</span></a>
</span><span id="DataLoader.write-173"><a href="#DataLoader.write-173"><span class="linenos">173</span></a><span class="sd">        It supports writing multiple datasets. However, we only recommend to write one</span>
</span><span id="DataLoader.write-174"><a href="#DataLoader.write-174"><span class="linenos">174</span></a><span class="sd">        dataframe. This recommendation is based on easy debugging and reproducibility,</span>
</span><span id="DataLoader.write-175"><a href="#DataLoader.write-175"><span class="linenos">175</span></a><span class="sd">        since if we start mixing several datasets being fueled by the same algorithm, it</span>
</span><span id="DataLoader.write-176"><a href="#DataLoader.write-176"><span class="linenos">176</span></a><span class="sd">        would unleash an infinite sea of reproducibility issues plus tight coupling and</span>
</span><span id="DataLoader.write-177"><a href="#DataLoader.write-177"><span class="linenos">177</span></a><span class="sd">        dependencies between datasets. Having said that, there may be cases where</span>
</span><span id="DataLoader.write-178"><a href="#DataLoader.write-178"><span class="linenos">178</span></a><span class="sd">        writing multiple datasets is desirable according to the use case requirements.</span>
</span><span id="DataLoader.write-179"><a href="#DataLoader.write-179"><span class="linenos">179</span></a><span class="sd">        Use it accordingly.</span>
</span><span id="DataLoader.write-180"><a href="#DataLoader.write-180"><span class="linenos">180</span></a>
</span><span id="DataLoader.write-181"><a href="#DataLoader.write-181"><span class="linenos">181</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader.write-182"><a href="#DataLoader.write-182"><span class="linenos">182</span></a><span class="sd">            data: dataframes that were read and transformed (if applicable).</span>
</span><span id="DataLoader.write-183"><a href="#DataLoader.write-183"><span class="linenos">183</span></a>
</span><span id="DataLoader.write-184"><a href="#DataLoader.write-184"><span class="linenos">184</span></a><span class="sd">        Returns:</span>
</span><span id="DataLoader.write-185"><a href="#DataLoader.write-185"><span class="linenos">185</span></a><span class="sd">            Dataframes that were written.</span>
</span><span id="DataLoader.write-186"><a href="#DataLoader.write-186"><span class="linenos">186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader.write-187"><a href="#DataLoader.write-187"><span class="linenos">187</span></a>        <span class="n">written_dfs</span><span class="p">:</span> <span class="n">OrderedDict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({})</span>
</span><span id="DataLoader.write-188"><a href="#DataLoader.write-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_specs</span><span class="p">:</span>
</span><span id="DataLoader.write-189"><a href="#DataLoader.write-189"><span class="linenos">189</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found output specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader.write-190"><a href="#DataLoader.write-190"><span class="linenos">190</span></a>
</span><span id="DataLoader.write-191"><a href="#DataLoader.write-191"><span class="linenos">191</span></a>            <span class="n">written_output</span> <span class="o">=</span> <span class="n">WriterFactory</span><span class="o">.</span><span class="n">get_writer</span><span class="p">(</span>
</span><span id="DataLoader.write-192"><a href="#DataLoader.write-192"><span class="linenos">192</span></a>                <span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">],</span> <span class="n">data</span>
</span><span id="DataLoader.write-193"><a href="#DataLoader.write-193"><span class="linenos">193</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</span><span id="DataLoader.write-194"><a href="#DataLoader.write-194"><span class="linenos">194</span></a>            <span class="k">if</span> <span class="n">written_output</span><span class="p">:</span>
</span><span id="DataLoader.write-195"><a href="#DataLoader.write-195"><span class="linenos">195</span></a>                <span class="n">written_dfs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">written_output</span><span class="p">)</span>
</span><span id="DataLoader.write-196"><a href="#DataLoader.write-196"><span class="linenos">196</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DataLoader.write-197"><a href="#DataLoader.write-197"><span class="linenos">197</span></a>                <span class="n">written_dfs</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">spec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span>
</span><span id="DataLoader.write-198"><a href="#DataLoader.write-198"><span class="linenos">198</span></a>
</span><span id="DataLoader.write-199"><a href="#DataLoader.write-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="n">written_dfs</span>
</span></pre></div>


            <div class="docstring"><p>Write the data that was read and transformed (if applicable).</p>

<p>It supports writing multiple datasets. However, we only recommend to write one
dataframe. This recommendation is based on easy debugging and reproducibility,
since if we start mixing several datasets being fueled by the same algorithm, it
would unleash an infinite sea of reproducibility issues plus tight coupling and
dependencies between datasets. Having said that, there may be cases where
writing multiple datasets is desirable according to the use case requirements.
Use it accordingly.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data:</strong>  dataframes that were read and transformed (if applicable).</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Dataframes that were written.</p>
</blockquote>
</div>


                    </div>
                    <div id="DataLoader.terminate" class="classattr">
                                <input id="DataLoader.terminate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">terminate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="DataLoader.terminate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.terminate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.terminate-201"><a href="#DataLoader.terminate-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">terminate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DataLoader.terminate-202"><a href="#DataLoader.terminate-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Terminate the algorithm.</span>
</span><span id="DataLoader.terminate-203"><a href="#DataLoader.terminate-203"><span class="linenos">203</span></a>
</span><span id="DataLoader.terminate-204"><a href="#DataLoader.terminate-204"><span class="linenos">204</span></a><span class="sd">        Args:</span>
</span><span id="DataLoader.terminate-205"><a href="#DataLoader.terminate-205"><span class="linenos">205</span></a><span class="sd">            data: dataframes that were written.</span>
</span><span id="DataLoader.terminate-206"><a href="#DataLoader.terminate-206"><span class="linenos">206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DataLoader.terminate-207"><a href="#DataLoader.terminate-207"><span class="linenos">207</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span>
</span><span id="DataLoader.terminate-208"><a href="#DataLoader.terminate-208"><span class="linenos">208</span></a>            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">:</span>
</span><span id="DataLoader.terminate-209"><a href="#DataLoader.terminate-209"><span class="linenos">209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found terminate specification: </span><span class="si">{</span><span class="n">spec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="DataLoader.terminate-210"><a href="#DataLoader.terminate-210"><span class="linenos">210</span></a>                <span class="n">TerminatorFactory</span><span class="o">.</span><span class="n">execute_terminator</span><span class="p">(</span>
</span><span id="DataLoader.terminate-211"><a href="#DataLoader.terminate-211"><span class="linenos">211</span></a>                    <span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">spec</span><span class="o">.</span><span class="n">input_id</span><span class="p">]</span> <span class="k">if</span> <span class="n">spec</span><span class="o">.</span><span class="n">input_id</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="DataLoader.terminate-212"><a href="#DataLoader.terminate-212"><span class="linenos">212</span></a>                <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Terminate the algorithm.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>data:</strong>  dataframes that were written.</li>
</ul>
</div>


                    </div>
                    <div id="DataLoader.execute" class="classattr">
                                <input id="DataLoader.execute-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">execute</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DataLoader.execute-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DataLoader.execute"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DataLoader.execute-214"><a href="#DataLoader.execute-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OrderedDict</span><span class="p">]:</span>
</span><span id="DataLoader.execute-215"><a href="#DataLoader.execute-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the algorithm execution behaviour.&quot;&quot;&quot;</span>
</span><span id="DataLoader.execute-216"><a href="#DataLoader.execute-216"><span class="linenos">216</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DataLoader.execute-217"><a href="#DataLoader.execute-217"><span class="linenos">217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting read stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader.execute-218"><a href="#DataLoader.execute-218"><span class="linenos">218</span></a>            <span class="n">read_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="DataLoader.execute-219"><a href="#DataLoader.execute-219"><span class="linenos">219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting transform stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader.execute-220"><a href="#DataLoader.execute-220"><span class="linenos">220</span></a>            <span class="n">transformed_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">read_dfs</span><span class="p">)</span>
</span><span id="DataLoader.execute-221"><a href="#DataLoader.execute-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting data quality stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader.execute-222"><a href="#DataLoader.execute-222"><span class="linenos">222</span></a>            <span class="n">validated_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_dq</span><span class="p">(</span><span class="n">transformed_dfs</span><span class="p">)</span>
</span><span id="DataLoader.execute-223"><a href="#DataLoader.execute-223"><span class="linenos">223</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting write stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader.execute-224"><a href="#DataLoader.execute-224"><span class="linenos">224</span></a>            <span class="n">written_dfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">validated_dfs</span><span class="p">)</span>
</span><span id="DataLoader.execute-225"><a href="#DataLoader.execute-225"><span class="linenos">225</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting terminate stage...&quot;</span><span class="p">)</span>
</span><span id="DataLoader.execute-226"><a href="#DataLoader.execute-226"><span class="linenos">226</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">terminate</span><span class="p">(</span><span class="n">written_dfs</span><span class="p">)</span>
</span><span id="DataLoader.execute-227"><a href="#DataLoader.execute-227"><span class="linenos">227</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Execution of the algorithm has finished!&quot;</span><span class="p">)</span>
</span><span id="DataLoader.execute-228"><a href="#DataLoader.execute-228"><span class="linenos">228</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="DataLoader.execute-229"><a href="#DataLoader.execute-229"><span class="linenos">229</span></a>            <span class="n">NotifierFactory</span><span class="o">.</span><span class="n">generate_failure_notification</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">terminate_specs</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="DataLoader.execute-230"><a href="#DataLoader.execute-230"><span class="linenos">230</span></a>            <span class="k">raise</span> <span class="n">e</span>
</span><span id="DataLoader.execute-231"><a href="#DataLoader.execute-231"><span class="linenos">231</span></a>
</span><span id="DataLoader.execute-232"><a href="#DataLoader.execute-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">written_dfs</span>
</span></pre></div>


            <div class="docstring"><p>Define the algorithm execution behaviour.</p>
</div>


                    </div>
                    <div class="inherited">
                        <h5>Inherited Members</h5>
                        <dl>
                            <div><dt><a href="algorithm.html#Algorithm">lakehouse_engine.algorithms.algorithm.Algorithm</a></dt>
                                <dd id="DataLoader.get_dq_spec" class="function"><a href="algorithm.html#Algorithm.get_dq_spec">get_dq_spec</a></dd>

            </div>
                        </dl>
                    </div>
        </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>