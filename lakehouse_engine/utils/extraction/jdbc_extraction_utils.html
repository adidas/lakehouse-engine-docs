<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.1"/>
    <title>lakehouse_engine.utils.extraction.jdbc_extraction_utils</title>
            <link rel="icon" href="https://github.com/adidas/lakehouse-engine/blob/master/assets/img/lakehouse_engine_logo_no_bg_160.png?raw=true"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#000000;background-color:#f1efef;border-color:#f1f1f1;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:150%;overflow:auto;margin-bottom:1rem;}.pdoc table th, .pdoc table td{padding:12px 13px;border:1px solid var(--accent2);}.pdoc table th{font-weight:600;}</style>
    <style>/*! custom.css */</style><style>
    .pdoc .mermaid-pre {
        border: none;
        background: none;
    }
</style>
<script type="module" defer>
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    /* Re-invoke Mermaid when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => mermaid.run()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../extraction.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;lakehouse_engine.utils.extraction</a>

            <img src="https://github.com/adidas/lakehouse-engine/blob/master/assets/img/lakehouse_engine_logo_no_bg_160.png?raw=true" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#JDBCExtractionType">JDBCExtractionType</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#JDBCExtractionType.INIT">INIT</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtractionType.DELTA">DELTA</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#JDBCExtraction">JDBCExtraction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#JDBCExtraction.__init__">JDBCExtraction</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.user">user</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.password">password</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.url">url</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.dbtable">dbtable</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.calc_upper_bound_schema">calc_upper_bound_schema</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.changelog_table">changelog_table</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.partition_column">partition_column</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.latest_timestamp_data_location">latest_timestamp_data_location</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.latest_timestamp_data_format">latest_timestamp_data_format</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.extraction_type">extraction_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.driver">driver</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.num_partitions">num_partitions</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.lower_bound">lower_bound</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.upper_bound">upper_bound</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.default_upper_bound">default_upper_bound</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.fetch_size">fetch_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.compress">compress</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.custom_schema">custom_schema</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.min_timestamp">min_timestamp</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.max_timestamp">max_timestamp</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.generate_predicates">generate_predicates</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.predicates">predicates</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.predicates_add_null">predicates_add_null</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.extraction_timestamp">extraction_timestamp</a>
                        </li>
                        <li>
                                <a class="variable" href="#JDBCExtraction.max_timestamp_custom_schema">max_timestamp_custom_schema</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#JDBCExtractionUtils">JDBCExtractionUtils</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#JDBCExtractionUtils.__init__">JDBCExtractionUtils</a>
                        </li>
                        <li>
                                <a class="function" href="#JDBCExtractionUtils.get_additional_spark_options">get_additional_spark_options</a>
                        </li>
                        <li>
                                <a class="function" href="#JDBCExtractionUtils.get_predicates">get_predicates</a>
                        </li>
                        <li>
                                <a class="function" href="#JDBCExtractionUtils.get_spark_jdbc_options">get_spark_jdbc_options</a>
                        </li>
                        <li>
                                <a class="function" href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound">get_spark_jdbc_optimal_upper_bound</a>
                        </li>
                </ul>

            </li>
    </ul>


            <footer>Lakehouse Engine v1.22.0version</footer>

</div>
    </nav>
    <main class="pdoc">
    <section class="module-info">

                <h1 class="modulename">
<a href="./../../../lakehouse_engine.html">lakehouse_engine</a><wbr>.<a href="./../../utils.html">utils</a><wbr>.<a href="./../extraction.html">extraction</a><wbr>.jdbc_extraction_utils    </h1>

                <div class="docstring"><p>Utilities module for JDBC extraction processes.</p>
</div>

                    <input id="mod-jdbc_extraction_utils-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                    <label class="view-source-button" for="mod-jdbc_extraction_utils-view-source"><span>View Source</span></label>

                    <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Utilities module for JDBC extraction processes.&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">Logger</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.core.definitions</span> <span class="kn">import</span> <span class="n">InputFormat</span><span class="p">,</span> <span class="n">InputSpec</span><span class="p">,</span> <span class="n">ReadType</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">lakehouse_engine.utils.logging_handler</span> <span class="kn">import</span> <span class="n">LoggingHandler</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="k">class</span> <span class="nc">JDBCExtractionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standardize the types of extractions we can have from a JDBC source.&quot;&quot;&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>    <span class="n">INIT</span> <span class="o">=</span> <span class="s2">&quot;init&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="n">DELTA</span> <span class="o">=</span> <span class="s2">&quot;delta&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="nd">@dataclass</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">JDBCExtraction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configurations available for an Extraction from a JDBC source.</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">    These configurations cover:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">    - user: username to connect to JDBC source.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    - password: password to connect to JDBC source (always use secrets,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        don&#39;t use text passwords in your code).</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    - url: url to connect to JDBC source.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">    - dbtable: `database.table` to extract data from.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">    - calc_upper_bound_schema: custom schema used for the upper bound calculation.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    - changelog_table: table of type changelog from which to extract data,</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        when the extraction type is delta.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">    - partition_column: column used to split the extraction.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">    - latest_timestamp_data_location: data location (e.g., s3) containing the data</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        to get the latest timestamp already loaded into bronze.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">    - latest_timestamp_data_format: the format of the dataset in</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        latest_timestamp_data_location. Default: delta.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    - extraction_type: type of extraction (delta or init). Default: &quot;delta&quot;.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    - driver: JDBC driver name. Default: &quot;com.sap.db.jdbc.Driver&quot;.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    - num_partitions: number of Spark partitions to split the extraction.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    - lower_bound: lower bound to decide the partition stride.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    - upper_bound: upper bound to decide the partition stride. If</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">        calculate_upper_bound is True, then upperBound will be</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">        derived by our upper bound optimizer, using the partition column.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">    - default_upper_bound: the value to use as default upper bound in case</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        the result of the upper bound calculation is None. Default: &quot;1&quot;.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    - fetch_size: how many rows to fetch per round trip. Default: &quot;100000&quot;.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    - compress: enable network compression. Default: True.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    - custom_schema: specify custom_schema for particular columns of the</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">        returned dataframe in the init/delta extraction of the source table.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    - min_timestamp: min timestamp to consider to filter the changelog data.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        Default: None and automatically derived from the location provided.</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        In case this one is provided it has precedence and the calculation</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">        is not done.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">    - max_timestamp: max timestamp to consider to filter the changelog data.</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        Default: None and automatically derived from the table having information</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        about the extraction requests, their timestamps and their status.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        In case this one is provided it has precedence and the calculation</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        is not done.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    - generate_predicates: whether to generate predicates automatically or not.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">        Default: False.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">    - predicates: list containing all values to partition (if generate_predicates</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">        is used, the manual values provided are ignored). Default: None.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">    - predicates_add_null: whether to consider null on predicates list.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">        Default: True.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">    - extraction_timestamp: the timestamp of the extraction. Default: current time</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        following the format &quot;%Y%m%d%H%M%S&quot;.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    - max_timestamp_custom_schema: custom schema used on the max_timestamp derivation</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">        from the table holding the extraction requests information.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>    <span class="n">dbtable</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="n">calc_upper_bound_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="n">changelog_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>    <span class="n">partition_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="n">latest_timestamp_data_location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="n">latest_timestamp_data_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">InputFormat</span><span class="o">.</span><span class="n">DELTAFILES</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="n">extraction_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">DELTA</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="n">driver</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;com.sap.db.jdbc.Driver&quot;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="n">num_partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="n">lower_bound</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="n">upper_bound</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="n">default_upper_bound</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="n">fetch_size</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100000&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="n">compress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    <span class="n">custom_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="n">min_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>    <span class="n">max_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="n">generate_predicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>    <span class="n">predicates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="n">predicates_add_null</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="n">extraction_timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="n">max_timestamp_custom_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="k">class</span> <span class="nc">JDBCExtractionUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Utils for managing data extraction from particularly relevant JDBC sources.&quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jdbc_extraction</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct JDBCExtractionUtils.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        Args:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">            jdbc_extraction: JDBC Extraction configurations. Can be of type:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">                JDBCExtraction, SAPB4Extraction or SAPBWExtraction.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span> <span class="o">=</span> <span class="n">jdbc_extraction</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">get_additional_spark_options</span><span class="p">(</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">input_spec</span><span class="p">:</span> <span class="n">InputSpec</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_options</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to get additional Spark Options initially passed.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        If people provide additional Spark options, not covered by the util function</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">        arguments (get_spark_jdbc_options), we need to consider them.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        Thus, we update the options retrieved by the utils, by checking if there is</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        any Spark option initially provided that is not yet considered in the retrieved</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        options or function arguments and if the value for the key is not None.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        If these conditions are filled, we add the options and return the complete dict.</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        Args:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            input_spec: the input specification.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">            options: dict with Spark options.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">            ignore_options: list of options to be ignored by the process.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">                Spark read has two different approaches to parallelize</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">                reading process, one of them is using upper/lower bound,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">                another one is using predicates, those process can&#39;t be</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">                executed at the same time, you must choose one of them.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">                By choosing predicates you can&#39;t pass lower and upper bound,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">                also can&#39;t pass number of partitions and partition column</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">                otherwise spark will interpret the execution partitioned by</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">                upper and lower bound and will expect to fill all variables.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">                To avoid fill all predicates hardcoded at the acon, there is</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">                a feature that automatically generates all predicates for init</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">                or delta load based on input partition column, but at the end</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">                of the process, partition column can&#39;t be passed to the options,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">                because we are choosing predicates execution, that is why to</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">                generate predicates we need to pass some options to ignore.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        Returns:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">             a dict with all the options passed as argument, plus the options that</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">             were initially provided, but were not used in the util</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">             (get_spark_jdbc_options).</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="n">func_args</span> <span class="o">=</span> <span class="n">JDBCExtractionUtils</span><span class="o">.</span><span class="n">get_spark_jdbc_options</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="k">if</span> <span class="n">ignore_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="n">ignore_options</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="n">ignore_options</span> <span class="o">=</span> <span class="n">ignore_options</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">func_args</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_spec</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_options</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="p">}</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">get_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicates_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the predicates list, based on a predicates query.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        Args:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">            predicates_query: query to use as the basis to get the distinct values for</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">                a specified column, based on which predicates are generated.</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        Returns:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">            List containing the predicates to use to split the extraction from</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">            JDBC sources.</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">predicates_query</span><span class="p">,</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="p">},</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="p">}</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="n">predicates_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_predicates&quot;</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">predicates_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">predicates_df</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="p">]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates_add_null</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="n">predicates_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2"> IS NULL&quot;</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="sa">f</span><span class="s2">&quot;The following predicate list was generated: </span><span class="si">{</span><span class="n">predicates_list</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">predicates_list</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">get_spark_jdbc_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Spark options to extract data from a JDBC source.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        Returns:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">            The Spark jdbc args dictionary, including the query to submit</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">            and also options args dictionary.</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>        <span class="n">options_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>            <span class="s2">&quot;fetchSize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">fetch_size</span><span class="p">,</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="s2">&quot;compress&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="p">}</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="p">},</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="p">}</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">extraction_type</span> <span class="o">==</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">DELTA</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">predicates_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_delta_query</span><span class="p">()</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">predicates_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_init_query</span><span class="p">()</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">custom_schema</span><span class="p">:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;customSchema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">custom_schema</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">generate_predicates</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;predicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicates</span><span class="p">(</span><span class="n">predicates_query</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates</span><span class="p">:</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;predicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                <span class="n">options_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extraction_partition_opts</span><span class="p">(</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                    <span class="n">options_args</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                <span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">options_args</span><span class="p">,</span> <span class="n">jdbc_args</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">get_spark_jdbc_optimal_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an optimal upperBound to properly split a Spark JDBC extraction.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        Returns:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">             Either an int, date or timestamp to serve as upperBound Spark JDBC option.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">calc_upper_bound_schema</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;customSchema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">calc_upper_bound_schema</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">extraction_type</span> <span class="o">==</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">INIT</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">changelog_table</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(SELECT COALESCE(MAX(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">), &quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">default_upper_bound</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="sa">f</span><span class="s2">&quot;upper_bound FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>  <span class="c1"># nosec: B608</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>            <span class="p">},</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="p">}</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">upper_bound_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_optimal_upper_bound&quot;</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">upper_bound_df</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="n">upper_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>                <span class="sa">f</span><span class="s2">&quot;Upper Bound &#39;</span><span class="si">{</span><span class="n">upper_bound</span><span class="si">}</span><span class="s2">&#39; derived from &quot;</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span><span class="si">}</span><span class="s2">&#39; using the column &quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>            <span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="k">return</span> <span class="n">upper_bound</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>                <span class="sa">f</span><span class="s2">&quot;Not able to calculate upper bound from &quot;</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span><span class="si">}</span><span class="s2">&#39; using &quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>                <span class="sa">f</span><span class="s2">&quot;the column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="p">)</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">_get_extraction_partition_opts</span><span class="p">(</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="n">options_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an options dict with custom extraction partition options.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        Args:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">            options_args: spark jdbc reader options.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">num_partitions</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;numPartitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">num_partitions</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;upperBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">upper_bound</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;lowerBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">lower_bound</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;partitionColumn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="k">return</span> <span class="n">options_args</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="k">def</span> <span class="nf">_get_max_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_timestamp_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the max timestamp, based on the provided query.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">        Args:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">            max_timestamp_query: the query used to derive the max timestamp.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        Returns:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">            A string having the max timestamp.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">max_timestamp_query</span><span class="p">,</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>            <span class="p">},</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="p">}</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="n">max_timestamp_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_max_timestamp&quot;</span><span class="p">,</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                    <span class="s2">&quot;customSchema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">max_timestamp_custom_schema</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="p">},</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="n">max_timestamp</span> <span class="o">=</span> <span class="n">max_timestamp_df</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="sa">f</span><span class="s2">&quot;Max timestamp </span><span class="si">{</span><span class="n">max_timestamp</span><span class="si">}</span><span class="s2"> derived from query: </span><span class="si">{</span><span class="n">max_timestamp_query</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_timestamp</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>    <span class="k">def</span> <span class="nf">_get_delta_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a query to extract delta (partially) from a source.&quot;&quot;&quot;</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="k">pass</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">_get_init_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a query to extract init (fully) from a source.&quot;&quot;&quot;</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="k">pass</span>
</span></pre></div>


    </section>
        <section id="JDBCExtractionType">
                    <input id="JDBCExtractionType-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">JDBCExtractionType</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="JDBCExtractionType-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionType"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionType-15"><a href="#JDBCExtractionType-15"><span class="linenos">15</span></a><span class="k">class</span> <span class="nc">JDBCExtractionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="JDBCExtractionType-16"><a href="#JDBCExtractionType-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standardize the types of extractions we can have from a JDBC source.&quot;&quot;&quot;</span>
</span><span id="JDBCExtractionType-17"><a href="#JDBCExtractionType-17"><span class="linenos">17</span></a>
</span><span id="JDBCExtractionType-18"><a href="#JDBCExtractionType-18"><span class="linenos">18</span></a>    <span class="n">INIT</span> <span class="o">=</span> <span class="s2">&quot;init&quot;</span>
</span><span id="JDBCExtractionType-19"><a href="#JDBCExtractionType-19"><span class="linenos">19</span></a>    <span class="n">DELTA</span> <span class="o">=</span> <span class="s2">&quot;delta&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Standardize the types of extractions we can have from a JDBC source.</p>
</div>


                    <div id="JDBCExtractionType.INIT" class="classattr">
                        <div class="attr variable">
            <span class="name">INIT</span>        =
<span class="default_value">&lt;<a href="#JDBCExtractionType.INIT">JDBCExtractionType.INIT</a>: &#39;init&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtractionType.INIT"></a>
    
    

                    </div>
                    <div id="JDBCExtractionType.DELTA" class="classattr">
                        <div class="attr variable">
            <span class="name">DELTA</span>        =
<span class="default_value">&lt;<a href="#JDBCExtractionType.DELTA">JDBCExtractionType.DELTA</a>: &#39;delta&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtractionType.DELTA"></a>
    
    

                    </div>
                    <div class="inherited">
                        <h5>Inherited Members</h5>
                        <dl>
                            <div><dt>enum.Enum</dt>
                                <dd id="JDBCExtractionType.name" class="variable">name</dd>
                <dd id="JDBCExtractionType.value" class="variable">value</dd>

            </div>
                        </dl>
                    </div>
        </section>
        <section id="JDBCExtraction">
                    <input id="JDBCExtraction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">JDBCExtraction</span>:

                <label class="view-source-button" for="JDBCExtraction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtraction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtraction-22"><a href="#JDBCExtraction-22"><span class="linenos">22</span></a><span class="nd">@dataclass</span>
</span><span id="JDBCExtraction-23"><a href="#JDBCExtraction-23"><span class="linenos">23</span></a><span class="k">class</span> <span class="nc">JDBCExtraction</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="JDBCExtraction-24"><a href="#JDBCExtraction-24"><span class="linenos">24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configurations available for an Extraction from a JDBC source.</span>
</span><span id="JDBCExtraction-25"><a href="#JDBCExtraction-25"><span class="linenos">25</span></a>
</span><span id="JDBCExtraction-26"><a href="#JDBCExtraction-26"><span class="linenos">26</span></a><span class="sd">    These configurations cover:</span>
</span><span id="JDBCExtraction-27"><a href="#JDBCExtraction-27"><span class="linenos">27</span></a><span class="sd">    - user: username to connect to JDBC source.</span>
</span><span id="JDBCExtraction-28"><a href="#JDBCExtraction-28"><span class="linenos">28</span></a><span class="sd">    - password: password to connect to JDBC source (always use secrets,</span>
</span><span id="JDBCExtraction-29"><a href="#JDBCExtraction-29"><span class="linenos">29</span></a><span class="sd">        don&#39;t use text passwords in your code).</span>
</span><span id="JDBCExtraction-30"><a href="#JDBCExtraction-30"><span class="linenos">30</span></a><span class="sd">    - url: url to connect to JDBC source.</span>
</span><span id="JDBCExtraction-31"><a href="#JDBCExtraction-31"><span class="linenos">31</span></a><span class="sd">    - dbtable: `database.table` to extract data from.</span>
</span><span id="JDBCExtraction-32"><a href="#JDBCExtraction-32"><span class="linenos">32</span></a><span class="sd">    - calc_upper_bound_schema: custom schema used for the upper bound calculation.</span>
</span><span id="JDBCExtraction-33"><a href="#JDBCExtraction-33"><span class="linenos">33</span></a><span class="sd">    - changelog_table: table of type changelog from which to extract data,</span>
</span><span id="JDBCExtraction-34"><a href="#JDBCExtraction-34"><span class="linenos">34</span></a><span class="sd">        when the extraction type is delta.</span>
</span><span id="JDBCExtraction-35"><a href="#JDBCExtraction-35"><span class="linenos">35</span></a><span class="sd">    - partition_column: column used to split the extraction.</span>
</span><span id="JDBCExtraction-36"><a href="#JDBCExtraction-36"><span class="linenos">36</span></a><span class="sd">    - latest_timestamp_data_location: data location (e.g., s3) containing the data</span>
</span><span id="JDBCExtraction-37"><a href="#JDBCExtraction-37"><span class="linenos">37</span></a><span class="sd">        to get the latest timestamp already loaded into bronze.</span>
</span><span id="JDBCExtraction-38"><a href="#JDBCExtraction-38"><span class="linenos">38</span></a><span class="sd">    - latest_timestamp_data_format: the format of the dataset in</span>
</span><span id="JDBCExtraction-39"><a href="#JDBCExtraction-39"><span class="linenos">39</span></a><span class="sd">        latest_timestamp_data_location. Default: delta.</span>
</span><span id="JDBCExtraction-40"><a href="#JDBCExtraction-40"><span class="linenos">40</span></a><span class="sd">    - extraction_type: type of extraction (delta or init). Default: &quot;delta&quot;.</span>
</span><span id="JDBCExtraction-41"><a href="#JDBCExtraction-41"><span class="linenos">41</span></a><span class="sd">    - driver: JDBC driver name. Default: &quot;com.sap.db.jdbc.Driver&quot;.</span>
</span><span id="JDBCExtraction-42"><a href="#JDBCExtraction-42"><span class="linenos">42</span></a><span class="sd">    - num_partitions: number of Spark partitions to split the extraction.</span>
</span><span id="JDBCExtraction-43"><a href="#JDBCExtraction-43"><span class="linenos">43</span></a><span class="sd">    - lower_bound: lower bound to decide the partition stride.</span>
</span><span id="JDBCExtraction-44"><a href="#JDBCExtraction-44"><span class="linenos">44</span></a><span class="sd">    - upper_bound: upper bound to decide the partition stride. If</span>
</span><span id="JDBCExtraction-45"><a href="#JDBCExtraction-45"><span class="linenos">45</span></a><span class="sd">        calculate_upper_bound is True, then upperBound will be</span>
</span><span id="JDBCExtraction-46"><a href="#JDBCExtraction-46"><span class="linenos">46</span></a><span class="sd">        derived by our upper bound optimizer, using the partition column.</span>
</span><span id="JDBCExtraction-47"><a href="#JDBCExtraction-47"><span class="linenos">47</span></a><span class="sd">    - default_upper_bound: the value to use as default upper bound in case</span>
</span><span id="JDBCExtraction-48"><a href="#JDBCExtraction-48"><span class="linenos">48</span></a><span class="sd">        the result of the upper bound calculation is None. Default: &quot;1&quot;.</span>
</span><span id="JDBCExtraction-49"><a href="#JDBCExtraction-49"><span class="linenos">49</span></a><span class="sd">    - fetch_size: how many rows to fetch per round trip. Default: &quot;100000&quot;.</span>
</span><span id="JDBCExtraction-50"><a href="#JDBCExtraction-50"><span class="linenos">50</span></a><span class="sd">    - compress: enable network compression. Default: True.</span>
</span><span id="JDBCExtraction-51"><a href="#JDBCExtraction-51"><span class="linenos">51</span></a><span class="sd">    - custom_schema: specify custom_schema for particular columns of the</span>
</span><span id="JDBCExtraction-52"><a href="#JDBCExtraction-52"><span class="linenos">52</span></a><span class="sd">        returned dataframe in the init/delta extraction of the source table.</span>
</span><span id="JDBCExtraction-53"><a href="#JDBCExtraction-53"><span class="linenos">53</span></a><span class="sd">    - min_timestamp: min timestamp to consider to filter the changelog data.</span>
</span><span id="JDBCExtraction-54"><a href="#JDBCExtraction-54"><span class="linenos">54</span></a><span class="sd">        Default: None and automatically derived from the location provided.</span>
</span><span id="JDBCExtraction-55"><a href="#JDBCExtraction-55"><span class="linenos">55</span></a><span class="sd">        In case this one is provided it has precedence and the calculation</span>
</span><span id="JDBCExtraction-56"><a href="#JDBCExtraction-56"><span class="linenos">56</span></a><span class="sd">        is not done.</span>
</span><span id="JDBCExtraction-57"><a href="#JDBCExtraction-57"><span class="linenos">57</span></a><span class="sd">    - max_timestamp: max timestamp to consider to filter the changelog data.</span>
</span><span id="JDBCExtraction-58"><a href="#JDBCExtraction-58"><span class="linenos">58</span></a><span class="sd">        Default: None and automatically derived from the table having information</span>
</span><span id="JDBCExtraction-59"><a href="#JDBCExtraction-59"><span class="linenos">59</span></a><span class="sd">        about the extraction requests, their timestamps and their status.</span>
</span><span id="JDBCExtraction-60"><a href="#JDBCExtraction-60"><span class="linenos">60</span></a><span class="sd">        In case this one is provided it has precedence and the calculation</span>
</span><span id="JDBCExtraction-61"><a href="#JDBCExtraction-61"><span class="linenos">61</span></a><span class="sd">        is not done.</span>
</span><span id="JDBCExtraction-62"><a href="#JDBCExtraction-62"><span class="linenos">62</span></a><span class="sd">    - generate_predicates: whether to generate predicates automatically or not.</span>
</span><span id="JDBCExtraction-63"><a href="#JDBCExtraction-63"><span class="linenos">63</span></a><span class="sd">        Default: False.</span>
</span><span id="JDBCExtraction-64"><a href="#JDBCExtraction-64"><span class="linenos">64</span></a><span class="sd">    - predicates: list containing all values to partition (if generate_predicates</span>
</span><span id="JDBCExtraction-65"><a href="#JDBCExtraction-65"><span class="linenos">65</span></a><span class="sd">        is used, the manual values provided are ignored). Default: None.</span>
</span><span id="JDBCExtraction-66"><a href="#JDBCExtraction-66"><span class="linenos">66</span></a><span class="sd">    - predicates_add_null: whether to consider null on predicates list.</span>
</span><span id="JDBCExtraction-67"><a href="#JDBCExtraction-67"><span class="linenos">67</span></a><span class="sd">        Default: True.</span>
</span><span id="JDBCExtraction-68"><a href="#JDBCExtraction-68"><span class="linenos">68</span></a><span class="sd">    - extraction_timestamp: the timestamp of the extraction. Default: current time</span>
</span><span id="JDBCExtraction-69"><a href="#JDBCExtraction-69"><span class="linenos">69</span></a><span class="sd">        following the format &quot;%Y%m%d%H%M%S&quot;.</span>
</span><span id="JDBCExtraction-70"><a href="#JDBCExtraction-70"><span class="linenos">70</span></a><span class="sd">    - max_timestamp_custom_schema: custom schema used on the max_timestamp derivation</span>
</span><span id="JDBCExtraction-71"><a href="#JDBCExtraction-71"><span class="linenos">71</span></a><span class="sd">        from the table holding the extraction requests information.</span>
</span><span id="JDBCExtraction-72"><a href="#JDBCExtraction-72"><span class="linenos">72</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="JDBCExtraction-73"><a href="#JDBCExtraction-73"><span class="linenos">73</span></a>
</span><span id="JDBCExtraction-74"><a href="#JDBCExtraction-74"><span class="linenos">74</span></a>    <span class="n">user</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="JDBCExtraction-75"><a href="#JDBCExtraction-75"><span class="linenos">75</span></a>    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="JDBCExtraction-76"><a href="#JDBCExtraction-76"><span class="linenos">76</span></a>    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="JDBCExtraction-77"><a href="#JDBCExtraction-77"><span class="linenos">77</span></a>    <span class="n">dbtable</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="JDBCExtraction-78"><a href="#JDBCExtraction-78"><span class="linenos">78</span></a>    <span class="n">calc_upper_bound_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-79"><a href="#JDBCExtraction-79"><span class="linenos">79</span></a>    <span class="n">changelog_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-80"><a href="#JDBCExtraction-80"><span class="linenos">80</span></a>    <span class="n">partition_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-81"><a href="#JDBCExtraction-81"><span class="linenos">81</span></a>    <span class="n">latest_timestamp_data_location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-82"><a href="#JDBCExtraction-82"><span class="linenos">82</span></a>    <span class="n">latest_timestamp_data_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">InputFormat</span><span class="o">.</span><span class="n">DELTAFILES</span><span class="o">.</span><span class="n">value</span>
</span><span id="JDBCExtraction-83"><a href="#JDBCExtraction-83"><span class="linenos">83</span></a>    <span class="n">extraction_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">DELTA</span><span class="o">.</span><span class="n">value</span>
</span><span id="JDBCExtraction-84"><a href="#JDBCExtraction-84"><span class="linenos">84</span></a>    <span class="n">driver</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;com.sap.db.jdbc.Driver&quot;</span>
</span><span id="JDBCExtraction-85"><a href="#JDBCExtraction-85"><span class="linenos">85</span></a>    <span class="n">num_partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-86"><a href="#JDBCExtraction-86"><span class="linenos">86</span></a>    <span class="n">lower_bound</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-87"><a href="#JDBCExtraction-87"><span class="linenos">87</span></a>    <span class="n">upper_bound</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-88"><a href="#JDBCExtraction-88"><span class="linenos">88</span></a>    <span class="n">default_upper_bound</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</span><span id="JDBCExtraction-89"><a href="#JDBCExtraction-89"><span class="linenos">89</span></a>    <span class="n">fetch_size</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;100000&quot;</span>
</span><span id="JDBCExtraction-90"><a href="#JDBCExtraction-90"><span class="linenos">90</span></a>    <span class="n">compress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="JDBCExtraction-91"><a href="#JDBCExtraction-91"><span class="linenos">91</span></a>    <span class="n">custom_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-92"><a href="#JDBCExtraction-92"><span class="linenos">92</span></a>    <span class="n">min_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-93"><a href="#JDBCExtraction-93"><span class="linenos">93</span></a>    <span class="n">max_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-94"><a href="#JDBCExtraction-94"><span class="linenos">94</span></a>    <span class="n">generate_predicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="JDBCExtraction-95"><a href="#JDBCExtraction-95"><span class="linenos">95</span></a>    <span class="n">predicates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtraction-96"><a href="#JDBCExtraction-96"><span class="linenos">96</span></a>    <span class="n">predicates_add_null</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="JDBCExtraction-97"><a href="#JDBCExtraction-97"><span class="linenos">97</span></a>    <span class="n">extraction_timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
</span><span id="JDBCExtraction-98"><a href="#JDBCExtraction-98"><span class="linenos">98</span></a>    <span class="n">max_timestamp_custom_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Configurations available for an Extraction from a JDBC source.</p>

<p>These configurations cover:</p>

<ul>
<li>user: username to connect to JDBC source.</li>
<li>password: password to connect to JDBC source (always use secrets,
don't use text passwords in your code).</li>
<li>url: url to connect to JDBC source.</li>
<li>dbtable: <code>database.table</code> to extract data from.</li>
<li>calc_upper_bound_schema: custom schema used for the upper bound calculation.</li>
<li>changelog_table: table of type changelog from which to extract data,
when the extraction type is delta.</li>
<li>partition_column: column used to split the extraction.</li>
<li>latest_timestamp_data_location: data location (e.g., s3) containing the data
to get the latest timestamp already loaded into bronze.</li>
<li>latest_timestamp_data_format: the format of the dataset in
latest_timestamp_data_location. Default: delta.</li>
<li>extraction_type: type of extraction (delta or init). Default: "delta".</li>
<li>driver: JDBC driver name. Default: "com.sap.db.jdbc.Driver".</li>
<li>num_partitions: number of Spark partitions to split the extraction.</li>
<li>lower_bound: lower bound to decide the partition stride.</li>
<li>upper_bound: upper bound to decide the partition stride. If
calculate_upper_bound is True, then upperBound will be
derived by our upper bound optimizer, using the partition column.</li>
<li>default_upper_bound: the value to use as default upper bound in case
the result of the upper bound calculation is None. Default: "1".</li>
<li>fetch_size: how many rows to fetch per round trip. Default: "100000".</li>
<li>compress: enable network compression. Default: True.</li>
<li>custom_schema: specify custom_schema for particular columns of the
returned dataframe in the init/delta extraction of the source table.</li>
<li>min_timestamp: min timestamp to consider to filter the changelog data.
Default: None and automatically derived from the location provided.
In case this one is provided it has precedence and the calculation
is not done.</li>
<li>max_timestamp: max timestamp to consider to filter the changelog data.
Default: None and automatically derived from the table having information
about the extraction requests, their timestamps and their status.
In case this one is provided it has precedence and the calculation
is not done.</li>
<li>generate_predicates: whether to generate predicates automatically or not.
Default: False.</li>
<li>predicates: list containing all values to partition (if generate_predicates
is used, the manual values provided are ignored). Default: None.</li>
<li>predicates_add_null: whether to consider null on predicates list.
Default: True.</li>
<li>extraction_timestamp: the timestamp of the extraction. Default: current time
following the format "%Y%m%d%H%M%S".</li>
<li>max_timestamp_custom_schema: custom schema used on the max_timestamp derivation
from the table holding the extraction requests information.</li>
</ul>
</div>


                    <div id="JDBCExtraction.__init__" class="classattr">
                        <div class="attr function">
            
        <span class="name">JDBCExtraction</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">user</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">password</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">url</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">dbtable</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">calc_upper_bound_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">changelog_table</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">partition_column</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">latest_timestamp_data_location</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">latest_timestamp_data_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;delta&#39;</span>,</span><span class="param">	<span class="n">extraction_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;delta&#39;</span>,</span><span class="param">	<span class="n">driver</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;com.sap.db.jdbc.Driver&#39;</span>,</span><span class="param">	<span class="n">num_partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">lower_bound</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">upper_bound</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default_upper_bound</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>,</span><span class="param">	<span class="n">fetch_size</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;100000&#39;</span>,</span><span class="param">	<span class="n">compress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">custom_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">min_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">generate_predicates</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">predicates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">predicates_add_null</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">extraction_timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;20240808154921&#39;</span>,</span><span class="param">	<span class="n">max_timestamp_custom_schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.__init__"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.user" class="classattr">
                        <div class="attr variable">
            <span class="name">user</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.user"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.password" class="classattr">
                        <div class="attr variable">
            <span class="name">password</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.password"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.url" class="classattr">
                        <div class="attr variable">
            <span class="name">url</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.url"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.dbtable" class="classattr">
                        <div class="attr variable">
            <span class="name">dbtable</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.dbtable"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.calc_upper_bound_schema" class="classattr">
                        <div class="attr variable">
            <span class="name">calc_upper_bound_schema</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.calc_upper_bound_schema"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.changelog_table" class="classattr">
                        <div class="attr variable">
            <span class="name">changelog_table</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.changelog_table"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.partition_column" class="classattr">
                        <div class="attr variable">
            <span class="name">partition_column</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.partition_column"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.latest_timestamp_data_location" class="classattr">
                        <div class="attr variable">
            <span class="name">latest_timestamp_data_location</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.latest_timestamp_data_location"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.latest_timestamp_data_format" class="classattr">
                        <div class="attr variable">
            <span class="name">latest_timestamp_data_format</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;delta&#39;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.latest_timestamp_data_format"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.extraction_type" class="classattr">
                        <div class="attr variable">
            <span class="name">extraction_type</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;delta&#39;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.extraction_type"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.driver" class="classattr">
                        <div class="attr variable">
            <span class="name">driver</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;com.sap.db.jdbc.Driver&#39;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.driver"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.num_partitions" class="classattr">
                        <div class="attr variable">
            <span class="name">num_partitions</span><span class="annotation">: Optional[int]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.num_partitions"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.lower_bound" class="classattr">
                        <div class="attr variable">
            <span class="name">lower_bound</span><span class="annotation">: Union[int, float, str, NoneType]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.lower_bound"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.upper_bound" class="classattr">
                        <div class="attr variable">
            <span class="name">upper_bound</span><span class="annotation">: Union[int, float, str, NoneType]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.upper_bound"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.default_upper_bound" class="classattr">
                        <div class="attr variable">
            <span class="name">default_upper_bound</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;1&#39;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.default_upper_bound"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.fetch_size" class="classattr">
                        <div class="attr variable">
            <span class="name">fetch_size</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;100000&#39;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.fetch_size"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.compress" class="classattr">
                        <div class="attr variable">
            <span class="name">compress</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.compress"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.custom_schema" class="classattr">
                        <div class="attr variable">
            <span class="name">custom_schema</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.custom_schema"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.min_timestamp" class="classattr">
                        <div class="attr variable">
            <span class="name">min_timestamp</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.min_timestamp"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.max_timestamp" class="classattr">
                        <div class="attr variable">
            <span class="name">max_timestamp</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.max_timestamp"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.generate_predicates" class="classattr">
                        <div class="attr variable">
            <span class="name">generate_predicates</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.generate_predicates"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.predicates" class="classattr">
                        <div class="attr variable">
            <span class="name">predicates</span><span class="annotation">: Optional[List]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.predicates"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.predicates_add_null" class="classattr">
                        <div class="attr variable">
            <span class="name">predicates_add_null</span><span class="annotation">: bool</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.predicates_add_null"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.extraction_timestamp" class="classattr">
                        <div class="attr variable">
            <span class="name">extraction_timestamp</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;20240808154921&#39;</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.extraction_timestamp"></a>
    
    

                    </div>
                    <div id="JDBCExtraction.max_timestamp_custom_schema" class="classattr">
                        <div class="attr variable">
            <span class="name">max_timestamp_custom_schema</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#JDBCExtraction.max_timestamp_custom_schema"></a>
    
    

                    </div>
        </section>
        <section id="JDBCExtractionUtils">
                    <input id="JDBCExtractionUtils-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">JDBCExtractionUtils</span>:

                <label class="view-source-button" for="JDBCExtractionUtils-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionUtils"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionUtils-101"><a href="#JDBCExtractionUtils-101"><span class="linenos">101</span></a><span class="k">class</span> <span class="nc">JDBCExtractionUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="JDBCExtractionUtils-102"><a href="#JDBCExtractionUtils-102"><span class="linenos">102</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Utils for managing data extraction from particularly relevant JDBC sources.&quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-103"><a href="#JDBCExtractionUtils-103"><span class="linenos">103</span></a>
</span><span id="JDBCExtractionUtils-104"><a href="#JDBCExtractionUtils-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jdbc_extraction</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="JDBCExtractionUtils-105"><a href="#JDBCExtractionUtils-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct JDBCExtractionUtils.</span>
</span><span id="JDBCExtractionUtils-106"><a href="#JDBCExtractionUtils-106"><span class="linenos">106</span></a>
</span><span id="JDBCExtractionUtils-107"><a href="#JDBCExtractionUtils-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils-108"><a href="#JDBCExtractionUtils-108"><span class="linenos">108</span></a><span class="sd">            jdbc_extraction: JDBC Extraction configurations. Can be of type:</span>
</span><span id="JDBCExtractionUtils-109"><a href="#JDBCExtractionUtils-109"><span class="linenos">109</span></a><span class="sd">                JDBCExtraction, SAPB4Extraction or SAPBWExtraction.</span>
</span><span id="JDBCExtractionUtils-110"><a href="#JDBCExtractionUtils-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-111"><a href="#JDBCExtractionUtils-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils-112"><a href="#JDBCExtractionUtils-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span> <span class="o">=</span> <span class="n">jdbc_extraction</span>
</span><span id="JDBCExtractionUtils-113"><a href="#JDBCExtractionUtils-113"><span class="linenos">113</span></a>
</span><span id="JDBCExtractionUtils-114"><a href="#JDBCExtractionUtils-114"><span class="linenos">114</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JDBCExtractionUtils-115"><a href="#JDBCExtractionUtils-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">get_additional_spark_options</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-116"><a href="#JDBCExtractionUtils-116"><span class="linenos">116</span></a>        <span class="n">input_spec</span><span class="p">:</span> <span class="n">InputSpec</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_options</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtractionUtils-117"><a href="#JDBCExtractionUtils-117"><span class="linenos">117</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-118"><a href="#JDBCExtractionUtils-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to get additional Spark Options initially passed.</span>
</span><span id="JDBCExtractionUtils-119"><a href="#JDBCExtractionUtils-119"><span class="linenos">119</span></a>
</span><span id="JDBCExtractionUtils-120"><a href="#JDBCExtractionUtils-120"><span class="linenos">120</span></a><span class="sd">        If people provide additional Spark options, not covered by the util function</span>
</span><span id="JDBCExtractionUtils-121"><a href="#JDBCExtractionUtils-121"><span class="linenos">121</span></a><span class="sd">        arguments (get_spark_jdbc_options), we need to consider them.</span>
</span><span id="JDBCExtractionUtils-122"><a href="#JDBCExtractionUtils-122"><span class="linenos">122</span></a><span class="sd">        Thus, we update the options retrieved by the utils, by checking if there is</span>
</span><span id="JDBCExtractionUtils-123"><a href="#JDBCExtractionUtils-123"><span class="linenos">123</span></a><span class="sd">        any Spark option initially provided that is not yet considered in the retrieved</span>
</span><span id="JDBCExtractionUtils-124"><a href="#JDBCExtractionUtils-124"><span class="linenos">124</span></a><span class="sd">        options or function arguments and if the value for the key is not None.</span>
</span><span id="JDBCExtractionUtils-125"><a href="#JDBCExtractionUtils-125"><span class="linenos">125</span></a><span class="sd">        If these conditions are filled, we add the options and return the complete dict.</span>
</span><span id="JDBCExtractionUtils-126"><a href="#JDBCExtractionUtils-126"><span class="linenos">126</span></a>
</span><span id="JDBCExtractionUtils-127"><a href="#JDBCExtractionUtils-127"><span class="linenos">127</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils-128"><a href="#JDBCExtractionUtils-128"><span class="linenos">128</span></a><span class="sd">            input_spec: the input specification.</span>
</span><span id="JDBCExtractionUtils-129"><a href="#JDBCExtractionUtils-129"><span class="linenos">129</span></a><span class="sd">            options: dict with Spark options.</span>
</span><span id="JDBCExtractionUtils-130"><a href="#JDBCExtractionUtils-130"><span class="linenos">130</span></a><span class="sd">            ignore_options: list of options to be ignored by the process.</span>
</span><span id="JDBCExtractionUtils-131"><a href="#JDBCExtractionUtils-131"><span class="linenos">131</span></a><span class="sd">                Spark read has two different approaches to parallelize</span>
</span><span id="JDBCExtractionUtils-132"><a href="#JDBCExtractionUtils-132"><span class="linenos">132</span></a><span class="sd">                reading process, one of them is using upper/lower bound,</span>
</span><span id="JDBCExtractionUtils-133"><a href="#JDBCExtractionUtils-133"><span class="linenos">133</span></a><span class="sd">                another one is using predicates, those process can&#39;t be</span>
</span><span id="JDBCExtractionUtils-134"><a href="#JDBCExtractionUtils-134"><span class="linenos">134</span></a><span class="sd">                executed at the same time, you must choose one of them.</span>
</span><span id="JDBCExtractionUtils-135"><a href="#JDBCExtractionUtils-135"><span class="linenos">135</span></a><span class="sd">                By choosing predicates you can&#39;t pass lower and upper bound,</span>
</span><span id="JDBCExtractionUtils-136"><a href="#JDBCExtractionUtils-136"><span class="linenos">136</span></a><span class="sd">                also can&#39;t pass number of partitions and partition column</span>
</span><span id="JDBCExtractionUtils-137"><a href="#JDBCExtractionUtils-137"><span class="linenos">137</span></a><span class="sd">                otherwise spark will interpret the execution partitioned by</span>
</span><span id="JDBCExtractionUtils-138"><a href="#JDBCExtractionUtils-138"><span class="linenos">138</span></a><span class="sd">                upper and lower bound and will expect to fill all variables.</span>
</span><span id="JDBCExtractionUtils-139"><a href="#JDBCExtractionUtils-139"><span class="linenos">139</span></a><span class="sd">                To avoid fill all predicates hardcoded at the acon, there is</span>
</span><span id="JDBCExtractionUtils-140"><a href="#JDBCExtractionUtils-140"><span class="linenos">140</span></a><span class="sd">                a feature that automatically generates all predicates for init</span>
</span><span id="JDBCExtractionUtils-141"><a href="#JDBCExtractionUtils-141"><span class="linenos">141</span></a><span class="sd">                or delta load based on input partition column, but at the end</span>
</span><span id="JDBCExtractionUtils-142"><a href="#JDBCExtractionUtils-142"><span class="linenos">142</span></a><span class="sd">                of the process, partition column can&#39;t be passed to the options,</span>
</span><span id="JDBCExtractionUtils-143"><a href="#JDBCExtractionUtils-143"><span class="linenos">143</span></a><span class="sd">                because we are choosing predicates execution, that is why to</span>
</span><span id="JDBCExtractionUtils-144"><a href="#JDBCExtractionUtils-144"><span class="linenos">144</span></a><span class="sd">                generate predicates we need to pass some options to ignore.</span>
</span><span id="JDBCExtractionUtils-145"><a href="#JDBCExtractionUtils-145"><span class="linenos">145</span></a>
</span><span id="JDBCExtractionUtils-146"><a href="#JDBCExtractionUtils-146"><span class="linenos">146</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils-147"><a href="#JDBCExtractionUtils-147"><span class="linenos">147</span></a><span class="sd">             a dict with all the options passed as argument, plus the options that</span>
</span><span id="JDBCExtractionUtils-148"><a href="#JDBCExtractionUtils-148"><span class="linenos">148</span></a><span class="sd">             were initially provided, but were not used in the util</span>
</span><span id="JDBCExtractionUtils-149"><a href="#JDBCExtractionUtils-149"><span class="linenos">149</span></a><span class="sd">             (get_spark_jdbc_options).</span>
</span><span id="JDBCExtractionUtils-150"><a href="#JDBCExtractionUtils-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-151"><a href="#JDBCExtractionUtils-151"><span class="linenos">151</span></a>        <span class="n">func_args</span> <span class="o">=</span> <span class="n">JDBCExtractionUtils</span><span class="o">.</span><span class="n">get_spark_jdbc_options</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
</span><span id="JDBCExtractionUtils-152"><a href="#JDBCExtractionUtils-152"><span class="linenos">152</span></a>
</span><span id="JDBCExtractionUtils-153"><a href="#JDBCExtractionUtils-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">ignore_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-154"><a href="#JDBCExtractionUtils-154"><span class="linenos">154</span></a>            <span class="n">ignore_options</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="JDBCExtractionUtils-155"><a href="#JDBCExtractionUtils-155"><span class="linenos">155</span></a>        <span class="n">ignore_options</span> <span class="o">=</span> <span class="n">ignore_options</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">func_args</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils-156"><a href="#JDBCExtractionUtils-156"><span class="linenos">156</span></a>
</span><span id="JDBCExtractionUtils-157"><a href="#JDBCExtractionUtils-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-158"><a href="#JDBCExtractionUtils-158"><span class="linenos">158</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
</span><span id="JDBCExtractionUtils-159"><a href="#JDBCExtractionUtils-159"><span class="linenos">159</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_spec</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils-160"><a href="#JDBCExtractionUtils-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_options</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="JDBCExtractionUtils-161"><a href="#JDBCExtractionUtils-161"><span class="linenos">161</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils-162"><a href="#JDBCExtractionUtils-162"><span class="linenos">162</span></a>
</span><span id="JDBCExtractionUtils-163"><a href="#JDBCExtractionUtils-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">get_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicates_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-164"><a href="#JDBCExtractionUtils-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the predicates list, based on a predicates query.</span>
</span><span id="JDBCExtractionUtils-165"><a href="#JDBCExtractionUtils-165"><span class="linenos">165</span></a>
</span><span id="JDBCExtractionUtils-166"><a href="#JDBCExtractionUtils-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils-167"><a href="#JDBCExtractionUtils-167"><span class="linenos">167</span></a><span class="sd">            predicates_query: query to use as the basis to get the distinct values for</span>
</span><span id="JDBCExtractionUtils-168"><a href="#JDBCExtractionUtils-168"><span class="linenos">168</span></a><span class="sd">                a specified column, based on which predicates are generated.</span>
</span><span id="JDBCExtractionUtils-169"><a href="#JDBCExtractionUtils-169"><span class="linenos">169</span></a>
</span><span id="JDBCExtractionUtils-170"><a href="#JDBCExtractionUtils-170"><span class="linenos">170</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils-171"><a href="#JDBCExtractionUtils-171"><span class="linenos">171</span></a><span class="sd">            List containing the predicates to use to split the extraction from</span>
</span><span id="JDBCExtractionUtils-172"><a href="#JDBCExtractionUtils-172"><span class="linenos">172</span></a><span class="sd">            JDBC sources.</span>
</span><span id="JDBCExtractionUtils-173"><a href="#JDBCExtractionUtils-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-174"><a href="#JDBCExtractionUtils-174"><span class="linenos">174</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-175"><a href="#JDBCExtractionUtils-175"><span class="linenos">175</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-176"><a href="#JDBCExtractionUtils-176"><span class="linenos">176</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">predicates_query</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-177"><a href="#JDBCExtractionUtils-177"><span class="linenos">177</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-178"><a href="#JDBCExtractionUtils-178"><span class="linenos">178</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-179"><a href="#JDBCExtractionUtils-179"><span class="linenos">179</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-180"><a href="#JDBCExtractionUtils-180"><span class="linenos">180</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-181"><a href="#JDBCExtractionUtils-181"><span class="linenos">181</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils-182"><a href="#JDBCExtractionUtils-182"><span class="linenos">182</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils-183"><a href="#JDBCExtractionUtils-183"><span class="linenos">183</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="JDBCExtractionUtils-184"><a href="#JDBCExtractionUtils-184"><span class="linenos">184</span></a>
</span><span id="JDBCExtractionUtils-185"><a href="#JDBCExtractionUtils-185"><span class="linenos">185</span></a>        <span class="n">predicates_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-186"><a href="#JDBCExtractionUtils-186"><span class="linenos">186</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-187"><a href="#JDBCExtractionUtils-187"><span class="linenos">187</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_predicates&quot;</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-188"><a href="#JDBCExtractionUtils-188"><span class="linenos">188</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-189"><a href="#JDBCExtractionUtils-189"><span class="linenos">189</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-190"><a href="#JDBCExtractionUtils-190"><span class="linenos">190</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-191"><a href="#JDBCExtractionUtils-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils-192"><a href="#JDBCExtractionUtils-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils-193"><a href="#JDBCExtractionUtils-193"><span class="linenos">193</span></a>
</span><span id="JDBCExtractionUtils-194"><a href="#JDBCExtractionUtils-194"><span class="linenos">194</span></a>        <span class="n">predicates_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="JDBCExtractionUtils-195"><a href="#JDBCExtractionUtils-195"><span class="linenos">195</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="JDBCExtractionUtils-196"><a href="#JDBCExtractionUtils-196"><span class="linenos">196</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">predicates_df</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils-197"><a href="#JDBCExtractionUtils-197"><span class="linenos">197</span></a>        <span class="p">]</span>
</span><span id="JDBCExtractionUtils-198"><a href="#JDBCExtractionUtils-198"><span class="linenos">198</span></a>
</span><span id="JDBCExtractionUtils-199"><a href="#JDBCExtractionUtils-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates_add_null</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-200"><a href="#JDBCExtractionUtils-200"><span class="linenos">200</span></a>            <span class="n">predicates_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2"> IS NULL&quot;</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils-201"><a href="#JDBCExtractionUtils-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-202"><a href="#JDBCExtractionUtils-202"><span class="linenos">202</span></a>            <span class="sa">f</span><span class="s2">&quot;The following predicate list was generated: </span><span class="si">{</span><span class="n">predicates_list</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="JDBCExtractionUtils-203"><a href="#JDBCExtractionUtils-203"><span class="linenos">203</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils-204"><a href="#JDBCExtractionUtils-204"><span class="linenos">204</span></a>
</span><span id="JDBCExtractionUtils-205"><a href="#JDBCExtractionUtils-205"><span class="linenos">205</span></a>        <span class="k">return</span> <span class="n">predicates_list</span>
</span><span id="JDBCExtractionUtils-206"><a href="#JDBCExtractionUtils-206"><span class="linenos">206</span></a>
</span><span id="JDBCExtractionUtils-207"><a href="#JDBCExtractionUtils-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">get_spark_jdbc_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="JDBCExtractionUtils-208"><a href="#JDBCExtractionUtils-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Spark options to extract data from a JDBC source.</span>
</span><span id="JDBCExtractionUtils-209"><a href="#JDBCExtractionUtils-209"><span class="linenos">209</span></a>
</span><span id="JDBCExtractionUtils-210"><a href="#JDBCExtractionUtils-210"><span class="linenos">210</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils-211"><a href="#JDBCExtractionUtils-211"><span class="linenos">211</span></a><span class="sd">            The Spark jdbc args dictionary, including the query to submit</span>
</span><span id="JDBCExtractionUtils-212"><a href="#JDBCExtractionUtils-212"><span class="linenos">212</span></a><span class="sd">            and also options args dictionary.</span>
</span><span id="JDBCExtractionUtils-213"><a href="#JDBCExtractionUtils-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-214"><a href="#JDBCExtractionUtils-214"><span class="linenos">214</span></a>        <span class="n">options_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-215"><a href="#JDBCExtractionUtils-215"><span class="linenos">215</span></a>            <span class="s2">&quot;fetchSize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">fetch_size</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-216"><a href="#JDBCExtractionUtils-216"><span class="linenos">216</span></a>            <span class="s2">&quot;compress&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-217"><a href="#JDBCExtractionUtils-217"><span class="linenos">217</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils-218"><a href="#JDBCExtractionUtils-218"><span class="linenos">218</span></a>
</span><span id="JDBCExtractionUtils-219"><a href="#JDBCExtractionUtils-219"><span class="linenos">219</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-220"><a href="#JDBCExtractionUtils-220"><span class="linenos">220</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-221"><a href="#JDBCExtractionUtils-221"><span class="linenos">221</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-222"><a href="#JDBCExtractionUtils-222"><span class="linenos">222</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-223"><a href="#JDBCExtractionUtils-223"><span class="linenos">223</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-224"><a href="#JDBCExtractionUtils-224"><span class="linenos">224</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-225"><a href="#JDBCExtractionUtils-225"><span class="linenos">225</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils-226"><a href="#JDBCExtractionUtils-226"><span class="linenos">226</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils-227"><a href="#JDBCExtractionUtils-227"><span class="linenos">227</span></a>
</span><span id="JDBCExtractionUtils-228"><a href="#JDBCExtractionUtils-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">extraction_type</span> <span class="o">==</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">DELTA</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-229"><a href="#JDBCExtractionUtils-229"><span class="linenos">229</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">predicates_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_delta_query</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils-230"><a href="#JDBCExtractionUtils-230"><span class="linenos">230</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-231"><a href="#JDBCExtractionUtils-231"><span class="linenos">231</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">predicates_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_init_query</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils-232"><a href="#JDBCExtractionUtils-232"><span class="linenos">232</span></a>
</span><span id="JDBCExtractionUtils-233"><a href="#JDBCExtractionUtils-233"><span class="linenos">233</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">custom_schema</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-234"><a href="#JDBCExtractionUtils-234"><span class="linenos">234</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;customSchema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">custom_schema</span>
</span><span id="JDBCExtractionUtils-235"><a href="#JDBCExtractionUtils-235"><span class="linenos">235</span></a>
</span><span id="JDBCExtractionUtils-236"><a href="#JDBCExtractionUtils-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">generate_predicates</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-237"><a href="#JDBCExtractionUtils-237"><span class="linenos">237</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;predicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicates</span><span class="p">(</span><span class="n">predicates_query</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils-238"><a href="#JDBCExtractionUtils-238"><span class="linenos">238</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-239"><a href="#JDBCExtractionUtils-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-240"><a href="#JDBCExtractionUtils-240"><span class="linenos">240</span></a>                <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;predicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates</span>
</span><span id="JDBCExtractionUtils-241"><a href="#JDBCExtractionUtils-241"><span class="linenos">241</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-242"><a href="#JDBCExtractionUtils-242"><span class="linenos">242</span></a>                <span class="n">options_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extraction_partition_opts</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-243"><a href="#JDBCExtractionUtils-243"><span class="linenos">243</span></a>                    <span class="n">options_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-244"><a href="#JDBCExtractionUtils-244"><span class="linenos">244</span></a>                <span class="p">)</span>
</span><span id="JDBCExtractionUtils-245"><a href="#JDBCExtractionUtils-245"><span class="linenos">245</span></a>
</span><span id="JDBCExtractionUtils-246"><a href="#JDBCExtractionUtils-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">options_args</span><span class="p">,</span> <span class="n">jdbc_args</span>
</span><span id="JDBCExtractionUtils-247"><a href="#JDBCExtractionUtils-247"><span class="linenos">247</span></a>
</span><span id="JDBCExtractionUtils-248"><a href="#JDBCExtractionUtils-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">get_spark_jdbc_optimal_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-249"><a href="#JDBCExtractionUtils-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an optimal upperBound to properly split a Spark JDBC extraction.</span>
</span><span id="JDBCExtractionUtils-250"><a href="#JDBCExtractionUtils-250"><span class="linenos">250</span></a>
</span><span id="JDBCExtractionUtils-251"><a href="#JDBCExtractionUtils-251"><span class="linenos">251</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils-252"><a href="#JDBCExtractionUtils-252"><span class="linenos">252</span></a><span class="sd">             Either an int, date or timestamp to serve as upperBound Spark JDBC option.</span>
</span><span id="JDBCExtractionUtils-253"><a href="#JDBCExtractionUtils-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-254"><a href="#JDBCExtractionUtils-254"><span class="linenos">254</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="JDBCExtractionUtils-255"><a href="#JDBCExtractionUtils-255"><span class="linenos">255</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">calc_upper_bound_schema</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-256"><a href="#JDBCExtractionUtils-256"><span class="linenos">256</span></a>            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;customSchema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">calc_upper_bound_schema</span>
</span><span id="JDBCExtractionUtils-257"><a href="#JDBCExtractionUtils-257"><span class="linenos">257</span></a>
</span><span id="JDBCExtractionUtils-258"><a href="#JDBCExtractionUtils-258"><span class="linenos">258</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="JDBCExtractionUtils-259"><a href="#JDBCExtractionUtils-259"><span class="linenos">259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span>
</span><span id="JDBCExtractionUtils-260"><a href="#JDBCExtractionUtils-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">extraction_type</span> <span class="o">==</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">INIT</span><span class="o">.</span><span class="n">value</span>
</span><span id="JDBCExtractionUtils-261"><a href="#JDBCExtractionUtils-261"><span class="linenos">261</span></a>            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">changelog_table</span>
</span><span id="JDBCExtractionUtils-262"><a href="#JDBCExtractionUtils-262"><span class="linenos">262</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils-263"><a href="#JDBCExtractionUtils-263"><span class="linenos">263</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-264"><a href="#JDBCExtractionUtils-264"><span class="linenos">264</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-265"><a href="#JDBCExtractionUtils-265"><span class="linenos">265</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(SELECT COALESCE(MAX(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">), &quot;</span>
</span><span id="JDBCExtractionUtils-266"><a href="#JDBCExtractionUtils-266"><span class="linenos">266</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">default_upper_bound</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="JDBCExtractionUtils-267"><a href="#JDBCExtractionUtils-267"><span class="linenos">267</span></a>            <span class="sa">f</span><span class="s2">&quot;upper_bound FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>  <span class="c1"># nosec: B608</span>
</span><span id="JDBCExtractionUtils-268"><a href="#JDBCExtractionUtils-268"><span class="linenos">268</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-269"><a href="#JDBCExtractionUtils-269"><span class="linenos">269</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-270"><a href="#JDBCExtractionUtils-270"><span class="linenos">270</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-271"><a href="#JDBCExtractionUtils-271"><span class="linenos">271</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-272"><a href="#JDBCExtractionUtils-272"><span class="linenos">272</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils-273"><a href="#JDBCExtractionUtils-273"><span class="linenos">273</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils-274"><a href="#JDBCExtractionUtils-274"><span class="linenos">274</span></a>
</span><span id="JDBCExtractionUtils-275"><a href="#JDBCExtractionUtils-275"><span class="linenos">275</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="JDBCExtractionUtils-276"><a href="#JDBCExtractionUtils-276"><span class="linenos">276</span></a>
</span><span id="JDBCExtractionUtils-277"><a href="#JDBCExtractionUtils-277"><span class="linenos">277</span></a>        <span class="n">upper_bound_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-278"><a href="#JDBCExtractionUtils-278"><span class="linenos">278</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-279"><a href="#JDBCExtractionUtils-279"><span class="linenos">279</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_optimal_upper_bound&quot;</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-280"><a href="#JDBCExtractionUtils-280"><span class="linenos">280</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-281"><a href="#JDBCExtractionUtils-281"><span class="linenos">281</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-282"><a href="#JDBCExtractionUtils-282"><span class="linenos">282</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-283"><a href="#JDBCExtractionUtils-283"><span class="linenos">283</span></a>                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-284"><a href="#JDBCExtractionUtils-284"><span class="linenos">284</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils-285"><a href="#JDBCExtractionUtils-285"><span class="linenos">285</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils-286"><a href="#JDBCExtractionUtils-286"><span class="linenos">286</span></a>        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">upper_bound_df</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="JDBCExtractionUtils-287"><a href="#JDBCExtractionUtils-287"><span class="linenos">287</span></a>
</span><span id="JDBCExtractionUtils-288"><a href="#JDBCExtractionUtils-288"><span class="linenos">288</span></a>        <span class="k">if</span> <span class="n">upper_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-289"><a href="#JDBCExtractionUtils-289"><span class="linenos">289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-290"><a href="#JDBCExtractionUtils-290"><span class="linenos">290</span></a>                <span class="sa">f</span><span class="s2">&quot;Upper Bound &#39;</span><span class="si">{</span><span class="n">upper_bound</span><span class="si">}</span><span class="s2">&#39; derived from &quot;</span>
</span><span id="JDBCExtractionUtils-291"><a href="#JDBCExtractionUtils-291"><span class="linenos">291</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span><span class="si">}</span><span class="s2">&#39; using the column &quot;</span>
</span><span id="JDBCExtractionUtils-292"><a href="#JDBCExtractionUtils-292"><span class="linenos">292</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="JDBCExtractionUtils-293"><a href="#JDBCExtractionUtils-293"><span class="linenos">293</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils-294"><a href="#JDBCExtractionUtils-294"><span class="linenos">294</span></a>            <span class="k">return</span> <span class="n">upper_bound</span>
</span><span id="JDBCExtractionUtils-295"><a href="#JDBCExtractionUtils-295"><span class="linenos">295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-296"><a href="#JDBCExtractionUtils-296"><span class="linenos">296</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-297"><a href="#JDBCExtractionUtils-297"><span class="linenos">297</span></a>                <span class="sa">f</span><span class="s2">&quot;Not able to calculate upper bound from &quot;</span>
</span><span id="JDBCExtractionUtils-298"><a href="#JDBCExtractionUtils-298"><span class="linenos">298</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span><span class="si">}</span><span class="s2">&#39; using &quot;</span>
</span><span id="JDBCExtractionUtils-299"><a href="#JDBCExtractionUtils-299"><span class="linenos">299</span></a>                <span class="sa">f</span><span class="s2">&quot;the column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="JDBCExtractionUtils-300"><a href="#JDBCExtractionUtils-300"><span class="linenos">300</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils-301"><a href="#JDBCExtractionUtils-301"><span class="linenos">301</span></a>
</span><span id="JDBCExtractionUtils-302"><a href="#JDBCExtractionUtils-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">_get_extraction_partition_opts</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-303"><a href="#JDBCExtractionUtils-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-304"><a href="#JDBCExtractionUtils-304"><span class="linenos">304</span></a>        <span class="n">options_args</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-305"><a href="#JDBCExtractionUtils-305"><span class="linenos">305</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-306"><a href="#JDBCExtractionUtils-306"><span class="linenos">306</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an options dict with custom extraction partition options.</span>
</span><span id="JDBCExtractionUtils-307"><a href="#JDBCExtractionUtils-307"><span class="linenos">307</span></a>
</span><span id="JDBCExtractionUtils-308"><a href="#JDBCExtractionUtils-308"><span class="linenos">308</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils-309"><a href="#JDBCExtractionUtils-309"><span class="linenos">309</span></a><span class="sd">            options_args: spark jdbc reader options.</span>
</span><span id="JDBCExtractionUtils-310"><a href="#JDBCExtractionUtils-310"><span class="linenos">310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-311"><a href="#JDBCExtractionUtils-311"><span class="linenos">311</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">num_partitions</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-312"><a href="#JDBCExtractionUtils-312"><span class="linenos">312</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;numPartitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">num_partitions</span>
</span><span id="JDBCExtractionUtils-313"><a href="#JDBCExtractionUtils-313"><span class="linenos">313</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-314"><a href="#JDBCExtractionUtils-314"><span class="linenos">314</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;upperBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">upper_bound</span>
</span><span id="JDBCExtractionUtils-315"><a href="#JDBCExtractionUtils-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-316"><a href="#JDBCExtractionUtils-316"><span class="linenos">316</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;lowerBound&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">lower_bound</span>
</span><span id="JDBCExtractionUtils-317"><a href="#JDBCExtractionUtils-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-318"><a href="#JDBCExtractionUtils-318"><span class="linenos">318</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;partitionColumn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span>
</span><span id="JDBCExtractionUtils-319"><a href="#JDBCExtractionUtils-319"><span class="linenos">319</span></a>
</span><span id="JDBCExtractionUtils-320"><a href="#JDBCExtractionUtils-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">options_args</span>
</span><span id="JDBCExtractionUtils-321"><a href="#JDBCExtractionUtils-321"><span class="linenos">321</span></a>
</span><span id="JDBCExtractionUtils-322"><a href="#JDBCExtractionUtils-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">_get_max_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_timestamp_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils-323"><a href="#JDBCExtractionUtils-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the max timestamp, based on the provided query.</span>
</span><span id="JDBCExtractionUtils-324"><a href="#JDBCExtractionUtils-324"><span class="linenos">324</span></a>
</span><span id="JDBCExtractionUtils-325"><a href="#JDBCExtractionUtils-325"><span class="linenos">325</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils-326"><a href="#JDBCExtractionUtils-326"><span class="linenos">326</span></a><span class="sd">            max_timestamp_query: the query used to derive the max timestamp.</span>
</span><span id="JDBCExtractionUtils-327"><a href="#JDBCExtractionUtils-327"><span class="linenos">327</span></a>
</span><span id="JDBCExtractionUtils-328"><a href="#JDBCExtractionUtils-328"><span class="linenos">328</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils-329"><a href="#JDBCExtractionUtils-329"><span class="linenos">329</span></a><span class="sd">            A string having the max timestamp.</span>
</span><span id="JDBCExtractionUtils-330"><a href="#JDBCExtractionUtils-330"><span class="linenos">330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-331"><a href="#JDBCExtractionUtils-331"><span class="linenos">331</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-332"><a href="#JDBCExtractionUtils-332"><span class="linenos">332</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-333"><a href="#JDBCExtractionUtils-333"><span class="linenos">333</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">max_timestamp_query</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-334"><a href="#JDBCExtractionUtils-334"><span class="linenos">334</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils-335"><a href="#JDBCExtractionUtils-335"><span class="linenos">335</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-336"><a href="#JDBCExtractionUtils-336"><span class="linenos">336</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-337"><a href="#JDBCExtractionUtils-337"><span class="linenos">337</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-338"><a href="#JDBCExtractionUtils-338"><span class="linenos">338</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils-339"><a href="#JDBCExtractionUtils-339"><span class="linenos">339</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils-340"><a href="#JDBCExtractionUtils-340"><span class="linenos">340</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="JDBCExtractionUtils-341"><a href="#JDBCExtractionUtils-341"><span class="linenos">341</span></a>
</span><span id="JDBCExtractionUtils-342"><a href="#JDBCExtractionUtils-342"><span class="linenos">342</span></a>        <span class="n">max_timestamp_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-343"><a href="#JDBCExtractionUtils-343"><span class="linenos">343</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-344"><a href="#JDBCExtractionUtils-344"><span class="linenos">344</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_max_timestamp&quot;</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-345"><a href="#JDBCExtractionUtils-345"><span class="linenos">345</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-346"><a href="#JDBCExtractionUtils-346"><span class="linenos">346</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-347"><a href="#JDBCExtractionUtils-347"><span class="linenos">347</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils-348"><a href="#JDBCExtractionUtils-348"><span class="linenos">348</span></a>                <span class="n">options</span><span class="o">=</span><span class="p">{</span>
</span><span id="JDBCExtractionUtils-349"><a href="#JDBCExtractionUtils-349"><span class="linenos">349</span></a>                    <span class="s2">&quot;customSchema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">max_timestamp_custom_schema</span>
</span><span id="JDBCExtractionUtils-350"><a href="#JDBCExtractionUtils-350"><span class="linenos">350</span></a>                <span class="p">},</span>
</span><span id="JDBCExtractionUtils-351"><a href="#JDBCExtractionUtils-351"><span class="linenos">351</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils-352"><a href="#JDBCExtractionUtils-352"><span class="linenos">352</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils-353"><a href="#JDBCExtractionUtils-353"><span class="linenos">353</span></a>        <span class="n">max_timestamp</span> <span class="o">=</span> <span class="n">max_timestamp_df</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="JDBCExtractionUtils-354"><a href="#JDBCExtractionUtils-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils-355"><a href="#JDBCExtractionUtils-355"><span class="linenos">355</span></a>            <span class="sa">f</span><span class="s2">&quot;Max timestamp </span><span class="si">{</span><span class="n">max_timestamp</span><span class="si">}</span><span class="s2"> derived from query: </span><span class="si">{</span><span class="n">max_timestamp_query</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="JDBCExtractionUtils-356"><a href="#JDBCExtractionUtils-356"><span class="linenos">356</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils-357"><a href="#JDBCExtractionUtils-357"><span class="linenos">357</span></a>
</span><span id="JDBCExtractionUtils-358"><a href="#JDBCExtractionUtils-358"><span class="linenos">358</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_timestamp</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils-359"><a href="#JDBCExtractionUtils-359"><span class="linenos">359</span></a>
</span><span id="JDBCExtractionUtils-360"><a href="#JDBCExtractionUtils-360"><span class="linenos">360</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="JDBCExtractionUtils-361"><a href="#JDBCExtractionUtils-361"><span class="linenos">361</span></a>    <span class="k">def</span> <span class="nf">_get_delta_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="JDBCExtractionUtils-362"><a href="#JDBCExtractionUtils-362"><span class="linenos">362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a query to extract delta (partially) from a source.&quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-363"><a href="#JDBCExtractionUtils-363"><span class="linenos">363</span></a>        <span class="k">pass</span>
</span><span id="JDBCExtractionUtils-364"><a href="#JDBCExtractionUtils-364"><span class="linenos">364</span></a>
</span><span id="JDBCExtractionUtils-365"><a href="#JDBCExtractionUtils-365"><span class="linenos">365</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="JDBCExtractionUtils-366"><a href="#JDBCExtractionUtils-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">_get_init_query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="JDBCExtractionUtils-367"><a href="#JDBCExtractionUtils-367"><span class="linenos">367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a query to extract init (fully) from a source.&quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils-368"><a href="#JDBCExtractionUtils-368"><span class="linenos">368</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Utils for managing data extraction from particularly relevant JDBC sources.</p>
</div>


                    <div id="JDBCExtractionUtils.__init__" class="classattr">
                                <input id="JDBCExtractionUtils.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">JDBCExtractionUtils</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">jdbc_extraction</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="JDBCExtractionUtils.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionUtils.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionUtils.__init__-104"><a href="#JDBCExtractionUtils.__init__-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jdbc_extraction</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="JDBCExtractionUtils.__init__-105"><a href="#JDBCExtractionUtils.__init__-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Construct JDBCExtractionUtils.</span>
</span><span id="JDBCExtractionUtils.__init__-106"><a href="#JDBCExtractionUtils.__init__-106"><span class="linenos">106</span></a>
</span><span id="JDBCExtractionUtils.__init__-107"><a href="#JDBCExtractionUtils.__init__-107"><span class="linenos">107</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils.__init__-108"><a href="#JDBCExtractionUtils.__init__-108"><span class="linenos">108</span></a><span class="sd">            jdbc_extraction: JDBC Extraction configurations. Can be of type:</span>
</span><span id="JDBCExtractionUtils.__init__-109"><a href="#JDBCExtractionUtils.__init__-109"><span class="linenos">109</span></a><span class="sd">                JDBCExtraction, SAPB4Extraction or SAPBWExtraction.</span>
</span><span id="JDBCExtractionUtils.__init__-110"><a href="#JDBCExtractionUtils.__init__-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils.__init__-111"><a href="#JDBCExtractionUtils.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="p">:</span> <span class="n">Logger</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils.__init__-112"><a href="#JDBCExtractionUtils.__init__-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span> <span class="o">=</span> <span class="n">jdbc_extraction</span>
</span></pre></div>


            <div class="docstring"><p>Construct JDBCExtractionUtils.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>jdbc_extraction:</strong>  JDBC Extraction configurations. Can be of type:
JDBCExtraction, SAPB4Extraction or SAPBWExtraction.</li>
</ul>
</div>


                    </div>
                    <div id="JDBCExtractionUtils.get_additional_spark_options" class="classattr">
                                <input id="JDBCExtractionUtils.get_additional_spark_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_additional_spark_options</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">input_spec</span><span class="p">:</span> <span class="n"><a href="../../core/definitions.html#InputSpec">lakehouse_engine.core.definitions.InputSpec</a></span>,</span><span class="param">	<span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">ignore_options</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="JDBCExtractionUtils.get_additional_spark_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionUtils.get_additional_spark_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionUtils.get_additional_spark_options-114"><a href="#JDBCExtractionUtils.get_additional_spark_options-114"><span class="linenos">114</span></a>    <span class="nd">@staticmethod</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-115"><a href="#JDBCExtractionUtils.get_additional_spark_options-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">get_additional_spark_options</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-116"><a href="#JDBCExtractionUtils.get_additional_spark_options-116"><span class="linenos">116</span></a>        <span class="n">input_spec</span><span class="p">:</span> <span class="n">InputSpec</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ignore_options</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-117"><a href="#JDBCExtractionUtils.get_additional_spark_options-117"><span class="linenos">117</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-118"><a href="#JDBCExtractionUtils.get_additional_spark_options-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to get additional Spark Options initially passed.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-119"><a href="#JDBCExtractionUtils.get_additional_spark_options-119"><span class="linenos">119</span></a>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-120"><a href="#JDBCExtractionUtils.get_additional_spark_options-120"><span class="linenos">120</span></a><span class="sd">        If people provide additional Spark options, not covered by the util function</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-121"><a href="#JDBCExtractionUtils.get_additional_spark_options-121"><span class="linenos">121</span></a><span class="sd">        arguments (get_spark_jdbc_options), we need to consider them.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-122"><a href="#JDBCExtractionUtils.get_additional_spark_options-122"><span class="linenos">122</span></a><span class="sd">        Thus, we update the options retrieved by the utils, by checking if there is</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-123"><a href="#JDBCExtractionUtils.get_additional_spark_options-123"><span class="linenos">123</span></a><span class="sd">        any Spark option initially provided that is not yet considered in the retrieved</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-124"><a href="#JDBCExtractionUtils.get_additional_spark_options-124"><span class="linenos">124</span></a><span class="sd">        options or function arguments and if the value for the key is not None.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-125"><a href="#JDBCExtractionUtils.get_additional_spark_options-125"><span class="linenos">125</span></a><span class="sd">        If these conditions are filled, we add the options and return the complete dict.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-126"><a href="#JDBCExtractionUtils.get_additional_spark_options-126"><span class="linenos">126</span></a>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-127"><a href="#JDBCExtractionUtils.get_additional_spark_options-127"><span class="linenos">127</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-128"><a href="#JDBCExtractionUtils.get_additional_spark_options-128"><span class="linenos">128</span></a><span class="sd">            input_spec: the input specification.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-129"><a href="#JDBCExtractionUtils.get_additional_spark_options-129"><span class="linenos">129</span></a><span class="sd">            options: dict with Spark options.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-130"><a href="#JDBCExtractionUtils.get_additional_spark_options-130"><span class="linenos">130</span></a><span class="sd">            ignore_options: list of options to be ignored by the process.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-131"><a href="#JDBCExtractionUtils.get_additional_spark_options-131"><span class="linenos">131</span></a><span class="sd">                Spark read has two different approaches to parallelize</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-132"><a href="#JDBCExtractionUtils.get_additional_spark_options-132"><span class="linenos">132</span></a><span class="sd">                reading process, one of them is using upper/lower bound,</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-133"><a href="#JDBCExtractionUtils.get_additional_spark_options-133"><span class="linenos">133</span></a><span class="sd">                another one is using predicates, those process can&#39;t be</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-134"><a href="#JDBCExtractionUtils.get_additional_spark_options-134"><span class="linenos">134</span></a><span class="sd">                executed at the same time, you must choose one of them.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-135"><a href="#JDBCExtractionUtils.get_additional_spark_options-135"><span class="linenos">135</span></a><span class="sd">                By choosing predicates you can&#39;t pass lower and upper bound,</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-136"><a href="#JDBCExtractionUtils.get_additional_spark_options-136"><span class="linenos">136</span></a><span class="sd">                also can&#39;t pass number of partitions and partition column</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-137"><a href="#JDBCExtractionUtils.get_additional_spark_options-137"><span class="linenos">137</span></a><span class="sd">                otherwise spark will interpret the execution partitioned by</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-138"><a href="#JDBCExtractionUtils.get_additional_spark_options-138"><span class="linenos">138</span></a><span class="sd">                upper and lower bound and will expect to fill all variables.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-139"><a href="#JDBCExtractionUtils.get_additional_spark_options-139"><span class="linenos">139</span></a><span class="sd">                To avoid fill all predicates hardcoded at the acon, there is</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-140"><a href="#JDBCExtractionUtils.get_additional_spark_options-140"><span class="linenos">140</span></a><span class="sd">                a feature that automatically generates all predicates for init</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-141"><a href="#JDBCExtractionUtils.get_additional_spark_options-141"><span class="linenos">141</span></a><span class="sd">                or delta load based on input partition column, but at the end</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-142"><a href="#JDBCExtractionUtils.get_additional_spark_options-142"><span class="linenos">142</span></a><span class="sd">                of the process, partition column can&#39;t be passed to the options,</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-143"><a href="#JDBCExtractionUtils.get_additional_spark_options-143"><span class="linenos">143</span></a><span class="sd">                because we are choosing predicates execution, that is why to</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-144"><a href="#JDBCExtractionUtils.get_additional_spark_options-144"><span class="linenos">144</span></a><span class="sd">                generate predicates we need to pass some options to ignore.</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-145"><a href="#JDBCExtractionUtils.get_additional_spark_options-145"><span class="linenos">145</span></a>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-146"><a href="#JDBCExtractionUtils.get_additional_spark_options-146"><span class="linenos">146</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-147"><a href="#JDBCExtractionUtils.get_additional_spark_options-147"><span class="linenos">147</span></a><span class="sd">             a dict with all the options passed as argument, plus the options that</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-148"><a href="#JDBCExtractionUtils.get_additional_spark_options-148"><span class="linenos">148</span></a><span class="sd">             were initially provided, but were not used in the util</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-149"><a href="#JDBCExtractionUtils.get_additional_spark_options-149"><span class="linenos">149</span></a><span class="sd">             (get_spark_jdbc_options).</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-150"><a href="#JDBCExtractionUtils.get_additional_spark_options-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-151"><a href="#JDBCExtractionUtils.get_additional_spark_options-151"><span class="linenos">151</span></a>        <span class="n">func_args</span> <span class="o">=</span> <span class="n">JDBCExtractionUtils</span><span class="o">.</span><span class="n">get_spark_jdbc_options</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-152"><a href="#JDBCExtractionUtils.get_additional_spark_options-152"><span class="linenos">152</span></a>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-153"><a href="#JDBCExtractionUtils.get_additional_spark_options-153"><span class="linenos">153</span></a>        <span class="k">if</span> <span class="n">ignore_options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-154"><a href="#JDBCExtractionUtils.get_additional_spark_options-154"><span class="linenos">154</span></a>            <span class="n">ignore_options</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-155"><a href="#JDBCExtractionUtils.get_additional_spark_options-155"><span class="linenos">155</span></a>        <span class="n">ignore_options</span> <span class="o">=</span> <span class="n">ignore_options</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">func_args</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-156"><a href="#JDBCExtractionUtils.get_additional_spark_options-156"><span class="linenos">156</span></a>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-157"><a href="#JDBCExtractionUtils.get_additional_spark_options-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-158"><a href="#JDBCExtractionUtils.get_additional_spark_options-158"><span class="linenos">158</span></a>            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-159"><a href="#JDBCExtractionUtils.get_additional_spark_options-159"><span class="linenos">159</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">input_spec</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-160"><a href="#JDBCExtractionUtils.get_additional_spark_options-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_options</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="JDBCExtractionUtils.get_additional_spark_options-161"><a href="#JDBCExtractionUtils.get_additional_spark_options-161"><span class="linenos">161</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Helper to get additional Spark Options initially passed.</p>

<p>If people provide additional Spark options, not covered by the util function
arguments (get_spark_jdbc_options), we need to consider them.
Thus, we update the options retrieved by the utils, by checking if there is
any Spark option initially provided that is not yet considered in the retrieved
options or function arguments and if the value for the key is not None.
If these conditions are filled, we add the options and return the complete dict.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>input_spec:</strong>  the input specification.</li>
<li><strong>options:</strong>  dict with Spark options.</li>
<li><strong>ignore_options:</strong>  list of options to be ignored by the process.
Spark read has two different approaches to parallelize
reading process, one of them is using upper/lower bound,
another one is using predicates, those process can't be
executed at the same time, you must choose one of them.
By choosing predicates you can't pass lower and upper bound,
also can't pass number of partitions and partition column
otherwise spark will interpret the execution partitioned by
upper and lower bound and will expect to fill all variables.
To avoid fill all predicates hardcoded at the acon, there is
a feature that automatically generates all predicates for init
or delta load based on input partition column, but at the end
of the process, partition column can't be passed to the options,
because we are choosing predicates execution, that is why to
generate predicates we need to pass some options to ignore.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>a dict with all the options passed as argument, plus the options that
  were initially provided, but were not used in the util
  (get_spark_jdbc_options).</p>
</blockquote>
</div>


                    </div>
                    <div id="JDBCExtractionUtils.get_predicates" class="classattr">
                                <input id="JDBCExtractionUtils.get_predicates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_predicates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">predicates_query</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">List</span>:</span></span>

                <label class="view-source-button" for="JDBCExtractionUtils.get_predicates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionUtils.get_predicates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionUtils.get_predicates-163"><a href="#JDBCExtractionUtils.get_predicates-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">get_predicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicates_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_predicates-164"><a href="#JDBCExtractionUtils.get_predicates-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the predicates list, based on a predicates query.</span>
</span><span id="JDBCExtractionUtils.get_predicates-165"><a href="#JDBCExtractionUtils.get_predicates-165"><span class="linenos">165</span></a>
</span><span id="JDBCExtractionUtils.get_predicates-166"><a href="#JDBCExtractionUtils.get_predicates-166"><span class="linenos">166</span></a><span class="sd">        Args:</span>
</span><span id="JDBCExtractionUtils.get_predicates-167"><a href="#JDBCExtractionUtils.get_predicates-167"><span class="linenos">167</span></a><span class="sd">            predicates_query: query to use as the basis to get the distinct values for</span>
</span><span id="JDBCExtractionUtils.get_predicates-168"><a href="#JDBCExtractionUtils.get_predicates-168"><span class="linenos">168</span></a><span class="sd">                a specified column, based on which predicates are generated.</span>
</span><span id="JDBCExtractionUtils.get_predicates-169"><a href="#JDBCExtractionUtils.get_predicates-169"><span class="linenos">169</span></a>
</span><span id="JDBCExtractionUtils.get_predicates-170"><a href="#JDBCExtractionUtils.get_predicates-170"><span class="linenos">170</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils.get_predicates-171"><a href="#JDBCExtractionUtils.get_predicates-171"><span class="linenos">171</span></a><span class="sd">            List containing the predicates to use to split the extraction from</span>
</span><span id="JDBCExtractionUtils.get_predicates-172"><a href="#JDBCExtractionUtils.get_predicates-172"><span class="linenos">172</span></a><span class="sd">            JDBC sources.</span>
</span><span id="JDBCExtractionUtils.get_predicates-173"><a href="#JDBCExtractionUtils.get_predicates-173"><span class="linenos">173</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils.get_predicates-174"><a href="#JDBCExtractionUtils.get_predicates-174"><span class="linenos">174</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_predicates-175"><a href="#JDBCExtractionUtils.get_predicates-175"><span class="linenos">175</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-176"><a href="#JDBCExtractionUtils.get_predicates-176"><span class="linenos">176</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">predicates_query</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-177"><a href="#JDBCExtractionUtils.get_predicates-177"><span class="linenos">177</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_predicates-178"><a href="#JDBCExtractionUtils.get_predicates-178"><span class="linenos">178</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-179"><a href="#JDBCExtractionUtils.get_predicates-179"><span class="linenos">179</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-180"><a href="#JDBCExtractionUtils.get_predicates-180"><span class="linenos">180</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-181"><a href="#JDBCExtractionUtils.get_predicates-181"><span class="linenos">181</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils.get_predicates-182"><a href="#JDBCExtractionUtils.get_predicates-182"><span class="linenos">182</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils.get_predicates-183"><a href="#JDBCExtractionUtils.get_predicates-183"><span class="linenos">183</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="JDBCExtractionUtils.get_predicates-184"><a href="#JDBCExtractionUtils.get_predicates-184"><span class="linenos">184</span></a>
</span><span id="JDBCExtractionUtils.get_predicates-185"><a href="#JDBCExtractionUtils.get_predicates-185"><span class="linenos">185</span></a>        <span class="n">predicates_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_predicates-186"><a href="#JDBCExtractionUtils.get_predicates-186"><span class="linenos">186</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_predicates-187"><a href="#JDBCExtractionUtils.get_predicates-187"><span class="linenos">187</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_predicates&quot;</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-188"><a href="#JDBCExtractionUtils.get_predicates-188"><span class="linenos">188</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-189"><a href="#JDBCExtractionUtils.get_predicates-189"><span class="linenos">189</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-190"><a href="#JDBCExtractionUtils.get_predicates-190"><span class="linenos">190</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_predicates-191"><a href="#JDBCExtractionUtils.get_predicates-191"><span class="linenos">191</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_predicates-192"><a href="#JDBCExtractionUtils.get_predicates-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_predicates-193"><a href="#JDBCExtractionUtils.get_predicates-193"><span class="linenos">193</span></a>
</span><span id="JDBCExtractionUtils.get_predicates-194"><a href="#JDBCExtractionUtils.get_predicates-194"><span class="linenos">194</span></a>        <span class="n">predicates_list</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="JDBCExtractionUtils.get_predicates-195"><a href="#JDBCExtractionUtils.get_predicates-195"><span class="linenos">195</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">=&#39;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="JDBCExtractionUtils.get_predicates-196"><a href="#JDBCExtractionUtils.get_predicates-196"><span class="linenos">196</span></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">predicates_df</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils.get_predicates-197"><a href="#JDBCExtractionUtils.get_predicates-197"><span class="linenos">197</span></a>        <span class="p">]</span>
</span><span id="JDBCExtractionUtils.get_predicates-198"><a href="#JDBCExtractionUtils.get_predicates-198"><span class="linenos">198</span></a>
</span><span id="JDBCExtractionUtils.get_predicates-199"><a href="#JDBCExtractionUtils.get_predicates-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates_add_null</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_predicates-200"><a href="#JDBCExtractionUtils.get_predicates-200"><span class="linenos">200</span></a>            <span class="n">predicates_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2"> IS NULL&quot;</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_predicates-201"><a href="#JDBCExtractionUtils.get_predicates-201"><span class="linenos">201</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_predicates-202"><a href="#JDBCExtractionUtils.get_predicates-202"><span class="linenos">202</span></a>            <span class="sa">f</span><span class="s2">&quot;The following predicate list was generated: </span><span class="si">{</span><span class="n">predicates_list</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="JDBCExtractionUtils.get_predicates-203"><a href="#JDBCExtractionUtils.get_predicates-203"><span class="linenos">203</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_predicates-204"><a href="#JDBCExtractionUtils.get_predicates-204"><span class="linenos">204</span></a>
</span><span id="JDBCExtractionUtils.get_predicates-205"><a href="#JDBCExtractionUtils.get_predicates-205"><span class="linenos">205</span></a>        <span class="k">return</span> <span class="n">predicates_list</span>
</span></pre></div>


            <div class="docstring"><p>Get the predicates list, based on a predicates query.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>predicates_query:</strong>  query to use as the basis to get the distinct values for
a specified column, based on which predicates are generated.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>List containing the predicates to use to split the extraction from
  JDBC sources.</p>
</blockquote>
</div>


                    </div>
                    <div id="JDBCExtractionUtils.get_spark_jdbc_options" class="classattr">
                                <input id="JDBCExtractionUtils.get_spark_jdbc_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_spark_jdbc_options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JDBCExtractionUtils.get_spark_jdbc_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionUtils.get_spark_jdbc_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionUtils.get_spark_jdbc_options-207"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">get_spark_jdbc_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-208"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Spark options to extract data from a JDBC source.</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-209"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-209"><span class="linenos">209</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-210"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-210"><span class="linenos">210</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-211"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-211"><span class="linenos">211</span></a><span class="sd">            The Spark jdbc args dictionary, including the query to submit</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-212"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-212"><span class="linenos">212</span></a><span class="sd">            and also options args dictionary.</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-213"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-214"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-214"><span class="linenos">214</span></a>        <span class="n">options_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-215"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-215"><span class="linenos">215</span></a>            <span class="s2">&quot;fetchSize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">fetch_size</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-216"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-216"><span class="linenos">216</span></a>            <span class="s2">&quot;compress&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">compress</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-217"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-217"><span class="linenos">217</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-218"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-218"><span class="linenos">218</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-219"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-219"><span class="linenos">219</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-220"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-220"><span class="linenos">220</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-221"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-221"><span class="linenos">221</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-222"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-222"><span class="linenos">222</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-223"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-223"><span class="linenos">223</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-224"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-224"><span class="linenos">224</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-225"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-225"><span class="linenos">225</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-226"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-226"><span class="linenos">226</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-227"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-227"><span class="linenos">227</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-228"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">extraction_type</span> <span class="o">==</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">DELTA</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-229"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-229"><span class="linenos">229</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">predicates_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_delta_query</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-230"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-230"><span class="linenos">230</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-231"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-231"><span class="linenos">231</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">],</span> <span class="n">predicates_query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_init_query</span><span class="p">()</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-232"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-232"><span class="linenos">232</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-233"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-233"><span class="linenos">233</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">custom_schema</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-234"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-234"><span class="linenos">234</span></a>            <span class="n">options_args</span><span class="p">[</span><span class="s2">&quot;customSchema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">custom_schema</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-235"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-235"><span class="linenos">235</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-236"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-236"><span class="linenos">236</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">generate_predicates</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-237"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-237"><span class="linenos">237</span></a>            <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;predicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_predicates</span><span class="p">(</span><span class="n">predicates_query</span><span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-238"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-238"><span class="linenos">238</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-239"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-240"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-240"><span class="linenos">240</span></a>                <span class="n">jdbc_args</span><span class="p">[</span><span class="s2">&quot;predicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">predicates</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-241"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-241"><span class="linenos">241</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-242"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-242"><span class="linenos">242</span></a>                <span class="n">options_args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_extraction_partition_opts</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-243"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-243"><span class="linenos">243</span></a>                    <span class="n">options_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-244"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-244"><span class="linenos">244</span></a>                <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-245"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-245"><span class="linenos">245</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_options-246"><a href="#JDBCExtractionUtils.get_spark_jdbc_options-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">options_args</span><span class="p">,</span> <span class="n">jdbc_args</span>
</span></pre></div>


            <div class="docstring"><p>Get the Spark options to extract data from a JDBC source.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The Spark jdbc args dictionary, including the query to submit
  and also options args dictionary.</p>
</blockquote>
</div>


                    </div>
                    <div id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound" class="classattr">
                                <input id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_spark_jdbc_optimal_upper_bound</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-248"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">get_spark_jdbc_optimal_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-249"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an optimal upperBound to properly split a Spark JDBC extraction.</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-250"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-250"><span class="linenos">250</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-251"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-251"><span class="linenos">251</span></a><span class="sd">        Returns:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-252"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-252"><span class="linenos">252</span></a><span class="sd">             Either an int, date or timestamp to serve as upperBound Spark JDBC option.</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-253"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-254"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-254"><span class="linenos">254</span></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-255"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-255"><span class="linenos">255</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">calc_upper_bound_schema</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-256"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-256"><span class="linenos">256</span></a>            <span class="n">options</span><span class="p">[</span><span class="s2">&quot;customSchema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">calc_upper_bound_schema</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-257"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-257"><span class="linenos">257</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-258"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-258"><span class="linenos">258</span></a>        <span class="n">table</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-259"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-259"><span class="linenos">259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-260"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-260"><span class="linenos">260</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">extraction_type</span> <span class="o">==</span> <span class="n">JDBCExtractionType</span><span class="o">.</span><span class="n">INIT</span><span class="o">.</span><span class="n">value</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-261"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-261"><span class="linenos">261</span></a>            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">changelog_table</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-262"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-262"><span class="linenos">262</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-263"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-263"><span class="linenos">263</span></a>        <span class="n">jdbc_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-264"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-264"><span class="linenos">264</span></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-265"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-265"><span class="linenos">265</span></a>            <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;(SELECT COALESCE(MAX(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">), &quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-266"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-266"><span class="linenos">266</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">default_upper_bound</span><span class="si">}</span><span class="s2">) &quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-267"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-267"><span class="linenos">267</span></a>            <span class="sa">f</span><span class="s2">&quot;upper_bound FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>  <span class="c1"># nosec: B608</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-268"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-268"><span class="linenos">268</span></a>            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-269"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-269"><span class="linenos">269</span></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">user</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-270"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-270"><span class="linenos">270</span></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-271"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-271"><span class="linenos">271</span></a>                <span class="s2">&quot;driver&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-272"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-272"><span class="linenos">272</span></a>            <span class="p">},</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-273"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-273"><span class="linenos">273</span></a>        <span class="p">}</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-274"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-274"><span class="linenos">274</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-275"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-275"><span class="linenos">275</span></a>        <span class="kn">from</span> <span class="nn">lakehouse_engine.io.reader_factory</span> <span class="kn">import</span> <span class="n">ReaderFactory</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-276"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-276"><span class="linenos">276</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-277"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-277"><span class="linenos">277</span></a>        <span class="n">upper_bound_df</span> <span class="o">=</span> <span class="n">ReaderFactory</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-278"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-278"><span class="linenos">278</span></a>            <span class="n">InputSpec</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-279"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-279"><span class="linenos">279</span></a>                <span class="n">spec_id</span><span class="o">=</span><span class="s2">&quot;get_optimal_upper_bound&quot;</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-280"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-280"><span class="linenos">280</span></a>                <span class="n">data_format</span><span class="o">=</span><span class="n">InputFormat</span><span class="o">.</span><span class="n">JDBC</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-281"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-281"><span class="linenos">281</span></a>                <span class="n">read_type</span><span class="o">=</span><span class="n">ReadType</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-282"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-282"><span class="linenos">282</span></a>                <span class="n">jdbc_args</span><span class="o">=</span><span class="n">jdbc_args</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-283"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-283"><span class="linenos">283</span></a>                <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-284"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-284"><span class="linenos">284</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-285"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-285"><span class="linenos">285</span></a>        <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-286"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-286"><span class="linenos">286</span></a>        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">upper_bound_df</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-287"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-287"><span class="linenos">287</span></a>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-288"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-288"><span class="linenos">288</span></a>        <span class="k">if</span> <span class="n">upper_bound</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-289"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-289"><span class="linenos">289</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-290"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-290"><span class="linenos">290</span></a>                <span class="sa">f</span><span class="s2">&quot;Upper Bound &#39;</span><span class="si">{</span><span class="n">upper_bound</span><span class="si">}</span><span class="s2">&#39; derived from &quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-291"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-291"><span class="linenos">291</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span><span class="si">}</span><span class="s2">&#39; using the column &quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-292"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-292"><span class="linenos">292</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-293"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-293"><span class="linenos">293</span></a>            <span class="p">)</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-294"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-294"><span class="linenos">294</span></a>            <span class="k">return</span> <span class="n">upper_bound</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-295"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-295"><span class="linenos">295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-296"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-296"><span class="linenos">296</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-297"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-297"><span class="linenos">297</span></a>                <span class="sa">f</span><span class="s2">&quot;Not able to calculate upper bound from &quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-298"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-298"><span class="linenos">298</span></a>                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">dbtable</span><span class="si">}</span><span class="s2">&#39; using &quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-299"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-299"><span class="linenos">299</span></a>                <span class="sa">f</span><span class="s2">&quot;the column &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_JDBC_EXTRACTION</span><span class="o">.</span><span class="n">partition_column</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-300"><a href="#JDBCExtractionUtils.get_spark_jdbc_optimal_upper_bound-300"><span class="linenos">300</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get an optimal upperBound to properly split a Spark JDBC extraction.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>Either an int, date or timestamp to serve as upperBound Spark JDBC option.</p>
</blockquote>
</div>


                    </div>
        </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>